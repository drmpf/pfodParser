<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1252">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice 4.1.14  (Win32)">
	<META NAME="AUTHOR" CONTENT="Matthew Ford">
	<META NAME="CREATED" CONTENT="20101119;14335151">
	<META NAME="CHANGEDBY" CONTENT="matthew ford">
	<META NAME="CHANGED" CONTENT="20231001;12533224">
	<STYLE TYPE="text/css">
	<!--
		@page { margin: 2cm }
		P { margin-bottom: 0.21cm }
		H1 { margin-bottom: 0.21cm }
		H1.western { font-family: "Arial", sans-serif; font-size: 16pt }
		H1.cjk { font-family: "SimSun"; font-size: 16pt }
		H1.ctl { font-family: "Mangal"; font-size: 16pt }
		H3 { margin-bottom: 0.21cm }
		H3.western { font-family: "Arial", sans-serif }
		H3.cjk { font-family: "SimSun" }
		H3.ctl { font-family: "Mangal" }
		H2 { margin-bottom: 0.21cm }
		H2.western { font-family: "Arial", sans-serif; font-size: 14pt; font-style: italic }
		H2.cjk { font-family: "SimSun"; font-size: 14pt; font-style: italic }
		H2.ctl { font-family: "Mangal"; font-size: 14pt; font-style: italic }
		H4 { margin-bottom: 0.21cm }
		H4.western { font-family: "Arial", sans-serif; font-size: 11pt; font-style: italic }
		H4.cjk { font-family: "SimSun"; font-size: 11pt; font-style: italic }
		H4.ctl { font-family: "Mangal"; font-size: 11pt; font-style: italic }
		H5 { margin-bottom: 0.21cm }
		H5.western { font-family: "Arial", sans-serif; font-size: 11pt }
		H5.cjk { font-family: "SimSun"; font-size: 11pt }
		H5.ctl { font-family: "Mangal"; font-size: 11pt }
		PRE.cjk { font-family: "NSimSun", monospace }
		A:link { so-language: zxx }
		TT.cjk { font-family: "NSimSun", monospace }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-AU" DIR="LTR">
<P ALIGN=CENTER><FONT SIZE=5><B>Protocol For Operations
Discovery<BR>(pfod)</B></FONT></P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm">Specification V3.0.18</P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm">Matthew Ford <BR>1st
September 2023</P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm">&copy;2010-2023 Forward
Computing and Control Pty. Ltd.</P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><B>Product Warning and
Limitation of Liability</B></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm">This specification has
intentional limitations and any software implementing it will have
unintentional coding errors. It must NOT be used in any situation
where there is any risk of personal injury or damage to property. See
also <A HREF="#Liability">Limitations on Liability and Remedies</A> 
</P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=LEFT><BR><BR>
</P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><BR>
</P>
<DIV ID="Table of Contents1" DIR="LTR">
	<DIV ID="Table of Contents1_Head" DIR="LTR">
		<P STYLE="margin-bottom: 0cm; page-break-after: avoid"><FONT FACE="Arial, sans-serif"><FONT SIZE=4 STYLE="font-size: 16pt"><B>Table
		of Contents</B></FONT></FONT></P>
	</DIV>
	<P STYLE="margin-bottom: 0cm">Revision History	4</P>
	<P STYLE="margin-bottom: 0cm">Introduction	7</P>
	<P STYLE="margin-bottom: 0cm">Trade Marks	7</P>
	<P STYLE="margin-bottom: 0cm">The format of pfod messages	7</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Restricted
	Characters	8</P>
	<P STYLE="margin-bottom: 0cm">Messages the pfodApp can send to a
	pfodDevice	8</P>
	<P STYLE="margin-bottom: 0cm">pfodApp Message Formats and Examples	8</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">requestCurrentTime/setLanguageFormat
		8</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Optional Language
	part of the {@ response	9</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Optional 'Current'
	time part of the {@ response	9</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Language
	Examples	9</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">'Current' Time
	examples	10</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Current
	milliseconds	10</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Current date and
	time 	10</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">getMainMenu
	Format	11</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Commands format
		11</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Menu Refresh
	Request	11</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">closeConnection
	format	11</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">keepAlive
	format	12</P>
	<P STYLE="margin-bottom: 0cm">Messages a pfodDevice can send to the
	pfodApp	12</P>
	<P STYLE="margin-bottom: 0cm">Text Formatting of Titles and
	DisplayStrings	12</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Escape
	Sequences	13</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">UTF8converter.jar
	Program 	13</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Restricted
	Characters in Drawing's Labels and TouchActionInput dialogs	14</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Restricted
	Characters in String Input screens.	14</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Non-display
	Character	15</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Auto-termination
	of formatting tags	15</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Examples of
	Auto-termination of formatting tags	15</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Handling of Tag
	Errors	15</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Style Formats	17</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Style Examples	17</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Font Size
	Formats	17</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Font Size
	Examples	18</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Font Colour
	Format	18</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Black Or White Font
	Colour	20</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Font Colour
	Examples	20</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Background Colour
	Format	20</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Background Colour
	Examples	20</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Default Colours	21</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Setting the Sound to
	be Played	21</P>
	<P STYLE="margin-bottom: 0cm">pfodDevice Message Formats and
	Examples	21</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Empty Message
	format	21</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Current Time /
	Language Message format	21</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Optional Language
	part of the {@ response	22</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Optional 'Current'
	time part of the {@ response	22</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples	22</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Language
	Examples	22</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">'Current' Time
	examples	23</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Current
	milliseconds	23</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Current date and
	time 	23</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Back and Home
	Messages {&lt;} {&lt;&lt;}	24</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Menu Message 
	format  {,	24</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Empty menu
	example	25</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Menu Items	25</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Types of Menu
	Items	26</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Plain Labels	26</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Empty Labels as
	Spacers	26</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Plain Text
	Buttons	27</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">A Disabled Button	27</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">A Hidden Button	28</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Toggle Buttons	28</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Toggle Labels	29</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Text Slider
	Buttons	29</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Text Slider
	Labels	30</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Numeric Slider
	Buttons	31</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Numeric Slider
	Example sketch	32</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Numeric Slider
	Labels	34</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Navigation
	Buttons	34</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Dwg Menu Item
	Format	38</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Reuse of
	Drawings	38</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Switching Dwgs	38</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Drawing Version
	and the isRefresh() flag	38</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Loading and
	Reloading Dwgs, Refresh Time.	39</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Forcing an Drawing
	to be re-loaded from the pfodDevice.	39</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Automatic Drawing
	Reloads	40</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Drawing Menu
	Items	41</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">A Simple Dwg
	Example	42</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Scaling Drawings for
	display.	45</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Drawing Size &ndash;
	How to Choose	46</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">X-Dimension,
	cols	46</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Y-Dimension,
	rows	46</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">The number of
	columns (width, x-dimension) affects the dwg items scaling.	47</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Dwg Items can be
	placed on fraction cols and rows.	47</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Drawing
	Primitives	47</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Drawing Primitives
	Library	47</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">List of Drawing
	Primitives	48</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Zero, push and
	pop	52</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">InsertDwgs	52</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Hide, Unhide,
	Erase	52</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Index	53</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Text and Values
	Alignment	54</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Text Displays	55</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Value Text
	Displays	55</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">User Touches and Dwg
	Active Areas	56</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">How to choose
	between multiple overlapping touchZones	56</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Touch Filter
	Options	57</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">No Touch Zones
	Defined	57</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Touch Zones
	Defined	57</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Commands returned
	for Active Regions	59</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">User Input Touch
	Resolution 	60</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Touch Actions	60</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">TouchAction
	Example	61</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">TouchActionInput
		61</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Moving / Hiding/
	Removing Active Areas and Drawing Primitives	64</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Drawing an Dwg 	64</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Dwg Colours 	64</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Dwg Drawing Message
	Format	64</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Updating an existing
	Dwg	65</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Sending Dwgs and
	updates that are too large for a single message	66</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Update Menu
	Message  format	66</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples	66</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Slider Updates	66</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Note About Slider
	Updates	67</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Refresh and Menu
	Caching	68</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Refresh Messages	68</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Menu Caching	68</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Streaming raw data
	Message format (Display)	69</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples	69</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Streaming raw data
	Message format (Plotting)	70</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Overview	70</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Quick Start for
	Plotting Messages	71</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Description of
	Plotting Message Format	71</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples (one data
	value)	73</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples (more
	then one data value)	75</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples (phase
	plots)	79</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples (multiple
	datasets)	80</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Date/Time Plots	80</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">RawDate Date/Time
	format	81</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">RawData Millisecond
	format 	81</P>
	<P STYLE="margin-left: 2cm; margin-bottom: 0cm">Logging Date/Time
	Raw Date	82</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Date/Time Plot
	messages	82</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Date/Time Plot
	TimeZones	83</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Elapsed Time Plot
	messages	83</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Using HH:mm:ss
	format for dates and times	84</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">String input
	Message format	85</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples 	86</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Numeric Input
	Message Format	87</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples	87</P>
	<P STYLE="margin-bottom: 0cm">Single Selection List Message Format
		88</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples	89</P>
	<P STYLE="margin-bottom: 0cm">Multiple Selection List Message Format
		89</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples	89</P>
	<P STYLE="margin-bottom: 0cm">Close Connection Message Format 	90</P>
	<P STYLE="margin-left: 1.5cm; margin-bottom: 0cm">Examples	90</P>
	<P STYLE="margin-bottom: 0cm">Displaying long messages to the
	user	90</P>
	<P STYLE="margin-bottom: 0cm">Secure Connections	91</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">What Threats are
	being protected against	91</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">What Threats are
	not being protected against.	91</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Outline of the
	Security Sequence.	91</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">A sample secure
	connection sequence	92</P>
	<P STYLE="margin-bottom: 0cm">Required pfod Support	93</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">pfodApp	93</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">pfodDevice	94</P>
	<P STYLE="margin-bottom: 0cm">pfodDevice coding guidelines.	94</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Ignoring invalid
	messages	94</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">pfodDevice
	Responses	94</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Navigation
	Guidelines	95</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Responses to a Menu
	command sent by the pfodApp.	95</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Responses to a User
	Input command sent by the pfodApp.	96</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm">Navigation
	Guidelines Summary	96</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Formatting
	Guidelines	96</P>
	<P STYLE="margin-bottom: 0cm">Product Warning and Limitation of
	Liability and Copyrights	97</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Limitations on
	Liability and Remedies	97</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Applicable Law,
	Jurisdiction, and Venue	97</P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm">Copyrights	97</P>
</DIV>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
</P>
<H1 CLASS="western"><A NAME="__RefHeading__1881_1301006447"></A>Revision
History</H1>
<P>V1.0 &ndash; First Release</P>
<P>V1.1 &ndash; add support for Unicode and text formatting</P>
<P>V1.2 &ndash; replaced , with ` in message format, simplified
time-out specification and added optional max number of chars to text
input message, revised the language message, {@</P>
<P>V1.2.1 &ndash; added support for 128bit security when using wifi,
clarified streaming raw data message operation.</P>
<P>V1.2.2 &ndash; added UTF-8 support as default and enlarged message
size to 1024 bytes for messages send to the pfodApp. Messages sent to
the pfodDevice are still limited to 255 bytes max, including the { } 
</P>
<P>V1.2.3 &ndash; Changed numeric input screen msg format <I><B>Note:This
change is NOT backward compatible. pfodDevice code will need to be
changed if it is using the numeric input screen.</B></I> Changed
format of commands send to pfodDevice,  no changes needed if
pfodDevice is using the pfod libraries supplied for Arduino. Added
numeric and slider menu items. 
</P>
<P>V1.2.4 &ndash; Added Plotting</P>
<P>V1.2.5 &ndash; Added {! commands to close connection</P>
<P>V1.2.6 &ndash; Added Slider Example code</P>
<P>V1.2.7 &ndash; Added Note about raw data and plotting data format
&ndash; US-ASCII only</P>
<P>V1.2.8 &ndash; Added Formatting and Escape sequences and + slider
number format.</P>
<P>V1.2.9 &ndash; Added Unicode input sequences and \ escape</P>
<P>V1.2.10 &ndash; Added slider text items</P>
<P>V1.2.11 &ndash; Added Toggle Slider example</P>
<P>V1.2.12 &ndash; Added Text Slider example</P>
<P>V1.2.13 &ndash; Changed Numeric Slider Offset calculation</P>
<P>V1.2.14 &ndash; Added menu items to bottom of Navigation Screen</P>
<P>V1.2.15 &ndash; Single Selection Screen can have nothing selected</P>
<P>V1.2.16 &ndash; Corrected Numeric input example. Cmds must start
with an alpha character (a..z A..Z)</P>
<P>V1.2.17 &ndash; Added &lt;ex ifs&gt; text extras.</P>
<P>V1.2.18 &ndash; Added isRefresh request. If used, requires
pfodParser library V2.10+</P>
<P>V1.2.19 &ndash; Added non-whitespace, non-display character.</P>
<P>V1.2.20 &ndash; Added keepAlive message.</P>
<P>V1.2.21 &ndash; Added example C code for non-whitespace,
non-display character</P>
<P>V1.2.22 &ndash; Revised keepAlive message description</P>
<P>V2.0.1 &ndash; Added V2 menu descriptions and deprecated (removed)
V1 menus</P>
<P>V2.0.2 &ndash; Added 256 Colour Palette</P>
<P>V2.0.3 &ndash; positive font sizes must have plus sign, zero font
size must have + or -, i.e. &lt;+0&gt; or &lt;-0&gt;, added note
about +values for sliders.</P>
<P>V2.0.4 &ndash; revised placement of default colour in Load/Update
Dwg cmds, moreData now must be 'm' to be recognized</P>
<P>V2.0.5 &ndash; minor change to streaming raw data</P>
<P>V2.0.6 &ndash; added Hidden button and plot freeze docs</P>
<P>V3.0.0 &ndash; added dwg primitives</P>
<P>V3.0.1 &ndash; added embedded dwgs, hide/unhide and index dwg
primitives</P>
<P>V3.0.2 &ndash; allow fraction col and row for zero push</P>
<P>V3.0.3 &ndash; added note about ordering of indexed touchZones</P>
<P>V3.0.4 &ndash; added dwg re-request</P>
<P>V3.0.5 &ndash; added note about touch resolution</P>
<P>V3.0.6 &ndash; added plotOptions for pfodApp V3.0.346</P>
<P>V3.0.7 &ndash; added Date time logging/plot Options for pfodApp
V3.0.355</P>
<P>V3.0.8 &ndash; added {@} restrictions for Date/Time plots. Added
Elapsed Time plots (pfodApp V3.0.356)</P>
<P>V3.0.8 &ndash; changed test for ms to &lt;2^38 ~ 1979 - pfodApp
V3.0.361</P>
<P>V3.0.9 &ndash; added ~S, sort option to plots &ndash; pfodApp
V3.0.362</P>
<P>V3.0.10 &ndash; added alignment options for text and value dwg
primitives 
</P>
<P>V3.0.11 &ndash; minor edits</P>
<P>V3.0.12 &ndash; added touchAction description and hide inserted
image</P>
<P>V3.0.13 &ndash; minor edits</P>
<P>V3.0.14 &ndash; added dwgs.touchZone( ).. example 
</P>
<P>V3.0.15 &ndash; added dwgs.touchAction().. example</P>
<P>V3.0.16 &ndash; added touchActionInput</P>
<P>V3.0.17 &ndash; added Back and Home commands, pfodAutoCmd and auto
escape of restricted chars for dwg labels and touchActionInput</P>
<P>V3.0.18 &ndash; added how to enter &#8451;  Unicode under Escape
Sequences</P>
<H1 CLASS="western" STYLE="page-break-before: always">Introduction</H1>
<P>This light weight protocol is designed to allow a general purpose
application, pfodApp<SUP><SPAN STYLE="background: transparent">TM</SPAN></SUP>
 (often a mobile phone app) to discover the functionality provided by
a pfodDevice<SUP><SPAN STYLE="background: transparent">TM</SPAN></SUP>
and allow the user to control it.</P>
<P>pfodDevices are usually simple micro-controller devices which
implement this operation discovery protocol and have  some form of
data connection (often RS232 over bluetooth, but could be wi-fi or
SMS).  You can think of the pfodApp as a micro-browser displaying the
micro-pages returned by the pfodDevice.</P>
<P>When queried with a GetMainMenu request, <B>{.}</B>, the
pfodDevice typically responds with a menu/navigation of commands and
associated display names.  Subsequently when the user selects on of
these commands, it is sent to the pfodDevice, the device performs
that operation and replies either with an empty message, <B>{}</B><SPAN STYLE="font-weight: normal">,</SPAN>
an updated menu, a new menu or a request for user input.</P>
<P>The protocol is robust and flexible. Most of the fields in the
messages sent by a pfodDevice are  optional. Commands supported by
the pfodDevice can usually be single character commands. This
simplifies the programming required in the micro-controller to
support the protocol.  Secure connections can also be made.</P>
<P>Examples of the use of the messages and screen shots from the
Android pfodApp program are given<SPAN STYLE="text-decoration: none">.</SPAN></P>
<P><SPAN STYLE="text-decoration: none">This document describes V2 of
the pfod specification which uses a more compact and flexible menu
structure.  pfodApp continues to support both V1 and V2 menus. For a
description of V1 menus see the </SPAN><SPAN STYLE="text-decoration: none"><B>Protocol
For Operations Discovery V1</B></SPAN><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
document.</SPAN></SPAN></P>
<H1 CLASS="western">Trade Marks</H1>
<P>pfodApp<SUP><SPAN STYLE="background: transparent">TM</SPAN></SUP>
and pfodDevice<SUP><SPAN STYLE="background: transparent">TM</SPAN></SUP>
are trade marks of Forward Computing and Control Pty. Ltd. and their
use is restricted.  Forward Computing and Control Pty. Ltd. will only
the grant use of these trade marks to a device or software that
complies with this specification.</P>
<H1 CLASS="western">The format of pfod messages</H1>
<P>The pfod protocol has two types of messages:- messages which are
enclosed by <B>{ }</B> and streaming raw data which is unformatted.</P>
<P STYLE="margin-bottom: 0cm">The following notation is used to
describe the format of the messages:-</P>
<P STYLE="margin-bottom: 0cm"><I>&lt;title&gt;</I> is a series of
characters  excluding <B>} `</B>  <B>~</B> and <B>|</B>  e.g. Main
Menu</P>
<P STYLE="margin-bottom: 0cm"><I>&lt;prompt&gt;</I>  is a series of
characters excluding <B>} `</B>  <B>~</B> and <B>|</B>  e.g. Input
the required level.</P>
<P STYLE="margin-bottom: 0cm"><I>&lt;string&gt;</I>  is a series of
characters excluding <B>} `</B>  <B>~</B> and <B>|</B>  e.g. test
input  
</P>
<P STYLE="margin-bottom: 0cm"><I>&lt;displayString&gt;</I> a <B>&lt;</B><I><SPAN STYLE="font-weight: normal">string</SPAN></I><B>&gt;</B>
which is displayed to the user to name/describe a command.</P>
<P STYLE="margin-bottom: 0cm"><I>&lt;number&gt;</I> is an integer
number e.g. 15</P>
<P STYLE="margin-bottom: 0cm"><I>&lt;cmd&gt;</I> is a series of
characters that pfodDevice recognises as a command name. It can be
either just . (dot) or  as series of alphaNumeric (a..z A..Z 0..9)
chars.</P>
<P><I>&lt;cmd&gt;</I> cannot have leading or trailing whitespace. 
Typically <I>&lt;cmd&gt;</I> is a single character to simplify the
receiving code in the pfodDevice. 
</P>
<P>&lt;v<I>ersion&gt;</I> is a string consisting of only the
characters a .. z,  A .. Z, 0..9  . (dot) and _ (underscore). 
pfodApp will completely ignore a <I>version</I> that do not follow
this format.  <SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Any
leading or trailing </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">spaces
are trimmed by pfodApp.</SPAN></SPAN></P>
<P>Note: The following special commands are sent by pfodApp:- the
single character command dot, <B>{.}</B>  will request the main menu
from the pfodDevice. The single character cmd !, <B>{!}</B> will
close the connection. The single character cmd space, <B>{ }</B> is
the keep alive command which should always be responded to with an
empty response, <B>{}</B>.  The re-request command prefix :, i.e 
<B>{</B><I><SPAN STYLE="font-weight: normal">&lt;version&gt;</SPAN></I><B>:</B>&lt;cmd&gt;<B>}</B>
which indicates to the pfodDevice that this is requesting an update
to the currently cached menu.</P>
<P>(Note: <B>`</B> shown above is the grave accent character, 0x60)</P>
<P STYLE="margin-bottom: 0cm"><I>[  ]</I> indicates optional block</P>
<P STYLE="margin-bottom: 0cm"><I>[ ]*</I> indicates zero or more
blocks</P>
<H2 CLASS="western"><A NAME="__RefHeading__7669_231561298"></A>Restricted
Characters</H2>
<P STYLE="margin-bottom: 0cm">Restricted characters are <B>{</B> <B>}
`</B>  <B>~</B> and <B>|</B>  
</P>
<P>(Note: <B>`</B> shown above is the grave accent character, 0x60)</P>
<P>See Escape Sequences below for further details.</P>
<P>Also see the <U>Text Formatting of Titles and DisplayStrings</U>
formatting examples below</P>
<H1 CLASS="western">Messages the pfodApp can send to a pfodDevice</H1>
<P STYLE="margin-bottom: 0cm">There three types of messages the
pfodApp can send</P>
<P STYLE="margin-bottom: 0cm"><B>{@</B>           
requestCurrentTime/setLanguage<SPAN STYLE="font-weight: normal">Format</SPAN></P>
<P STYLE="margin-bottom: 0cm"><B>{.}</B>             getMainMenu</P>
<P STYLE="margin-bottom: 0cm"><B>{</B>&lt;cmd&gt;    commands  
</P>
<P STYLE="margin-bottom: 0cm"><B>{</B><I><SPAN STYLE="font-weight: normal">&lt;versionNo&gt;</SPAN></I><B>:</B>&lt;cmd&gt;<B>}</B>
for refresh request</P>
<P STYLE="margin-bottom: 0cm"><B>{!}</B>             closeConnection</P>
<P STYLE="margin-bottom: 0cm"><B>{ }</B>             keepAlive, space
inside curly brackets</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P>In addition to these the pfodApp can send {_ messages to negotiate
a secure connection</P>
<P><SPAN LANG="en-AU">These messages are started by a </SPAN><SPAN LANG="en-AU"><B>{</B></SPAN><SPAN LANG="en-AU">
byte and terminated by a </SPAN><SPAN LANG="en-AU"><B>}</B></SPAN><SPAN LANG="en-AU">
byte and the total length of each message must be &lt;=255 bytes
including the starting </SPAN><SPAN LANG="en-AU"><B>{</B></SPAN><SPAN LANG="en-AU">
and ending </SPAN><SPAN LANG="en-AU"><B>}</B></SPAN><SPAN LANG="en-AU">
bytes.  If the message does not terminate in 255 bytes the pfodDevice
must ignore the whole message as an invalid message.  <BR>This will
probably cause the pfodApp to time out waiting for the pfodApp to
respond.  The pfodApp from </SPAN><A HREF="http://www.pfod.com.au/">www.pfod.com.au</A><SPAN LANG="en-AU">
has been coded to never send messages greater then 255 bytes to the
pfodDevice.</SPAN></P>
<H1 CLASS="western"><A NAME="__RefHeading__1851_1301006447"></A>pfodApp
Message Formats and Examples</H1>
<H2 CLASS="western">requestCurrentTime/setLanguageFormat 
</H2>
<P STYLE="margin-bottom: 0cm"><B>{@</B><I>[~&lt;language1&gt;]* </I><B>}</B></P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P><SPAN STYLE="font-weight: normal">If used, this message is the
first message sent by the pfodApp to the pfodDevice on establishing a
connection.  It </SPAN>requests<SPAN STYLE="font-weight: normal"> the
pfodDevice to respond with its current time and also optionally to
respond to subsequent messages using the  language from one of those
specified. </SPAN>
</P>
<P>The pfodDevice can reply to this message with either an empty
message <B>{}</B> or a Language <B>{@</B>    message.  The empty
message <B>{}</B> indicates that the pfodDevice is not supplying its
'current' time  does not support any of the languages requested and
that communication in both directions will proceed using the defaults
(i.e. no text formatting, default language <SPAN STYLE="font-weight: normal">using
the UTF-8 characters set.)  Note: the UTF-8 characters can be used to
display native language screens to the user even though pfodDevice is
nominally in the English language mode.</SPAN></P>
<P STYLE="font-weight: normal">The pfodDevice's response can have two
parts:- the language and the pfodDevice's 'current' time.</P>
<H3 CLASS="western">Optional Language part of the {@ response</H3>
<P>The pfodDevice Language part of the message <B>{@</B> indicates
which one of the preferred languages the pfodDevice can support and
all future messages in both directions will use these settings.</P>
<P>The pfodDevice is not required to support anything but the default
values described below but will honour the pfodApp's stated
preference if it can. 
</P>
<P>The pfodApp is required to support the default values but can also
support additional languages and request the pfodDevice to respond
using these, if the pfodDevice supports them.</P>
<P>The optional fields are preceded by ~  for languages. The values
are ordered by preference, with the most preferable listed first. 
e.g. <B>{@~fr~en &hellip; }</B></P>
<P><SPAN STYLE="font-weight: normal">The </SPAN><I><SPAN STYLE="font-weight: normal">&lt;language&gt;</SPAN></I><SPAN STYLE="font-weight: normal">
field defines the preferred language the pfodApp would like to
receive messages in. It can take values from ISO 639-1. If no value
is specified the pfodDevice's default language with a character set
of UTF-8, which includes the 7bit-ASCII character set is used.</SPAN></P>
<H3 CLASS="western">Optional 'Current' time part of the {@ response</H3>
<P>The optional 'current' time part of the responses are the <BR>the
pfodDevice's current milliseconds (<B>millis()</B> ) timestamp that
it will use for rawData timestamps<BR>and<BR>the current yearMonthDay
and Time if it will use YearMonthDay and Time as the timestamps for
its rawData. For example if the pfodDevice has an RTC (Real Time
Clock) or a GPS module to provide it date and time.</P>
<P>If the pfodDevice wants to plot data against date and time it MUST
respond to the <B>{@</B> command with its 'current' time.</P>
<H4 CLASS="western"><B>Language Examples</B></H4>
<P><B>{@}</B><SPAN STYLE="font-weight: normal"> requests the
pfodDevice communicate using the default values.  Once the pfodDevice
responds with</SPAN><B> {}</B><SPAN STYLE="font-weight: normal"> all
subsequent messages in both directions will be in English using the
UTF-8 character set </SPAN><SPAN STYLE="font-weight: normal">which
includes the 7bit-ASCII character set.  This request does not need to
be set at the start of the connection as it the default.</SPAN></P>
<P><B>{@~fr~en}</B><SPAN STYLE="font-weight: normal"> requests the
pfodDevice communicate in preferable French or if French is not
supported then in English using UTF-8 as the character set. </SPAN>
</P>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
the empty </SPAN><B>{}</B><SPAN STYLE="font-weight: normal"> message
then it means the pfodDevice does not support setting languages. Only
the default language English in UTF-8 is supported by the pfodDevice.</SPAN></P>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
the Language message </SPAN><B>{@~fr}</B><SPAN STYLE="font-weight: normal">
then all subsequent messages in both directions will take place in
French using UTF-8.</SPAN></P>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
the language message </SPAN><B>{@~en} </B><SPAN STYLE="font-weight: normal">then
all subsequent messages in both directions will take place in English
using UTF-8.</SPAN></P>
<P STYLE="font-weight: normal">Although not usually used, the
specification allows the pfodApp to send the setLanguageFormat
message at any time to request a change in language.  If the
pfodDevice supports the requested language, then the change to that
language occurs immediately after the pfodDevice sends its Language
message response indicating the language to be used.</P>
<H4 CLASS="western">'Current' Time examples</H4>
<P><B>{@}</B><SPAN STYLE="font-weight: normal"> requests the
pfodDevice''s 'current' time (and to communicate using the default
values as above)</SPAN></P>
<P STYLE="font-weight: normal">If the pfodDevice responds with an
empty {} response then pfodApp will ignore requests to plot data
against date and time X-axis.</P>
<H5 CLASS="western">Current milliseconds</H5>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
</SPAN><B>{@`</B><I><SPAN STYLE="font-weight: normal">&lt;ms_current&gt;</SPAN></I><B>}</B><SPAN STYLE="font-weight: normal">,
where </SPAN><I><SPAN STYLE="font-weight: normal">&lt;ms_current&gt;</SPAN></I><SPAN STYLE="font-weight: normal">
is the current value of the rawData millisecond timestamp at the time
the {@ response is sent, then that value together with the pfodApps
current date and time when the {@ response is received will be used
to plot data against date and time on the X-axis.</SPAN></P>
<P><SPAN STYLE="font-weight: normal">e.g. a response of
<BR></SPAN><B>{@`459906}</B><SPAN STYLE="font-weight: normal"><BR>indicates
that when the pfodDevice sent the </SPAN><B>{@</B><SPAN STYLE="font-weight: normal">
response, the current milliseconds where 459906<BR></SPAN><I><B>Note
the ` preceding the integer milliseconds</B></I></P>
<H5 CLASS="western">Current date and time 
</H5>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
</SPAN><B>{@~</B><I><SPAN STYLE="font-weight: normal">&lt;yyyy/MM/dd
HH:mm:ss.SSS&gt;</SPAN></I><B>}</B><SPAN STYLE="font-weight: normal">
OR </SPAN><B>{@~</B><I><SPAN STYLE="font-weight: normal">&lt;yyyy/MM/dd
HH:mm:ss&gt;</SPAN></I><B>}</B><SPAN STYLE="font-weight: normal">.
This is the pfodDevice's current year month day and time all numeric,
at the time is sent the {@ response.  Then the pfodApp will use that
date and time to calculate the offset to the pfodApp's local time and
UTC time for plotting rawData using date and time timestamps against
time and date.  The current date and time can be sent with whole
seconds or fractions of a second down to 3 decimal places. </SPAN>
</P>
<P><SPAN STYLE="font-weight: normal">e.g. a response of<BR></SPAN><B>{@~2019/04/09
08:01:33.535}<BR></B><SPAN STYLE="font-weight: normal">indicates that
when the pfodDevice sent the </SPAN><B>{@</B><SPAN STYLE="font-weight: normal">
response, its current date and time were 2019/04/09 08:01:33.535  By
matching this data and time against pfodApp's date and time, pfodApp
can show </SPAN><SPAN STYLE="font-weight: normal">plots of date and
time time stamped rawData, in 'local' and UTC time after adjusting
for the difference between the pfodDevice's time and the pfodApp
time.<BR></SPAN><I><B>Note the ~ preceding the string of date and
time</B></I></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">A
response of <BR></SPAN><B>{@~2019/04/09 08:01:33`459906}<BR></B><SPAN STYLE="font-weight: normal">provides
both the current date and time and the current milliseconds.  Note:
In this example the current date and time only sends whole seconds.</SPAN></P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
you want to plot rawData that has millisecond timestamps against date
and time then the {@ response must return the current milliseconds
`</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;ms_current&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">.</SPAN></SPAN></P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
you want to plot rawData that has date and time timestamps against
date and time then the {@ </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">response
must return the current date and time ~</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;yyyy/MM/dd
HH:mm:ss.SSS&gt; or </SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
~</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;yyyy/MM/dd
HH:mm:ss&gt;</SPAN></I></P>
<H2 CLASS="western"><B>getMainMenu Format</B></H2>
<P><B>{.}</B><BR><SPAN STYLE="font-weight: normal">This message
requests the pfodDevice's main menu</SPAN>.  
</P>
<P>If the pfodApp does not send a getLanguages message on
establishing a connection, this is the first message the pfodApp
sends to the pfodDevice and all messages in both directions are
assumed to be in English using t<SPAN STYLE="font-weight: normal">he
UTF-8 character set and with no text formatting or character
escaping.</SPAN></P>
<P><SPAN STYLE="font-weight: normal">The pfodDevice responds to this
message, </SPAN><B>{,~}</B><SPAN STYLE="font-weight: normal"> , with
its main or top level message.  The pfodDevice's response is usually
a Menu message, </SPAN><B>{, </B><SPAN STYLE="font-weight: normal">
described below, but can be any of the 9 pfodDevice messages
including </SPAN><B>{}</B></P>
<P><SPAN STYLE="font-weight: normal">The specification also allows
the pfodDevice to respond with an empty </SPAN><B>{}</B><SPAN STYLE="font-weight: normal">
message which indicates there is no main menu/navigation or user
input.  This type of implementation of a pfodDevice is NOT
recommended.</SPAN></P>
<H2 CLASS="western">Commands format 
</H2>
<P STYLE="margin-bottom: 0cm"><B>{</B><I>&lt;cmd&gt;</I><B>}</B></P>
<P STYLE="margin-bottom: 0cm"><B>{</B><I>&lt;cmd&gt;</I> <B>`</B><I>&lt;intArg1&gt;[
</I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I>&lt;intArg2&gt;
]*</I> <B>}</B></P>
<P STYLE="margin-bottom: 0cm"><B>{</B><I>&lt;cmd&gt;</I><B>~</B><I>&lt;strArg1&gt;</I><B>}</B></P>
<P><BR>These messages are sent by the pfodApp to the pfodDevice and
contain commands that the pfodDevice has advertised to the pfodApp
that the pfodDevice can handle. The messages can have additional
fields containing the users input. (see the pfodDevice Input examples
below).  <B>~</B> precedes a string argument field, <B>`</B> precedes
an integer argument field</P>
<P>When the pfodDevice has received this command message from the
pfodApp, the pfodDevice always responds with a pfodDevice message,
perhaps just the empty message, <B>{}</B></P>
<H2 CLASS="western">Menu Refresh Request</H2>
<P><B>{</B><I><SPAN STYLE="font-weight: normal">&lt;version&gt;</SPAN></I><B>:</B><SPAN STYLE="font-weight: normal">&lt;cmd&gt;</SPAN><B>}</B></P>
<P STYLE="font-weight: normal">If and only if the menu has a
<I>&lt;version&gt;</I> set, then pfodApp can send this request to ask
for any updates to the currently cached menu.  The pfodDevice can
reply with a menu update message, starting with {;  to update the
main menu instead of resending the entire menu.  The pfodDevice can
also just respond with the full menu.</P>
<H2 CLASS="western"><B>closeConnection format</B></H2>
<P><B>{!}<BR></B><SPAN STYLE="font-weight: normal">This is the last
message the pfodApp sends before closing the connection, usually when
the user presses exit.  No response is expected. If a pfodDevice does
not need to do anything special at the </SPAN><SPAN STYLE="font-weight: normal">end
of a connection, it can just ignore this command.</SPAN><B>  </B>
</P>
<H2 CLASS="western"><B>keepAlive format</B></H2>
<P><B>{ }<BR></B><SPAN STYLE="font-weight: normal">This command is
just { space }, and is sent on WiFi connections to check if the
pfodDevice is still responding. The pfodDevice must respond with an
empty response, {}, otherwise the pfodApp will </SPAN><SPAN STYLE="font-weight: normal">time
out and close the connection attempt to establish a new one.</SPAN><B>
 </B>
</P>
<H1 CLASS="western">Messages a pfodDevice can send to the pfodApp</H1>
<P STYLE="margin-bottom: 0cm">There are 10 messages types that a
pfodDevice can send to the application. They are indicated by the
first character after the message start <B>{</B> character</P>
<P STYLE="margin-bottom: 0cm"><B>{}</B>   Empty 
</P>
<P STYLE="margin-bottom: 0cm"><B>{@</B> Current Time/Language</P>
<P STYLE="margin-bottom: 0cm"><B>{,</B>   Menu</P>
<P STYLE="margin-bottom: 0cm"><B>{;</B>   Update menu items</P>
<P STYLE="margin-bottom: 0cm"><B>{=</B>  Streaming raw data display
and plotting</P>
<P STYLE="margin-bottom: 0cm"><B>{'</B>   String input</P>
<P STYLE="margin-bottom: 0cm"><B>{# </B> Numeric input</P>
<P STYLE="margin-bottom: 0cm"><B>{? </B> Single Selection input</P>
<P STYLE="margin-bottom: 0cm"><B>{*</B>  Multiple Selection input</P>
<P STYLE="margin-bottom: 0cm"><B>{!</B>  Close connection</P>
<P STYLE="margin-bottom: 0cm"><B>{+</B> Dwg data 
</P>
<P STYLE="margin-bottom: 0cm"><B>{&lt;}</B> Go Back <BR><B>{&lt;&lt;}</B>
Go Home</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P>In addition to these the pfodDevice can send {_ messages when
negotiating a secure connection.</P>
<P>These messages are started by a <B>{</B> byte and terminated by a
<B>}</B> byte and the total length of each message must be &lt;=1023
bytes including the starting <B>{</B> and ending <B>}</B> bytes. 
</P>
<P>Following the message type char is the prompt text. After this
comes the arguments for this message.  In general  <B>|</B> precedes
a command field, <B>~</B> precedes a string fields and <B>`</B>
precedes an integer field, although there are some exceptions.</P>
<P>Most of these pfodDevice messages specify commands the pfodDevice
will respond to and have optional fields containing information to
display to the user about the commands. 
</P>
<H1 CLASS="western"><A NAME="__RefHeading__3558_380236166"></A>Text
Formatting of Titles and DisplayStrings</H1>
<P>Text that is displayed to the user can be formatted by setting
Style, Size and Colour.  Support for any or all of this text
formatting is optional, so do not use formatting to convey meaning to
the users as a particular implementation of pfodApp may not render
it.</P>
<P><SPAN LANG="en-AU">There is a free Android app, </SPAN><A HREF="https://play.google.com/store/apps/details?id=au.com.forward.pfodDesigner&amp;hl=en" TARGET="_blank">pfodDesigner</A><SPAN LANG="en-AU">,
to assist in designing formatted menus, previewing them </SPAN><SPAN LANG="en-AU">and
then generating the pfod message and Arduino code that will serve up
the menu and handle the user's button presses. </SPAN>
</P>
<P>The formats described here are the only valid formats.  All other
text is just passed through unchanged, including multiple consecutive
spaces.</P>
<P STYLE="margin-bottom: 0cm"><SPAN STYLE="font-weight: normal">In
all cases any of the following combinations:-<BR>   </SPAN><I><SPAN STYLE="font-weight: normal">carriage
return  </SPAN></I><SPAN STYLE="font-weight: normal">(i.e. 0x0d) <BR></SPAN><SPAN STYLE="font-weight: normal">
  </SPAN><I><SPAN STYLE="font-weight: normal">carriage return +
linefeed </SPAN></I><SPAN STYLE="font-weight: normal">(i.e. 0x0d
0x0a)  <BR></SPAN><SPAN STYLE="font-weight: normal">   </SPAN><I><SPAN STYLE="font-weight: normal">linefeed
</SPAN></I><SPAN STYLE="font-weight: normal">(i.e. 0x0a) <BR></SPAN><SPAN STYLE="font-weight: normal">will
represent a new line sequence.</SPAN></P>
<H2 CLASS="western"><A NAME="__RefHeading__8123_860048826"></A>Escape
Sequences</H2>
<P><SPAN STYLE="font-weight: normal">ALL pfodApp implementations must
support the following escape sequences, even if it does not render
the formatting:-<BR> </SPAN><I><B>&amp;#96;</B></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	for `</SPAN></SPAN><SPAN STYLE="font-weight: normal"><BR> </SPAN><I><B>&amp;#123;</B></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	for {</SPAN></SPAN><SPAN STYLE="font-weight: normal"><BR> </SPAN><I><B>&amp;#124;</B></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	for |</SPAN></SPAN><SPAN STYLE="font-weight: normal"><BR> </SPAN><I><B>&amp;#125;</B></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	for }</SPAN></SPAN><SPAN STYLE="font-weight: normal"><BR> </SPAN><I><B>&amp;#126;</B></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	for ~<BR> </SPAN></SPAN><I><B>&amp;amp;</B></I><SPAN STYLE="font-weight: normal">
	for &amp;    </SPAN><I><SPAN STYLE="font-weight: normal">This escape
sequence is almost never needed to be manually entered</SPAN></I><SPAN STYLE="font-weight: normal"><BR>
</SPAN><I><B>&amp;lt;</B></I><SPAN STYLE="font-weight: normal"> 		for
</SPAN><B>&lt;</B><SPAN STYLE="font-weight: normal">     </SPAN><I><SPAN STYLE="font-weight: normal">This
escape sequence is almost never needed to be manually entered<BR>
</SPAN></I><I><B>&amp;#92;</B></I><I><SPAN STYLE="font-weight: normal">	</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">	for
\  	</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">This escape
sequence is almost never needed to be manually entered</SPAN></I></P>
<P STYLE="font-style: normal; font-weight: normal">When sending text
from the pfodDevice to pfodApp these escape sequence allow you to
display restricted chars as part of labels etc.</P>
<P STYLE="font-style: normal; font-weight: normal">Note: these are
the only escape sequences supported. All other text in
&lt;displayString&gt;, that is not a valid text format, is just
passed through unchanged.</P>
<P STYLE="font-style: normal; font-weight: normal">Entering Unicode
Characters</P>
<P><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">The
String Input screen and the drawing touchActionInput edit dialog,
both accept Unicode sequences, e.g.  \u2109, and convert them the the
equivalent Unicode character, <BR>e.g typing in \u2109 will display 
</SPAN></SPAN></SPAN><FONT COLOR="#333333"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>&#8457;<BR></B></SPAN></SPAN></FONT><FONT COLOR="#333333"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">while
typing in \u2103 will display </SPAN></SPAN></SPAN></FONT><FONT COLOR="#333333"><B>&#8451;</B></FONT><FONT COLOR="#333333">
</FONT>
</P>
<P STYLE="font-style: normal; font-weight: normal"><FONT COLOR="#333333">To
enter unicode chars in the C\C++ Arduino code use the octal
equivalents e.g. <BR></FONT><FONT COLOR="#333333"><B>&#8457;  
\342\204\211<BR>&#8451;  \342\204\203</B></FONT></P>
<H3 CLASS="western"><FONT COLOR="#333333">UTF8converter.jar Program </FONT>
</H3>
<P><FONT COLOR="#333333">The </FONT><A HREF="https://www.forward.com.au/pfod/ArduinoProgramming/Languages/index.html" TARGET="_blank">UTF8converter.jar
program</A><FONT COLOR="#333333"> will convert between Unicode chars,
\u.... strings and octal.</FONT></P>
<P><FONT COLOR="#333333"><IMG SRC="pfodSpecificationV3.0.18_html_m3cf1eb2c.jpg" NAME="graphics66" ALIGN=BOTTOM WIDTH=567 HEIGHT=243 BORDER=0></FONT></P>
<P STYLE="font-style: normal"><BR><BR>
</P>
<H3 CLASS="western" STYLE="font-weight: normal">Restricted Characters
in Drawing's Labels and TouchActionInput dialogs</H3>
<P STYLE="font-style: normal; font-weight: normal">For Text Displays
in drawings, the text and units are automatically escaped with these
sequences.</P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">For </SPAN><SPAN STYLE="font-weight: normal">TouchActionInput </SPAN><SPAN STYLE="font-weight: normal">
dialog user text input, the user's input is automatically escapes { }
| ` ~   before sending to the pfodDevice and the
parser.getEditedText() method automatically un-escapes these.  </SPAN>
</P>
<P STYLE="font-style: normal; font-weight: normal">So for drawings
you can freely enter restricted chars into a TouchActionInput dialog
and also send restricted chars in labels.</P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Unicode
sequences \u.... are automatically converted as they are typed in to
a TouchActionInput dialog.  e.g. Typing in \u2109 will display  </SPAN><FONT COLOR="#333333"><B>&#8457;</B></FONT><SPAN STYLE="font-weight: normal">
 in the TouchActionInput dialog.</SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">To
send the text </SPAN><B>\u2109</B><SPAN STYLE="font-weight: normal">
instead of </SPAN><FONT COLOR="#333333"><B>&#8457;</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">,
enter </SPAN></FONT><FONT COLOR="#333333"><B>&amp;#92;u2109</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
 <BR>When the TouchActionInput loads an existing label for editing,
it converts </SPAN></FONT><FONT COLOR="#333333"><B>\u....</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
to </SPAN></FONT><FONT COLOR="#333333"><B>&amp;#92;u....</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
to maintain the text.</SPAN></FONT></P>
<P STYLE="font-style: normal"><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">You
can suppress the pfodDevice, pfodParser from escaping these chars by
calling </SPAN></FONT><FONT COLOR="#333333"><B>doNotEncode()</B></FONT><FONT COLOR="#333333"><SUB><B>
</B></SUB></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">e.g.
<BR></SPAN></FONT><FONT COLOR="#333333"><B>dwgsPtr-&gt;touchActionInput().doNotEncode().
&hellip;.  .send();</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal"><BR>and
<BR></SPAN></FONT><FONT COLOR="#333333"><B>dwgsPtr-&gt;label().doNotEncode().
&hellip;.  .send();</B></FONT></P>
<P STYLE="font-style: normal; font-weight: normal"><FONT COLOR="#333333">in
which case you must manually escape any restricted characters,
otherwise they are just silently discarded before sending.</FONT></P>
<H3 CLASS="western" STYLE="font-weight: normal">Restricted Characters
in String Input screens.</H3>
<P STYLE="font-weight: normal">For String Input screens there is not
automatic escaping on the input so you need to enter the escape
sequences manually.</P>
<P><SPAN STYLE="font-weight: normal">You almost never need to use
&amp;amp; or &amp;lt; or &amp;#92;.  The only time you need to &amp;lt;
is when you want to display one of the formatting codes to the user. 
For example to display </SPAN><B>&lt;u&gt;</B><SPAN STYLE="font-weight: normal">
to the user you would send </SPAN><B>&amp;lt;u&gt;</B><SPAN STYLE="font-weight: normal">.
 The only time you need to use &amp;amp; is when you want to display
one of the escape sequences.  For example to display </SPAN><B>&amp;#96;</B><SPAN STYLE="font-weight: normal">
to the user you would send </SPAN><B>&amp;amp;#96;</B></P>
<P STYLE="font-weight: normal">There are no other cases in which you
need to use &amp;lt; or &amp;amp;  For example the following text
does <B>NOT</B> need to be escaped</P>
<P STYLE="font-weight: normal"> <B>-3&lt;-1</B><BR><B>cats &amp;
dogs</B><BR><B>5&lt;&gt;4</B></P>
<P STYLE="font-weight: normal"><I>In general just send <B>&lt;</B>
and <B>&amp;</B> as normal characters.</I></P>
<P STYLE="font-style: normal; font-weight: normal">&amp;#92; the
escape for \ is only needed when you want to enter a Unicode
sequence, \u...., into a  String Input screen and NOT have it
automatically replaced with the Unicode char. 
</P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">For
example \u2109 when entered into a String Input screen will be
replaced with </SPAN></SPAN><FONT COLOR="#333333"><B>&#8457;</B></FONT>
<SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
in the String Input screen.  </SPAN></SPAN>
</P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">On
the other hand, because there is no automatic escape/unescape of
String Input screen text, if you want to enter </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>\u2109</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
as a 6 chars then use </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>&amp;#92;u2109</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
That will display as &amp;#92;u2109 in the String Input screen but
will be displayed as \u2109 in any </SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;displayString&gt;</SPAN></I></P>
<H2 CLASS="western">Non-display Character</H2>
<P><SPAN STYLE="font-style: normal">The \u0080 character is a
non-blank, </SPAN><SPAN STYLE="font-style: normal"><B>non-display
character</B></SPAN><SPAN STYLE="font-style: normal">. In the
pfodDesigner you can enter </SPAN><I><B>\u0080</B></I><SPAN STYLE="font-style: normal">.
 In C/C++ code you can use octal equivalent &ldquo;</SPAN><I><B>\302\200</B></I><SPAN STYLE="font-style: normal">&rdquo;.
 </SPAN>
</P>
<P><SPAN STYLE="font-style: normal">You almost never need to use this
character. However pfodApp will not display an empty (all white
</SPAN><SPAN STYLE="font-style: normal">space) prompt.  So you if you
want to show an empty prompt, you can set the prompt to </SPAN><I><B>\u0080</B></I><SPAN STYLE="font-style: normal">
in </SPAN><SPAN STYLE="font-style: normal">pfodDesignerV2 to force
pfodApp to show a blank prompt. You can still format this prompt with
format codes.</SPAN></P>
<H2 CLASS="western">Auto-termination of formatting tags</H2>
<P STYLE="font-style: normal; font-weight: normal">Tags are
automatically terminated at the end of the <I>&lt;title&gt;</I> or
<I>&lt;displayString&gt;</I>.<BR>Enclosed tags are automatically
terminated when any outer tag is terminated.</P>
<P STYLE="font-style: normal; font-weight: normal">Most of the time
you don't need to use the terminating tag &lt;/ ..&gt; as the pfodApp
will close the tags for you.</P>
<H3 CLASS="western">Examples of Auto-termination of formatting tags</H3>
<P><B>Example 1</B></P>
<P STYLE="font-style: normal; font-weight: normal">{,~Style
Examples|a~&lt;b&gt;Bold &lt;i&gt;Bold Italic &lt;u&gt;Bold Italic
Underlined}</P>
<P STYLE="font-style: normal; font-weight: normal">At the end of the
<I>&lt;displayString&gt;</I> <BR>	&lt;b&gt;Bold &lt;i&gt;Bold Italic
&lt;u&gt;Bold Italic Underlined <BR>the &lt;b&gt;, &lt;i&gt; and &lt;u&gt;
tags are automatically terminated. You do not need to the &lt;/b&gt;,
&lt;/i&gt; or &lt;/u&gt; tags, but you can add them if you want to.</P>
<P STYLE="font-style: normal"><B>Example 2</B></P>
<P STYLE="font-style: normal; font-weight: normal">{,~Style
Examples|a~&lt;b&gt;Bold &lt;i&gt;Bold Italic &lt;/b&gt;Normal}</P>
<P STYLE="font-style: normal; font-weight: normal">In the
<I>&lt;displayString&gt;</I> <BR>	&lt;b&gt;Bold &lt;i&gt;Bold Italic
&lt;/b&gt;Normal<BR>When the &lt;/b&gt; tag is processed, the
enclosed &lt;i&gt; tag is also automatically terminated.  But you can
add the &lt;/u&gt; if you want i.e.  &lt;b&gt;Bold &lt;i&gt;Bold
Italic <B>&lt;/i&gt;</B>&lt;/b&gt;Normal</P>
<H2 CLASS="western">Handling of Tag Errors</H2>
<P STYLE="font-style: normal; font-weight: normal">There are only two
types of tag errors:-</P>
<P STYLE="font-style: normal; font-weight: normal"><I>Unrecognised
Tags</I>,  e.g. &lt;B&gt;  it should be &lt;b&gt;  for bold</P>
<P STYLE="font-style: normal; font-weight: normal"><I>Unmatched
Termination </I>tags, termination tags where there is no
corresponding opening tag, e.g.   &lt;b&gt; &lt;/u&gt;  where there
is no corresponding preceding &lt;u&gt; that the &lt;/u&gt; tag can
terminate.</P>
<P STYLE="font-style: normal; font-weight: normal">In both cases the
tag in error is just displayed on the screen as part of the displayed
text so you can find it and correct it.</P>
<P STYLE="font-style: normal; font-weight: normal">e.g.  <BR>{,~Style
Examples|a~&lt;B&gt;Bold}<BR>displays as</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="boldErrorTag.png" NAME="graphics36" ALIGN=BOTTOM WIDTH=40% BORDER=0><BR>I.e.
the tag in error is just displayed where is appears in the message.</P>
<H2 CLASS="western" STYLE="page-break-before: always">Style Formats</H2>
<P>The following text style formats are available:-</P>
<P>&lt;u&gt;  &hellip;  &lt;/u&gt;   Underline<BR>&lt;b&gt;  &hellip;
 &lt;/b&gt;   Bold<BR>&lt;i&gt;   &hellip;  &lt;/i&gt;    Italic</P>
<P>These tags can be nested to give combined formats and can be
duplicated with out error, see the example below</P>
<H3 CLASS="western">Style Examples</H3>
<P>The menu item in this command</P>
<P>{,~Style Examples|a~&lt;b&gt;Bold\n&lt;i&gt;Bold Italic\n&lt;u&gt;Bold
Italic Underlined}</P>
<P>renders as</P>
<P><IMG SRC="bolditalicunderline.png" NAME="graphics35" ALIGN=BOTTOM WIDTH=40% BORDER=0>
</P>
<P>Example of duplicated style tags</P>
<P>{,~Style Examples|a~&lt;b&gt;Bold, &lt;b&gt;Bold tag again,&lt;/b&gt;
close bold tag and still Bold}<BR>displays as</P>
<P><IMG SRC="duplicateBoldTags.png" NAME="graphics37" ALIGN=BOTTOM WIDTH=40% BORDER=0>
</P>
<H2 CLASS="western">Font Size Formats</H2>
<P>The following text size formats are supported:-<BR>The positive
numbers increase the font size, the &ndash; numbers decrease the font
size.</P>
<P>&lt;+1&gt; &hellip; &lt;/+1&gt;, &lt;+2&gt; &hellip; &lt;/+2&gt;,
etc.<BR>&lt;-1&gt; &hellip; &lt;/-1&gt;, &lt;-2&gt; &hellip; &lt;/-2&gt;,
&lt;-3&gt; &hellip; &lt;/-3&gt;, etc.</P>
<P>Note: a + sign is manditory for positive font sizes  (I.e. &lt;3&gt;
is invalid as a font size, you must use &lt;+3&gt;).</P>
<P>The exact amount of increase and decrease is not defined, BUT the
increases and decreases must be logarithmic and must be reciprocal 
That is. for example, <BR>&lt;+1&gt;&lt;+1&gt; &hellip; &lt;/+1&gt;&lt;/+1&gt;
 must be equivalent to &lt;+2&gt; &hellip; &lt;/+2&gt;  and 
<BR>&lt;+3&gt;&lt;-1&gt;  &hellip;  &lt;/-1&gt;&lt;/+3&gt;  must be
equivalent to &lt;+2&gt; &hellip; &lt;/+2&gt;</P>
<P>In the sample pfodApp published by Forward Computing and Control
Pty. Ltd, <BR>&lt;+1&gt; increase the font size by x 1.1225 and &lt;+6&gt;
doubles the font size, &lt;+12&gt; four times font size etc. and<BR>&lt;-1&gt;
decreases the font size by x 0.8909, &lt;-6&gt; halves the font size
and &lt;-12&gt; quarters the font size etc. 
</P>
<H3 CLASS="western">Font Size Examples</H3>
<P>{,~Font Size Examples|a~A &lt;+2&gt;bigger&lt;/+2&gt; word}</P>
<P>renders as</P>
<P><IMG SRC="biggerWord.png" NAME="graphics38" ALIGN=BOTTOM WIDTH=40% BORDER=0><BR><BR><BR>
</P>
<P>then to make the whole menu item bigger 
</P>
<P>just add &lt;+3&gt; format to the front of the display text</P>
<P>{,~Font Size Examples|a~&lt;+3&gt;A &lt;+2&gt;bigger&lt;/+2&gt;
word}</P>
<P><IMG SRC="biggerbiggerWord.png" NAME="graphics39" ALIGN=BOTTOM WIDTH=40% BORDER=0>
</P>
<H2 CLASS="western">Font Colour Format</H2>
<P>Font colour is set by specifying the red, green and blue levels as
hex digit in the range 00 to FF (or 00 to ff)  OR buy the colour
number from the 256 colour palette.</P>
<P>e.g.<BR>&lt;FF0000&gt; &hellip;  &lt;/FF0000&gt;  is bright
red<BR>&lt;00FF00&gt; &hellip;  &lt;/00FF00&gt; is bright
green<BR>&lt;0000FF&gt; &hellip; &lt;/0000FF&gt; is bright blue</P>
<P>For convenience the following colour formats are predefined:-</P>
<P>&lt;bk&gt; .. &lt;/bk&gt;  is black (0), same as &lt;000000&gt; &hellip;
&lt;/000000&gt;<BR>&lt;m&gt; &hellip; &lt;/m&gt;  is maroon (1), same
as &lt;800000&gt; &hellip; &lt;/800000&gt;<BR>&lt;g&gt; &hellip; &lt;/g&gt;
 is green (2), same as &lt;008000&gt; &hellip; &lt;/008000&gt;<BR>&lt;o&gt;
&hellip; &lt;/o&gt;  is olive (3), same as &lt;808000&gt; &hellip;
&lt;/808000&gt;<BR>&lt;n&gt; &hellip; &lt;/n&gt;  is navy (4), same
as &lt;000080&gt; &hellip; &lt;/000080&gt;<BR>&lt;p&gt; &hellip; &lt;/p&gt;
is purple (5), same as &lt;800080&gt; &hellip; &lt;/800080&gt;<BR>&lt;t&gt;
&hellip; &lt;/t&gt; is teal (6), same as &lt;008080&gt; &hellip;
&lt;/008080&gt;<BR>&lt;s&gt; &hellip; &lt;/s&gt; is silver (7), same
as &lt;C0C0C0&gt; &hellip; &lt;/C0C0C0&gt;<BR>&lt;gy&gt; &hellip;
&lt;/gy&gt;  is grey (8), same as &lt;808080&gt; &hellip;
&lt;/808080&gt;<BR>&lt;r&gt; &hellip; &lt;/r&gt; is red (9), same as
&lt;FF0000&gt; &hellip; &lt;/FF0000&gt;<BR>&lt;l&gt; &hellip; &lt;/l&gt;
 is lime (10), same as &lt;00FF00&gt; &hellip; &lt;/00FF00&gt;<BR>&lt;y&gt;
&hellip; &lt;/y&gt; is yellow (11), same as &lt;FFFF00&gt; &hellip;
&lt;/FFFF00&gt;<BR>&lt;bl&gt; &hellip; &lt;/bl&gt;  is blue (12),
same as &lt;0000FF&gt; &hellip; &lt;/0000FF&gt;<BR>&lt;f&gt; &hellip;
&lt;/f&gt;  is fuchsia (13), same as &lt;FF00FF&gt; &hellip;
&lt;/FF00FF&gt;<BR>&lt;a&gt; &hellip; &lt;/a&gt;  is aqua (14), same
as &lt;00FFFF&gt; &hellip; &lt;/00FFFF&gt;<BR>&lt;w&gt; &hellip; &lt;/w&gt;
is white (15), same as &lt;FFFFFF&gt; &hellip; &lt;/FFFFFF&gt;</P>
<P>For font colours you use either colour names e.g. &lt;r&gt; or RGB
hex values e.g. &lt;FF0000&gt; or the palette number e.g. &lt;9&gt; 
(Note: font sizes have +/- in front of the number e.g. &lt;+9&gt; is
a font size)</P>
<P>This 256 colour palette table is courtesy of
<BR><A HREF="http://www.calmar.ws/vim/256-xterm-24bit-rgb-color-chart.html">http://www.calmar.ws/vim/256-xterm-24bit-rgb-color-chart.html</A></P>
<P>e.g.   to draw a filled circle with colour #00afff you can
use<BR><B>dwgsPtr-&gt;circle().color(39).filled().radius(8).send(); </B>
</P>
<P><IMG SRC="256ColorChart.png" NAME="graphics47" ALIGN=BOTTOM WIDTH=643 HEIGHT=724 BORDER=0></P>
<P><BR><BR>
</P>
<H3 CLASS="western">Black Or White Font Colour</H3>
<P>There is one special font colour &lt;bw&gt; &hellip; &lt;/bw&gt;. 
This will set the font colour to either Black or White which ever is
most visible against the current background colour.  This font colour
is almost never needed as it is the <B>default colour</B> for text
when one is not specified. See the Colour Selector in the
pfodDesignerV2 for an example of its use.</P>
<H3 CLASS="western">Font Colour Examples</H3>
<P>The message 
</P>
<P>{,~Font Colour Examples|a~A &lt;r&gt;red&lt;/r&gt; word}</P>
<P>is rendered as</P>
<P><IMG SRC="aRedWord.png" NAME="graphics41" ALIGN=BOTTOM WIDTH=40% BORDER=0><BR><BR><BR>
</P>
<P>then to make the menu item generally bright green, just add
&lt;00ff00&gt; or &lt;00FF00&gt; to the front of the <I>&lt;displayString&gt;</I></P>
<P>{,~Font Colour Examples|a~&lt;00ff00A&gt;&lt;r&gt;red&lt;/r&gt;
word} 
</P>
<P><IMG SRC="brightGreen_aRedWord.png" NAME="graphics40" ALIGN=BOTTOM WIDTH=40% BORDER=0>
</P>
<H2 CLASS="western">Background Colour Format</H2>
<P>One background colour can be set for the whole display text using
&lt;bg <I>font_color</I>&gt;</P>
<P>The background colour is set on the menu command.</P>
<P>e.g. &lt;bg r&gt; <BR>or  &lt;bg FF0000&gt; etc.</P>
<P>This format command NOT anywhere in the <I><SPAN STYLE="font-weight: normal">&lt;displayString&gt;</SPAN></I>.
 It must be set following the {, or {; command or the menu item's
<I>&lt;cmd&gt;</I> 
</P>
<P>There is no closing version of this format, i.e. &lt;/bg r&gt; is
an invalid tag and should not be used.</P>
<P>Note: pfodApp currently does not apply individual background
colour formats to single-selection and multi-selection items.</P>
<H3 CLASS="western">Background Colour Examples</H3>
<P>The message 
</P>
<P>{,~Background Colour Examples|a<B>&lt;bg bl&gt;</B>~A blue
background}</P>
<P>is rendered as</P>
<P><IMG SRC="blueBackground.png" NAME="graphics42" ALIGN=BOTTOM WIDTH=40% BORDER=0>
</P>
<P>To set a default background colour for the whole screen apply the
background colour to the menu or update command, i.e. 
</P>
<P>{,<B>&lt;bg bl&gt;</B>~Background Colour Examples|a~A blue
background}</P>
<H3 CLASS="western">Default Colours</H3>
<P>If you do not set font and background colours, pfodApp will apply
a default colour scheme, I.e. a black menu background, which becomes
the default background colour for all the menu items and <B>&lt;bw&gt;</B>
(contrasting black or white) for the prompt and the menu items's
text.</P>
<H3 CLASS="western">Setting the Sound to be Played</H3>
<P STYLE="font-weight: normal">The sound that is played is not
specified by the pfodDevice. The pfodDevice just sends &lt;ex s&gt;.
It is up to the pfodApp to play some sound.  The current pfodApp
defaults the sound to the default Notification Sound, but also allows
the user to set the sound to be played. The sound can be set
differently for different pfodDevices (connections).  To set the
sound for a Connection, in pfodApp open the connection for Editing
and then choose &ldquo;Sound Setting&rdquo; from the mobile's menu.</P>
<P STYLE="font-weight: normal">If a sound is not played, use Sound
Setting to set a sound.</P>
<H1 CLASS="western">pfodDevice Message Formats and Examples</H1>
<P>These commands are sent from the pfodDevice.  They are only sent
in response to a command sent by the pfodApp to the pfodDevice.</P>
<H2 CLASS="western">Empty Message format</H2>
<P><B>{}</B> <BR>This message is sent back by the pfodDevice when no
other command is appropriate. It indicates the last command set to
the pfodDevice has been received and acted on. Note: there are no
spaces between the <B>{}</B> 
</P>
<P>If the pfodDevice sends this message in response to a menu item
command or navigation direction command then the pfodApp is expected
to continue to display that menu or navigation input screen to allow
the user to make further selections.  In contrast, when the user's
input is sent by the pfodApp from a user input screen, then that
screen is dismissed.  What is displayed instead depends on what the
pfodDevice sends back.  Typically the pfodDevice sends back <B>{}</B>
and the pfodApp displays something it thinks is appropriate, e.g. the
last menu.  Otherwise the pfodApp displays what the pfodDevice sends.
 See <U>Navigation Guidelines</U> for recommend responses a
pfodDevice should send.</P>
<H2 CLASS="western">Current Time / Language Message format</H2>
<P STYLE="margin-bottom: 0cm"><B>{@</B> <I>[~&lt;language1&gt;][~&lt;yyyy/MM/dd
HH:mm:ss[.SSS]&gt;] [`&lt;ms_current&gt;] </I> <B>}</B></P>
<P>This message is sent by the pfodDevice in response to a
setLanguage, <B>{@</B> , message from the pfodApp.  The format and
language fields can be in either order.</P>
<P>The optional  <B>~</B><I>&lt;language&gt;</I> response can be
either omitted for the English language using UTF-8, or can be one of
the values from ISO 639-1. (see the examples below) 
</P>
<P>The optional  <I>~&lt;yyyy/MM/dd HH:mm:ss.SSS&gt;</I><SPAN STYLE="font-style: normal">
response provides the pfodDevice's current date and time at the time
the {@ response was sent.  The decimals for the seconds is optional.</SPAN></P>
<P><SPAN STYLE="font-style: normal">The optional `</SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">&lt;ms_current&gt;</SPAN></SPAN></I><SPAN STYLE="font-style: normal">
response provides  the pfodDevice's current milliseconds at the time
</SPAN><SPAN STYLE="font-style: normal">the {@ response was sent.</SPAN></P>
<P STYLE="margin-bottom: 0cm"><SPAN STYLE="font-weight: normal">In
all cases any of the following combinations:-<BR></SPAN><SPAN STYLE="font-weight: normal">
  </SPAN><I><SPAN STYLE="font-weight: normal">carriage return </SPAN></I><SPAN STYLE="font-weight: normal">(i.e.
0x0d)<BR>   </SPAN><I><SPAN STYLE="font-weight: normal">carriage
return + linefeed </SPAN></I><SPAN STYLE="font-weight: normal">(i.e.
0x0d 0x0a)<BR></SPAN><SPAN STYLE="font-weight: normal">   </SPAN><I><SPAN STYLE="font-weight: normal">linefeed
</SPAN></I><SPAN STYLE="font-weight: normal">(i.e. 0x0a)</SPAN></P>
<P STYLE="margin-bottom: 0cm; font-weight: normal">will represent a
new line sequence</P>
<P STYLE="font-weight: normal">The pfodDevice's response can have two
parts:- the language and the pfodDevice's 'current' time.</P>
<H3 CLASS="western">Optional Language part of the {@ response</H3>
<P>The pfodDevice Language part of the message <B>{@</B> indicates
which one of the preferred languages the pfodDevice can support and
all future messages in both directions will use these settings.</P>
<P>The pfodDevice is not required to support anything but the default
values described below but will honour the pfodApp's stated
preference if it can. 
</P>
<P>The pfodApp is required to support the default values but can also
support additional languages and request the pfodDevice to respond
using these, if the pfodDevice supports them.</P>
<P>The optional fields are preceded by ~  for languages. The values
are ordered by preference, with the most preferable listed first. 
e.g. <B>{@~fr~en &hellip; }</B></P>
<P><SPAN STYLE="font-weight: normal">The </SPAN><I><SPAN STYLE="font-weight: normal">&lt;language&gt;</SPAN></I><SPAN STYLE="font-weight: normal">
field defines the preferred language the pfodApp would like to
receive messages in. It can take values from ISO 639-1. If no value
is specified the pfodDevice's default language with a character set
of UTF-8, which includes the 7bit-ASCII character set is used.</SPAN></P>
<H3 CLASS="western">Optional 'Current' time part of the {@ response</H3>
<P>The optional 'current' time part of the responses are the <BR>the
pfodDevice's current milliseconds (<B>millis()</B> ) timestamp that
it will use for rawData timestamps<BR>and<BR>the current yearMonthDay
and Time if it will use YearMonthDay and Time as the timestamps for
its rawData. For example if the pfodDevice has an RTC (Real Time
Clock) or a GPS module to provide it date and time.</P>
<P>If the pfodDevice wants to plot data against date and time it MUST
respond to the <B>{@</B> command with its 'current' time.</P>
<H4 CLASS="western">Examples</H4>
<P>If the pfodApp sends <B>{@~fr~en}</B> then if the pfodDevice
response with:-</P>
<H4 CLASS="western"><B>Language Examples</B></H4>
<P><B>{@~fr~en}</B><SPAN STYLE="font-weight: normal"> requests the
pfodDevice communicate in preferable French or if French is not
supported then in English using UTF-8 as the character set. </SPAN>
</P>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
the empty </SPAN><B>{}</B><SPAN STYLE="font-weight: normal"> message
then it means the pfodDevice does not support setting languages. Only
the default language in UTF-8 is supported by the pfodDevice.  This
also means there is not 'current' time formation and so no date/time
plotting is available.</SPAN></P>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
the Language message </SPAN><B>{@~fr}</B><SPAN STYLE="font-weight: normal">
then all subsequent messages in both directions will take place in
French using UTF-8.</SPAN></P>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
the language message </SPAN><B>{@~en} </B><SPAN STYLE="font-weight: normal">then
all subsequent messages in both directions will take place in English
using UTF-8.</SPAN></P>
<P STYLE="font-weight: normal">Although not usually used, the
specification allows the pfodApp to send the setLanguageFormat
message at any time to request a change in language.  If the
pfodDevice supports the requested language, then the change to that
language occurs immediately after the pfodDevice sends its Language
message response indicating the language to be used.</P>
<H4 CLASS="western">'Current' Time examples</H4>
<P><B>{@}</B><SPAN STYLE="font-weight: normal"> requests the
pfodDevice''s 'current' time (and to communicate using the default
values as above)</SPAN></P>
<P STYLE="font-weight: normal">If the pfodDevice responds with an
empty {} response then this means there is not 'current' time
formation and so no date/time plotting is available.  The pfodApp
will ignore requests to plot data against date and time X-axis.  It
also means only the default language in UTF-8 is supported by the
pfodDevice.</P>
<H5 CLASS="western">Current milliseconds</H5>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
</SPAN><B>{@`</B><I><SPAN STYLE="font-weight: normal">&lt;ms_current&gt;</SPAN></I><B>}</B><SPAN STYLE="font-weight: normal">,
where </SPAN><I><SPAN STYLE="font-weight: normal">&lt;ms_current&gt;</SPAN></I><SPAN STYLE="font-weight: normal">
is the current value of the rawData millisecond timestamp at the time
the {@ response is sent, then that value together with the pfodApps
current date and time when the {@ response is received will be used
to plot data against date and time on the X-axis.</SPAN></P>
<P><SPAN STYLE="font-weight: normal">e.g. a response of
<BR></SPAN><B>{@`459906}</B><SPAN STYLE="font-weight: normal"><BR>indicates
that when the pfodDevice sent the </SPAN><B>{@</B><SPAN STYLE="font-weight: normal">
response, the current milliseconds where 459906<BR></SPAN><I><B>Note
the ` preceding the integer milliseconds</B></I></P>
<H5 CLASS="western">Current date and time 
</H5>
<P><SPAN STYLE="font-weight: normal">If the pfodDevice responds with
</SPAN><B>{@~</B><I><SPAN STYLE="font-weight: normal">&lt;yyyy/MM/dd
HH:mm:ss.SSS&gt;</SPAN></I><B>}</B><SPAN STYLE="font-weight: normal">
OR </SPAN><B>{@~</B><I><SPAN STYLE="font-weight: normal">&lt;yyyy/MM/dd
HH:mm:ss&gt;</SPAN></I><B>}</B><SPAN STYLE="font-weight: normal">.
This is the pfodDevice's current year month day and time all numeric,
at the time is sent the {@ response.  Then the pfodApp will use that
date and time to calculate the offset to the pfodApp's local time and
UTC time for plotting rawData using date and time timestamps against
time and date.  The current date and time can be sent with whole
seconds or fractions of a second down to 3 decimal places. </SPAN>
</P>
<P><SPAN STYLE="font-weight: normal">e.g. a response of<BR></SPAN><B>{@~2019/04/09
08:01:33.535}<BR></B><SPAN STYLE="font-weight: normal">indicates that
when the pfodDevice sent the </SPAN><B>{@</B><SPAN STYLE="font-weight: normal">
response, its current date and time were 2019/04/09 08:01:33.535  By
matching this data and time against pfodApp's date and time, pfodApp
can show plots of date and time time stamped rawData, in 'local' and
UTC time after adjusting for the difference between the pfodDevice's
time and the pfodApp time.<BR></SPAN><I><B>Note the ~ preceding the
string of date and time</B></I></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">A
response of <BR></SPAN><B>{@~2019/04/09 08:01:33`459906}<BR></B><SPAN STYLE="font-weight: normal">provides
both the current date and time and the current milliseconds.  Note:
In this example the current date and time only sends whole seconds.</SPAN></P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
you want to plot rawData that has millisecond timestamps against date
and time then the {@ </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">response
must return the current milliseconds `</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;ms_current&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">.</SPAN></SPAN></P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
you want to plot rawData that has date and time timestamps against
date and time then the {@ </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">response
must return the current date and time ~</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;yyyy/MM/dd
HH:mm:ss.SSS&gt; or </SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
~</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;yyyy/MM/dd
HH:mm:ss&gt;</SPAN></I></P>
<P><A HREF="#9.8.2.5.Date/Time Plots|outline"><I><SPAN STYLE="font-weight: normal">See
the plotting examples below for more details</SPAN></I></A></P>
<H2 CLASS="western">Back and Home Messages {&lt;} {&lt;&lt;}</H2>
<P>If the pfodDevice responds with the <B>{&lt;}</B> message, pfodApp
will go back to the previous menu.  <BR>If the pfodDevice responds
with the <B>{&lt;&lt;}</B> message, pfodApp will go back to the
main/home menu.  
</P>
<P>These messages can be sent in response to commands sent by menu
items and drawing touchZones to control the flow of pfodApp.</P>
<P><BR><BR>
</P>
<P><BR><BR>
</P>
<P>The example screen shots shown here are from an emulator for an
Android<SUP>TM</SUP> based pfodApp.</P>
<P><I><B>Note: The screen displays shown below are examples only.
This specification does not define how the messages are displayed to
the user.</B></I> 
</P>
<H2 CLASS="western">Menu Message  format  {,</H2>
<P>The menu message consists of {, followed by the screen background
colour, prompt text format, the prompt, the screen refresh time and
the menu version number.  Following this are the the menu items</P>
<P><B>{,</B><I><SPAN STYLE="font-weight: normal">[&lt;</SPAN></I><SPAN STYLE="font-style: normal"><B>bg</B></SPAN><I><SPAN STYLE="font-weight: normal">
colour&gt;][&lt;prompt format&gt;]</SPAN></I><I><B>~</B></I><I><SPAN STYLE="font-weight: normal">
&lt;title&gt;[ </SPAN></I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I><SPAN STYLE="font-weight: normal">
&lt;re-requestTime ms&gt;][~ &lt;version&gt;] [</SPAN></I><SPAN STYLE="font-weight: normal">
</SPAN><B>|</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">&lt;menu
items&gt;] *</SPAN></I><SPAN STYLE="font-weight: normal">  </SPAN><B>}</B></P>
<P STYLE="font-weight: normal">Where 
</P>
<P STYLE="font-weight: normal"><I>[</I><SPAN STYLE="font-style: normal"><B>&lt;bg</B></SPAN><I>
colour</I><SPAN STYLE="font-style: normal"><B>&gt;</B></SPAN><I>]</I><SPAN STYLE="font-style: normal">
set the default background colour for the whole menu. E.g &lt;bg r&gt;
sets a Red background. See the Font formatting above for the
available colours.</SPAN></P>
<P STYLE="font-weight: normal"><I>&lt;prompt format&gt;</I><SPAN STYLE="font-style: normal">
is the same as the &lt;itemFormats&gt; below but only apply to the
prompt.  Note the itemFormat </SPAN><SPAN STYLE="font-style: normal"><B>!</B></SPAN><SPAN STYLE="font-style: normal">
(</SPAN><I>disable</I><SPAN STYLE="font-style: normal">) does nothing
for a prompt.</SPAN></P>
<P STYLE="font-weight: normal"><I>&lt;title&gt;</I><SPAN STYLE="font-style: normal">
shown at the bottom of the screen. Can be empty</SPAN></P>
<P><I><SPAN STYLE="font-weight: normal">&lt;re-requestTime ms&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
is a request to the pfodApp to re-issue the command that returned
this menu in </SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;re-requestTime
ms&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
milliseconds time.  If missing or set to 0, then never re-request. 
This is used for menus that will change state at some time in the
future.</SPAN></SPAN></P>
<P STYLE="font-weight: normal"><I>&lt;version&gt;</I><SPAN STYLE="font-style: normal">
is the version of this menu.  It is a string consisting of only the
characters a .. z,  A .. Z, 0..9  . (dot) and _ (underscore). 
pfodApp will completely ignore a </SPAN><I>version</I><SPAN STYLE="font-style: normal">
that do not follow this format.  Any leading or trailing spaces are
trimmed by pfodApp.</SPAN></P>
<P STYLE="font-weight: normal">Where the | separates multiple menu
items as described below.</P>
<P STYLE="font-weight: normal">This is the simplest menu command
starts with <B>{,</B> and has an optional title and optional
re-request time and optional version number, followed by zero or more
menu items.</P>
<P STYLE="font-weight: normal">Menu items with empty <I>&lt;cmd&gt;</I>
(all white space) are ignored completely as are menu items with
duplicated commands.</P>
<P>Each menu item with in a menu must have a unique command,<I>&lt;cmd&gt;</I>,
associated with it. The <I>&lt;cmd&gt;</I> would normally also be
unique across all menus unless you want to perform the same action
from different menus.</P>
<P STYLE="font-weight: normal">Note: pfodApp does enforces the
uniqueness with in a menu by ignoring menu items with repeated
commands.</P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
the pfodDevice responds with to a menu command with an empty message
</SPAN></SPAN><SPAN STYLE="font-style: normal"><B>{}</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
the menu screen,  </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">remains
displayed for further input.  This is in contrast to other input
screens which are usually </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">dismissed
once the user's selection is sent to the pfodDevice.</SPAN></SPAN></P>
<H4 CLASS="western">Empty menu example</H4>
<P> <B>{,}</B>  an empty menu with no title. 
</P>
<P STYLE="font-style: normal; font-weight: normal">Not very useful. 
See more useful examples below.</P>
<H3 CLASS="western">Menu Items</H3>
<P STYLE="font-weight: normal">There are a variety of menu items. 
The two basic ones are Buttons and Labels.  To turn a button into a
label (which the user cannot interact with) just add ! In front of
the &lt;cmd&gt;</P>
<P STYLE="font-weight: normal">Note: the type of menu item, button,
label, etc is fixed by the menu response <B>{,</B> &hellip; and can
not be changed by a subsequent menu update response <B>{;</B> &hellip;
 This also means you don't need to send the extra type flag, e.g. !
for a label in the update response.</P>
<P STYLE="font-weight: normal">Menu Items Format</P>
<P STYLE="font-weight: normal">Menu Items have the general format of</P>
<P STYLE="font-weight: normal"><B>|</B><I>&lt;itemType&gt;&lt;cmd&gt;&lt;itemFormats&gt;</I><B>~</B><I>&lt;text&gt;</I><B>`</B><I>&lt;integer&gt;</I>
   &hellip;. 
</P>
<P STYLE="font-weight: normal">were <BR><I>&lt;itemType&gt;</I>  is
omitted for buttons/sliders <B>^</B> for navigation button or <B>+</B>
for Dwgs.  If the <I>&lt;itemType&gt;</I> contains <B>!</B> then then
the item is displayed as a label.  i.e No rounded boarder and can not
be clicked on by the user and never sends a command back to the
pfodDevice.</P>
<P STYLE="font-weight: normal"><I>&lt;cmd&gt;</I>  a series of
characters that pfodDevice recognises as a command name. <I>&lt;cmd&gt;</I>
either be a dot (.) or a string starting with an alpha (a..z A..Z) or
and underscore ( _ ) followed by  alphaNumeric (a..z A..Z 0..9) or
underscore ( _ ) chars. The dot (.) command will re-display the home
screen. <I>&lt;cmd&gt;</I> cannot have leading or trailing
whitespace.  Typically <I>&lt;cmd&gt;</I> is a single character to
simplify the receiving code in the pfodDevice.<BR>The <B>pfodAutoCmd</B>
pfodParser library class will generate up to 999 unique commands (c1
to c999).</P>
<P STYLE="font-weight: normal"><I>&lt;itemFormats&gt;</I> a mixture
of  'sticky' formatting and 'non-sticky' flags.</P>
<P STYLE="font-weight: normal"><I>The 'sticky' formatting</I>
consists of background colour, text style, colour and size as
described in <B>Text Formatting</B> above. This formatting is
conceptually added to the front of the this items text and is kept
across menu updates.  That is if you update this menu item, using the
menu update message, {;  then you do not need to resend these formats
in the update. See below for examples.</P>
<P STYLE="font-weight: normal"><I>The 'non-sticky' flags</I> modify
the behaviour of this item.  They are :-<BR>!  to disable this item  
<I><B>Note: This is ! AFTER &lt;cmd&gt;.  A ! before the &lt;cmd&gt;
marks the type of this item as label.</B></I><BR>-   to hide this
item. That is make it not visible<BR>+  to make this item flash<BR>@ 
to play the sound set for this connection. 
</P>
<P STYLE="font-weight: normal">These 'non-sticky' flags need to be
sent with the update for this menu item if you want to them to be
applied again.  Otherwise the item will be visible, enabled, not
flashing and silent.</P>
<P STYLE="font-weight: normal">Following the <I>&lt;itemFormats&gt;</I>
if any are the text and numbers defining this menu item. <B>~</B>
precedes text, including string representing floating point numbers. 
` precedes integers</P>
<H4 CLASS="western">Types of Menu Items</H4>
<P>In the following examples, a complete pfodDevice response is given
but only a cropped Dwg of the button is shown, not the whole screen.</P>
<H5 CLASS="western">Plain Labels</H5>
<P>Labels have  <SPAN STYLE="font-weight: normal">have a vertical bar
followed by the </SPAN><I><SPAN STYLE="font-weight: normal">&lt;itemType&gt;</SPAN></I><SPAN STYLE="font-weight: normal">
</SPAN><B>!  </B><SPAN STYLE="font-weight: normal"> and then the
</SPAN><I><SPAN STYLE="font-weight: normal">&lt;cmd&gt;</SPAN></I><SPAN STYLE="font-weight: normal">
and </SPAN><I><SPAN STYLE="font-weight: normal">&lt;itemFormats&gt; </SPAN></I><SPAN STYLE="font-weight: normal">,
i.e.</SPAN></P>
<P STYLE="font-style: normal; font-weight: normal"><SPAN STYLE="font-weight: normal">	</SPAN><B>|!</B><I>&lt;cmd&gt;&lt;itemFormats&gt;</I><B>~</B><I>[&lt;displayStrings&gt;]</I></P>
<P STYLE="font-style: normal; font-weight: normal">E.g.</P>
<P STYLE="font-style: normal; font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus<B>|!A&lt;bg bl&gt;~Label</B>}</P>
<P STYLE="font-style: normal; font-weight: normal">will display a
label with the text 'Label' on a blue background (&lt;bg bl&gt;) on a
dark blue menu background (&lt;bg 000040&gt;) 
</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="V2_Labelcropped.png" NAME="graphics9" ALIGN=BOTTOM WIDTH=383 HEIGHT=36 BORDER=0></P>
<H5 CLASS="western">Empty Labels as Spacers</H5>
<P STYLE="font-style: normal; font-weight: normal">To insert a spacer
between sections of the menu you can use an empty label either with
not background colour, in which case the menu background colour will
be used or with a background colour of your choice.  To adjust the
size of the spacer use the fontsize formatting.</P>
<P STYLE="font-style: normal; font-weight: normal">E.g.</P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus|A&lt;bg bl&gt;~Button 1</SPAN><B>|!B&lt;-20&gt;&lt;bg
w&gt;</B><SPAN STYLE="font-weight: normal">|C&lt;bg bl&gt;~Button 2}</SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">puts a thin white
spacer between two buttons.  The &lt;-20&gt; makes the font size very
small.</P>
<P STYLE="font-style: normal"><IMG SRC="V2_ThinSpacercropped.png" NAME="graphics10" ALIGN=BOTTOM WIDTH=383 HEIGHT=129 BORDER=0><SPAN STYLE="font-weight: normal"><BR></SPAN><BR><BR>
</P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus|A&lt;bg bl&gt;~Button 1</SPAN><B>|!B&lt;-4&gt;</B><SPAN STYLE="font-weight: normal">|C&lt;bg
bl&gt;~Button 2}</SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">puts a larger
spacer, with the same colour as the menu background, between two
buttons.  The &lt;-4&gt; sets a smaller then normal font size but not
very small.</P>
<P STYLE="font-style: normal"><IMG SRC="V2_FatSpacercropped.png" NAME="graphics11" ALIGN=BOTTOM WIDTH=383 HEIGHT=148 BORDER=0><SPAN STYLE="font-weight: normal"><BR></SPAN><BR><BR>
</P>
<H5 CLASS="western">Plain Text Buttons</H5>
<P STYLE="font-weight: normal">Plain text buttons just have a
vertical bar followed by the command and <I>&lt;itemFormats&gt; </I><SPAN STYLE="font-style: normal">and
</SPAN>an optional display text, i.e.</P>
<P STYLE="font-weight: normal">	<B>|</B><I>&lt;cmd&gt;&lt;itemFormats&gt;</I><B>~</B>
<I>[&lt;displayStrings&gt;]</I></P>
<P STYLE="font-weight: normal">Note: there is no space between the |
and the &lt;cmd&gt; and the ~  
</P>
<P STYLE="font-style: normal">E.g.</P>
<P STYLE="font-style: normal">{,&lt;bg 000040&gt;~V2 Menus<B>|A&lt;bg
bl&gt;~Button</B>}</P>
<P STYLE="font-style: normal">will display a button with the text
'Button' on a blue background (&lt;bg bl&gt;) on a dark blue menu
background (&lt;bg 000040&gt;) 
</P>
<P STYLE="font-style: normal"><IMG SRC="V2_TextButton_cropped.png" NAME="graphics48" ALIGN=BOTTOM WIDTH=383 HEIGHT=71 BORDER=0></P>
<P STYLE="font-style: normal">Clicking this button will send the
associated command back to the pfodDevice, e.g.</P>
<P STYLE="font-style: normal"><B>{A}</B></P>
<H5 CLASS="western">A Disabled Button</H5>
<P STYLE="font-style: normal">Adding a ! <I><B>after</B></I> the cmd,
 A, as in</P>
<P STYLE="font-style: normal">{,&lt;bg 000040&gt;~V2 Menus|<B>A!</B>&lt;bg
bl&gt;~Button}</P>
<P STYLE="font-style: normal">disables the button</P>
<P STYLE="font-style: normal"><IMG SRC="V2_DisabledTextButton_cropped.png" NAME="graphics4" ALIGN=BOTTOM WIDTH=383 HEIGHT=67 BORDER=0></P>
<P STYLE="font-style: normal">Clicking this button does nothing. To
enable this button respond to a refresh menu request with 
</P>
<P STYLE="font-style: normal"><B>{;|A}</B></P>
<P STYLE="font-style: normal">This menu update keeps all the existing
formats for the menu item whose <I><SPAN STYLE="font-weight: normal">&lt;cmd&gt;</SPAN></I>
is A but clears the 'non-sticky' flags.</P>
<P STYLE="font-style: normal">As shown above if you add the <B>!</B>
i<I><B>n front</B></I> of the command the item is turned into a label
instead.  You cannot change items types in a menu update so only the
menu item <I>&lt;cmd&gt;</I> is required to specify which item is
being updated.</P>
<H5 CLASS="western">A Hidden Button</H5>
<P STYLE="font-style: normal">Adding a - <I><B>after</B></I> the cmd,
 A, as in</P>
<P STYLE="font-style: normal">{,&lt;bg 000040&gt;~V2 Menus|<B>A-</B>&lt;bg
bl&gt;~Button}</P>
<P STYLE="font-style: normal">hides the button.</P>
<P STYLE="font-style: normal">The is not visible to the user and
cannot be clicked. To show the button again refresh the menu with 
</P>
<P STYLE="font-style: normal"><B>{;|A}</B></P>
<P STYLE="font-style: normal">This menu update keeps all the existing
formats for the menu item whose <I><SPAN STYLE="font-weight: normal">&lt;cmd&gt;</SPAN></I>
is A but clears the 'non-sticky' flags.</P>
<P STYLE="font-style: normal">As shown above if you add the <B>!</B>
i<I><B>n front</B></I> of the command the item is turned into a label
instead.  You cannot change items types in a menu update so only the
menu item <I>&lt;cmd&gt;</I> is required to specify which item is
being updated.</P>
<H5 CLASS="western">Toggle Buttons</H5>
<P>Toggle Buttons have two values specified and toggle between them.
The menu item format is</P>
<P STYLE="font-weight: normal">	<B>|</B><I>&lt;cmd&gt;&lt;itemFormats&gt;</I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I>&lt;idx&gt;</I>~
<I>[&lt;leadingText&gt;]</I><SPAN STYLE="font-style: normal"><B>~</B></SPAN><I>[&lt;trailingText&gt;]</I><SPAN STYLE="font-style: normal"><B>~</B></SPAN><I>&lt;textOption0&gt;</I><SPAN STYLE="font-style: normal"><B>\</B></SPAN><I>&lt;textOption1&gt;[</I><SPAN STYLE="font-style: normal"><B>~</B></SPAN><I>&lt;format&gt;]</I></P>
<P STYLE="font-style: normal; font-weight: normal">The &lt;idx&gt; is
either 0 or 1 and determines which text Option is displayed between
the leading and trailing text.<BR><I>&lt;format&gt;</I> can be <B>t</B>
or <B>s</B>  If <B>t</B> then only the text is displayed not the
slider.  If <B>s</B> then only the slider is displayed not the text</P>
<P STYLE="font-style: normal; font-weight: normal">e.g.</P>
<P STYLE="font-style: normal; font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus<B>|A&lt;bg bl&gt;`1~Button is in the ~
state~Off\\On</B>}</P>
<P STYLE="font-weight: normal"><I>Note the \\ between the two text
options inside the print string.  This is need 'escape' the \ char
inside a string.</I></P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="V2_ToggleButton_cropped.png" NAME="graphics50" ALIGN=BOTTOM WIDTH=383 HEIGHT=104 BORDER=0></P>
<P STYLE="font-style: normal; font-weight: normal">Clicking anywhere
in this button will toggle the setting and send the command with the
current setting idx, e.g. 
</P>
<P STYLE="font-style: normal; font-weight: normal">{A`1}</P>
<P STYLE="font-style: normal; font-weight: normal">The Off or On
appears between the leading text, <B>Button is in the</B> and the
trailing text <B>state</B>. Note the space in the command after
Button and before setting,  <B>Button is in the ~ state</B> so that
there is space around the Off and On in the final text.</P>
<P STYLE="font-style: normal; font-weight: normal">Add the <I>&lt;format&gt;</I>
<B>t</B> displays only the text part and hides the on/off slider.
Clicking on the button still toggles the setting.</P>
<P STYLE="font-style: normal; font-weight: normal">E.g.</P>
<P STYLE="font-style: normal; font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus<B>|A&lt;bg bl&gt;`1~Button is in the ~
state~Off\\On~t</B>}</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="V2_ToggleButton_TextOnly_cropped.png" NAME="graphics15" ALIGN=BOTTOM WIDTH=383 HEIGHT=53 BORDER=0><BR><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">Add the <I>&lt;format&gt;</I>
<B>s</B> displays only the slider part and text.</P>
<P STYLE="font-style: normal; font-weight: normal">E.g.</P>
<P STYLE="font-style: normal; font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus<B>|A&lt;bg bl&gt;`1~Button is in the ~
state~Off\\On~s</B>}</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="V2_ToggleButton_SliderOnly_cropped.png" NAME="graphics17" ALIGN=BOTTOM WIDTH=383 HEIGHT=61 BORDER=0></P>
<P STYLE="font-style: normal; font-weight: normal">All these versions
can be disabled by adding <B>!</B> <I><B>after</B></I> the &lt;cmd&gt;
A, i.e. |A!&lt;bg bl&gt;</P>
<H5 CLASS="western">Toggle Labels</H5>
<P STYLE="font-style: normal; font-weight: normal">Adding ! <I><B>in
front</B></I> of the &lt;cmd&gt; sets the <I>&lt;itemType&gt;</I> as
a label which the user cannot click. This label never sends a command
back to the pfodDevice.</P>
<P STYLE="font-style: normal; font-weight: normal">See the three
examples below. <I>Again </I>n<I>ote the \\ between the two text
options inside the print string.  This is need 'escape' the \ char
inside a string.</I></P>
<P STYLE="font-style: normal; font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus<B>|!A&lt;bg bl&gt;`1~Label is in the ~
state~Off\\On</B>}</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="V2_ToggleLabel.png" NAME="graphics19" ALIGN=BOTTOM WIDTH=383 HEIGHT=69 BORDER=0><BR><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus<B>|!A&lt;bg bl&gt;`1~Label is in the ~
state~Off\\On~t</B>}</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="V2_ToggleLabel_TextOnly_cropped.png" NAME="graphics21" ALIGN=BOTTOM WIDTH=383 HEIGHT=40 BORDER=0><BR><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus<B>|!A&lt;bg bl&gt;`1~Label is in the ~
state~Off\\On~s</B>}</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="V2_ToggleLabel_SliderOnly_cropped.png" NAME="graphics22" ALIGN=BOTTOM WIDTH=383 HEIGHT=32 BORDER=0><BR><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">The toggle label
does not accept user input but can be changed by a menu update to
change the display from on to off.</P>
<P STYLE="font-style: normal; font-weight: normal">For example the
following menu update will change the Toggle Label setting to Off</P>
<P STYLE="font-style: normal; font-weight: normal">{;|A`0}</P>
<H5 CLASS="western">Text Slider Buttons</H5>
<P STYLE="font-style: normal; font-weight: normal">Expanding on the
previous example, you can have more than just two text options.  Just
add more options</P>
<P STYLE="font-weight: normal">	<B>|</B><I>&lt;cmd&gt;&lt;itemFormats&gt;</I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I>&lt;idx&gt;</I>~
<I>[&lt;leadingText&gt;]</I><SPAN STYLE="font-style: normal"><B>~</B></SPAN><I>[&lt;trailingText&gt;]</I><SPAN STYLE="font-style: normal"><B>~</B></SPAN><I>&lt;textOption0&gt;</I><SPAN STYLE="font-style: normal"><B>\</B></SPAN><I>&lt;textOption1&gt;
&hellip; </I><SPAN STYLE="font-style: normal"><B>\</B></SPAN><I>&lt;textOptionN&gt;
[</I><SPAN STYLE="font-style: normal"><B>~</B></SPAN><I>&lt;format&gt;]</I></P>
<P STYLE="font-style: normal; font-weight: normal">The &lt;idx&gt;
ranges between 0 and (number of options -1) and determines which text
Option is displayed between the leading and trailing text.<BR><I>&lt;format&gt;</I>
can be <B>t</B> or <B>s</B>  If <B>t</B> then only the text is
displayed not the slider.  If <B>s</B> then only the slider is
displayed not the text</P>
<P STYLE="font-style: normal; font-weight: normal">This example has
three text options</P>
<P STYLE="font-style: normal; font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus<B>|A&lt;bg bl&gt;`1~Button is in the ~
state~Off\\Low\\High</B>}</P>
<P STYLE="font-weight: normal"><I>Note the \\ between the two text
options inside the print string.  This is need 'escape' the \ char
inside a string.</I></P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="V2_MultipleTextSliderButton_cropped.png" NAME="graphics1" ALIGN=BOTTOM WIDTH=383 HEIGHT=105 BORDER=0><BR><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">The user can move
the slider and the text will update with the current setting.  Moving
the slider also sends a command to the pfodDevice with the currently
selected index between 0 and (<I>number_of_options</I> -1)  e.g.</P>
<P STYLE="font-style: normal; font-weight: normal">{A`1}</P>
<P STYLE="font-style: normal; font-weight: normal">Again using the
<I>&lt;format&gt;</I> you can choose to display either only the text
or only the slider.</P>
<H5 CLASS="western">Text Slider Labels</H5>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Again
adding ! </SPAN></SPAN><I><B>in front</B></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
of the &lt;cmd&gt; makes this into a label which the user cannot
slide.  i.e. to display a setting the user cannot change.  Labels
never send a command back to the pfodDevice.</SPAN></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal"><I>Again </I>n<I>ote
the \\ between the two text options inside the print string.  This is
need to 'escape' the \ char inside a string.</I></P>
<P STYLE="font-style: normal; font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus<B>|!A&lt;bg bl&gt;`1~Button is in the ~
state~Off\\Low\\High</B>}</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="V2_MultipleTextSliderLabel_cropped.png" NAME="graphics2" ALIGN=BOTTOM WIDTH=383 HEIGHT=80 BORDER=0><BR><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">Again using the
<I>&lt;format&gt;</I> options you can choose to display just the text
or just the slider.</P>
<P STYLE="font-style: normal; font-weight: normal">The toggle label
does not accept user input but can be changed by a menu update to
change the display from to any of the text options.</P>
<P STYLE="font-style: normal; font-weight: normal">For example the
following menu update will change the Label setting to High</P>
<P STYLE="font-style: normal; font-weight: normal">{;|A`2}</P>
<H5 CLASS="western">Numeric Slider Buttons</H5>
<P STYLE="font-style: normal; font-weight: normal">You can also have
numeric sliders. The format is 
</P>
<P STYLE="font-weight: normal"><SPAN STYLE="font-style: normal"><B>|</B></SPAN><I>&lt;cmd&gt;&lt;itemFormats&gt;</I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I>&lt;currentValue&gt;</I><SPAN STYLE="font-style: normal">~</SPAN><I>[&lt;leadingText&gt;]</I><SPAN STYLE="font-style: normal"><B>~</B></SPAN><I>[&lt;trailingText&gt;]<BR></I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I>&lt;maxValue&gt;</I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I>&lt;minValue&gt;</I><SPAN STYLE="font-style: normal"><B>~</B></SPAN><I>&lt;maxScaleValue&gt;</I><SPAN STYLE="font-style: normal"><B>~</B></SPAN><I>&lt;minScaleValue&gt;</I></P>
<P STYLE="font-weight: normal"><SPAN STYLE="font-style: normal">The
</SPAN><I>&lt;maxValue&gt;</I><SPAN STYLE="font-style: normal"> and
</SPAN><I>&lt;minValue&gt;</I><SPAN STYLE="font-style: normal"> value
set the range of </SPAN><I>&lt;idx&gt;</I><SPAN STYLE="font-style: normal">
values the slider will display.</SPAN></P>
<P STYLE="font-weight: normal"><SPAN STYLE="font-style: normal">The
</SPAN><I>&lt;maxScaleValue&gt; </I><SPAN STYLE="font-style: normal">and
</SPAN><I>&lt;minScaleValue&gt;</I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
set how the current index will displayed in the text.  They must be
numbers in text form.  e.g. 5 or 5.0 or 5e-2 etc.  If you want a +
sign shown for the current scaled slider value, then at least one of
the </SPAN></SPAN><I><SPAN STYLE="text-decoration: none">scaleValues</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
must have a plus sign, i.e. +5 or +5.0</SPAN></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
For example (note here neither <I>scaleValues</I> ~5.0~-5.0 has a +
sign so the display will not show a +sign either)</P>
<P>{,&lt;bg 000040&gt;~V2 Numeric Slider~v1|A&lt;bg bl&gt;`40~Numeric
Slider ~%`100`0~5.0~-5.0}</P>
<P><IMG SRC="pfodSliderExample_cropped.png" NAME="graphics13" ALIGN=BOTTOM WIDTH=383 HEIGHT=106 BORDER=0><BR><BR><BR>
</P>
<P>Sets the command for this slider to A and current value as
40<BR>{,&lt;bg 000040&gt;~V2 Numeric Slider~v1|<B>A</B>&lt;bg
bl&gt;<B>`40</B>~Numeric Slider ~%`100`0~5.0~-5.0}</P>
<P>Sets the leading text to 'Numeric Slider '</P>
<P>{,&lt;bg 000040&gt;~V2 Numeric Slider~v1|A&lt;bg bl&gt;`40<B>~Numeric
Slider </B>~%`100`0~5.0~-5.0}</P>
<P>Sets the trailing text to '%'</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
{,&lt;bg 000040&gt;~V2 Numeric Slider~v1|A&lt;bg bl&gt;`40~Numeric
Slider <B>~%</B>`100`0~5.0~-5.0}</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
Limits the values sent to and from the pfodDevice to be in the range
max 100, min 0</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
{,&lt;bg 000040&gt;~V2 Numeric Slider~v1|A&lt;bg bl&gt;`40~Numeric
Slider ~%<B>`100`0</B>~5.0~-5.0}</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
And sets the display range to be max 5.0 min -5.0</P>
<P STYLE="font-weight: normal"><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">{,&lt;bg
000040&gt;~V2 Numeric Slider~v1|A&lt;bg bl&gt;`40~Numeric Slider
~%`100`0</SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><B>~5.0~-5.0</B></SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">}<BR><BR>That
is pfodApp will convert the value 40 in the range 0 to 100 into the
equivalent value in the range -5 to 5 using the formula</SPAN></SPAN></P>
<P STYLE="font-weight: normal"><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">Display
Value = </SPAN></SPAN><I><SPAN STYLE="text-decoration: none">&lt;minScaleValue&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
<BR>                          + (</SPAN></SPAN><I><SPAN STYLE="text-decoration: none">&lt;currentValue&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
- </SPAN></SPAN><I><SPAN STYLE="text-decoration: none">&lt;minValue&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">)
<BR></SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
                         * (</SPAN></SPAN><I><SPAN STYLE="text-decoration: none">&lt;maxScaleValue&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
- </SPAN></SPAN><I><SPAN STYLE="text-decoration: none">&lt;minScaleValue&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">)
/ (</SPAN></SPAN><I><SPAN STYLE="text-decoration: none">&lt;maxValue&gt;
</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><B>-
</B></SPAN></SPAN><I><SPAN STYLE="text-decoration: none">&lt;minValue&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">)</SPAN></SPAN></P>
<P>The user can move the slider and the text will update with the
current scaled display value.  Moving the slider also sends a command
back to the pfodDevice with the current (unscaled) value between
<I>&lt;minValue&gt;</I> and <I>&lt;maxValue&gt;,</I> in this example
between 0 and 100  e.g.</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
{A`40}</P>
<H5 CLASS="western">Numeric Slider Example sketch</H5>
<P STYLE="text-decoration: none">See <B>pfodSliderExample</B> in the
pfodParser examples directory.</P>
<P STYLE="text-decoration: none">The menu message is 
</P>
<PRE CLASS="western" STYLE="text-decoration: none"><FONT SIZE=2 STYLE="font-size: 9pt">{,&lt;bg 000040&gt;~V2 Numeric Slider~v1|A&lt;bg bl&gt;`40~Numeric Slider ~%`100`0~5.0~-5.0}</FONT></PRE><P STYLE="text-decoration: none">
<BR>This sets an long value, in the range 0 to 100, scaled at the
mobile by pfodApp to be displayed in the range -5.0 to +5.0.  As the
slider is moved pfodApp sends back the new setting in the range 0 to
100 using the command set for this button e.g.</P>
<P STYLE="text-decoration: none"><B>{A`40}</B></P>
<P STYLE="text-decoration: none">Note that this menu has a version
set <B>~v1</B> so pfodApp will cache this menu next time pfodApp
requests this main menu, pfodApp will send the version of the
currently cached menu.</P>
<P STYLE="text-decoration: none"><B>{v1:.}</B></P>
<P STYLE="text-decoration: none">i.e. <B>{</B><I>&lt;verson&gt;</I><B>:.}</B>
where the . (dot) is requesting the main menu. 
</P>
<P STYLE="text-decoration: none">If the version matches the
pfodDevice version setting then parser.isRefresh() will return true
and your code needs only send the menu updates, if any, rather then
the whole menu. Sub-menus and Dwgs can also have a version set.</P>
<P STYLE="text-decoration: none"><IMG SRC="pfodSliderExample.png" NAME="graphics12" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0><BR><BR><BR><BR>
</P>
<PRE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">/* ===== pfod Command for Numeric Slider Control ====</FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">{,&lt;bg 000040&gt;~V2 Numeric Slider~v1|A&lt;bg bl&gt;`40~Numeric Slider ~%`100`0~5.0~-5.0}</SPAN></FONT>
 <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">*/</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// Using Serial and 9600 for send and receive</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// Serial D0 (RX) and D1 (TX) on Arduino Uno, Micro, ProMicro, Due, Mega, Mini, Nano, Pro</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// This code uses Serial so remove Bluetooth shield when programming the board</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">/*</SPAN></FONT>
 <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">* (c)2016 Forward Computing and Control Pty. Ltd.</SPAN></FONT>
 <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">* NSW Australia, www.forward.com.au</SPAN></FONT>
 <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">* This generated code may be freely used for both private and commercial use</SPAN></FONT>
 <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">*/</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// ======================</SPAN></FONT>

<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">#include &lt;EEPROM.h&gt;</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">#include &lt;pfodParser.h&gt;</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">pfodParser parser(&quot;v1&quot;);  // need latest pfodParser library V2.31+</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// set menu and Dwg versions to &quot;v1&quot;</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// if version is not set then will never ask for a refresh of Dwg or menu</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// as neither will be cached.</SPAN></FONT>

<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">int sliderSetting = 40; // initial slider setting</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// the setup routine runs once on reset:</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">void setup() {</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">Serial.begin(9600);</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">for (int i = 3; i &gt; 0; i--) {</SPAN></FONT>
    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// wait a few secs to see if we are being programmed</SPAN></FONT>
    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">delay(1000);</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">}</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.connect(&amp;Serial); // connect the parser to the i/o stream</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">}</SPAN></FONT>

<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// the loop routine runs over and over again forever:</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">void loop() {</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">byte cmd = parser.parse(); // pass it to the parser</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// parser returns non-zero when a pfod command is fully parsed</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">if (cmd != 0) { // have parsed a complete msg { to }</SPAN></FONT>
    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">byte* pfodFirstArg = parser.getFirstArg(); // may point to \0 if no arguments</SPAN></FONT>
                                               <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// in this msg.</SPAN></FONT>
    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">long pfodLongRtn; // used for parsing long return arguments, if any</SPAN></FONT>
    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">if ('.' == cmd) {</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// pfodApp has connected and sent {.} , it is asking for the main menu</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// send back the menu designed</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">if (!parser.isRefresh()) {</SPAN></FONT>
        <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">sendMainMenu();</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">} else {</SPAN></FONT>
        <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">sendMainMenuUpdate();</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">}</SPAN></FONT>

      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// now handle commands returned from button/sliders</SPAN></FONT>
    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">} else if ('A' == cmd) { // user moved slider --</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.parseLong(pfodFirstArg, &amp;pfodLongRtn); // parse first arg as a long</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">sliderSetting = (int)pfodLongRtn; // set output</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">sendMainMenuUpdate(); // always send back a pfod msg otherwise pfodApp</SPAN></FONT>
                            <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// will disconnect.</SPAN></FONT>

    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">} else if ('!' == cmd) {</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// CloseConnection command</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">closeConnection(parser.getPfodAppStream());</SPAN></FONT>
    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">} else {</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// unknown command</SPAN></FONT>
      <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;{}&quot;)); // always send back a pfod msg otherwise pfodApp</SPAN></FONT>
                             <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// will disconnect.</SPAN></FONT>
    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">}</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">}</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">}</SPAN></FONT>

<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">void closeConnection(Stream *io) {</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// add any special code here to force connection to be dropped</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">}</SPAN></FONT>

<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">void sendMainMenu() {</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;{,&quot;));  // start a V2 Menu screen pfod message</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;&lt;bg 000040&gt;~V2 Numeric Slider&quot;)); // set background dark blue</SPAN></FONT>
                                                    <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// and the screen prompt</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.sendVersion(); // send ~version. </SPAN></FONT>
                          <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// Still ok to do this even if there is no version specified.</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;|A&lt;bg bl&gt;&quot;)); // set menu item cmd to A and background to blue</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;`&quot;)); // send ` before sliderSetting value</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(sliderSetting);  // send the current setting</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;~Numeric Slider ~%&quot;)); // send leading and trailing text,</SPAN></FONT>
                                         <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// note the space at the end of the leading text</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;`100`0~5.0~-5.0&quot;));  // send the data max and min and</SPAN></FONT>
                                       <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// the display max and min</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// pfodApp does the scaling from data to display</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;}&quot;));  // close pfod message</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">}</SPAN></FONT>

<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">void sendMainMenuUpdate() {</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;{;&quot;));  // start an V2 Update Menu pfod message</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;|A&quot;)); // update the menu item with cmd A</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;`&quot;)); // send ` before the current updated sliderSetting value</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(sliderSetting);  // send the current setting</SPAN></FONT>
  <FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">parser.print(F(&quot;}&quot;));  // close pfod message</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">}</SPAN></FONT>
<FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="en-AU">// ============ end of menu item ===========</SPAN></FONT>
</PRE><H5 CLASS="western" STYLE="text-decoration: none">
Numeric Slider Labels</H5>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
Again adding ! <B>in front</B> of the &lt;cmd&gt; makes this numeric
slider into a label which the user cannot slide.  i.e. to display a
setting the user cannot change.  This label never sends a command
back to the pfodDevice. e.g. 
</P>
<P><FONT SIZE=2 STYLE="font-size: 11pt"><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus~v1|</SPAN></SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><B>!A</B></SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">&lt;bg
bl&gt;`40~Numeric Slider Label ~%`100`0~5.0~-5.0}</SPAN></SPAN></SPAN></FONT></P>
<P><IMG SRC="pfodSliderLabel_cropped.png" NAME="graphics43" ALIGN=BOTTOM WIDTH=383 HEIGHT=80 BORDER=0>
<BR><BR><BR>
</P>
<H5 CLASS="western">Navigation Buttons</H5>
<P><SPAN STYLE="text-decoration: none">Adding a </SPAN><SPAN STYLE="text-decoration: none"><B>^</B></SPAN><SPAN STYLE="text-decoration: none">
in front of the a menu item command turns an ordinary button into one
of 5 navigation buttons.  (Note: Dwg Menu Items, below, provide a
much more flexiable means of adding buttons.)</SPAN></P>
<P STYLE="text-decoration: none">The Navigation buttons are groups of
up to 5 consecutive buttons each marked with ^ which are displayed as
Left, Right, Up, Down and Home buttons in a navigation row in the
menu.</P>
<P STYLE="text-decoration: none">For example 
</P>
<P STYLE="text-decoration: none"><FONT SIZE=2 STYLE="font-size: 11pt">{,&lt;bg
000040&gt;~V2 Menus|^A~Left Text|^B~Right Text|^C~Up Text|^D~Down
Text|^E~Home\nText}</FONT> 
</P>
<P STYLE="text-decoration: none">displays as</P>
<P STYLE="text-decoration: none"><IMG SRC="V2_NavigationBasicScreen.png" NAME="graphics44" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0><BR><BR><BR>
</P>
<P STYLE="text-decoration: none"><I><B>Note there is a newline
between Home and Text.  The Home key can display 2 short lines of
text.</B></I></P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
You can add other buttons and labels before and after this navigation
group and the display will scroll as necessary.</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
When you press any of the buttons, the associated command is sent to
the pfodDevice.  E.g. clicking the right button, the pfodApp sends
the command</P>
<P STYLE="font-style: normal; text-decoration: none"><B>{B}</B></P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
to the pfodDevice.</P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">You
can apply background and text colours to each button.  You also don't
need to display all 5 </SPAN></SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">buttons.
 You can hide the buttons you don't want by using the '-' flag after
</SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">&lt;cmd&gt;</SPAN></SPAN></I></P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
For example add a &ndash; after the A and B and E command hides the
Left and Right and Home buttons</P>
<P STYLE="text-decoration: none"><FONT SIZE=2 STYLE="font-size: 11pt">{,&lt;bg
000040&gt;~V2 Menus|</FONT><FONT SIZE=2 STYLE="font-size: 11pt"><B>^A-</B></FONT><FONT SIZE=2 STYLE="font-size: 11pt">~Left
Text|</FONT><FONT SIZE=2 STYLE="font-size: 11pt"><B>^B-</B></FONT><FONT SIZE=2 STYLE="font-size: 11pt">~Right
Text|^C~Up Text|^D~Down Text|^</FONT><FONT SIZE=2 STYLE="font-size: 11pt"><B>E-</B></FONT><FONT SIZE=2 STYLE="font-size: 11pt">~Home\nText}</FONT>
</P>
<P STYLE="font-style: normal; text-decoration: none"><IMG SRC="V2_NavigationBasicUpDownScreen.png" NAME="graphics45" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0><SPAN STYLE="font-weight: normal"><BR></SPAN><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
If you are hiding a button you don't need to provide any text and you
can use a dummy command because that button will never send a message
as long as it is hidden.  So the following message produces the same
screen as above</P>
<P STYLE="font-style: normal; text-decoration: none"><FONT SIZE=2 STYLE="font-size: 11pt"><SPAN STYLE="font-weight: normal">{,&lt;bg
000040&gt;~V2 Menus|</SPAN></FONT><FONT SIZE=2 STYLE="font-size: 11pt"><B>^d1-</B></FONT><FONT SIZE=2 STYLE="font-size: 11pt"><SPAN STYLE="font-weight: normal">|</SPAN></FONT><FONT SIZE=2 STYLE="font-size: 11pt"><B>^d2-</B></FONT><FONT SIZE=2 STYLE="font-size: 11pt"><SPAN STYLE="font-weight: normal">|^C~Up
Text|^D~Down Text|^</SPAN></FONT><FONT SIZE=2 STYLE="font-size: 11pt"><B>d3-</B></FONT><FONT SIZE=2 STYLE="font-size: 11pt"><SPAN STYLE="font-weight: normal">}</SPAN></FONT><SPAN STYLE="font-weight: normal">
</SPAN>
</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
Where d1, d2 and d3 are three unique dummy commands for the hidden
buttons.</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
As mentioned above navigation buttons are grouped up to 5 at a time. 
This grouping stops when any non-navigation menu item is found.</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
If you don't want to add another menu button you can use as small
spacer with the same colour as the menu background.  For example</P>
<P STYLE="font-style: normal; text-decoration: none"><B>|!s1&lt;-18&gt;</B></P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
will add an invisible spacer with a command of s1</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
For example 
</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
<FONT SIZE=2 STYLE="font-size: 11pt">{,&lt;bg 000040&gt;~V2
Menus|^A~Left|^B~Right|!s1&lt;-18&gt;|^d1-|^d2-|^C~Up|^D~Down} </FONT>
</P>
<P STYLE="font-style: normal; text-decoration: none"><FONT SIZE=2 STYLE="font-size: 11pt"><SPAN STYLE="font-weight: normal">Has
two navigation groups separated by a small spacer with terminates the
first group after |</SPAN></FONT><FONT SIZE=2 STYLE="font-size: 11pt"><B>^B~Right</B></FONT><SPAN STYLE="font-weight: normal">
</SPAN>
</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
This displays as 
</P>
<P STYLE="font-style: normal; text-decoration: none"><IMG SRC="V2_NavigationBasicTwoGroupsScreen.png" NAME="graphics46" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0><SPAN STYLE="font-weight: normal"><BR></SPAN><BR><BR>
</P>
<P STYLE="font-style: normal; text-decoration: none"><SPAN STYLE="font-weight: normal">The
pfodParser library has an example sketch, </SPAN><B>pfodNavigationExample.ino</B><SPAN STYLE="font-weight: normal">,
 that show other combinations of buttons.</SPAN></P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
<BR><BR>
</P>
<P STYLE="font-style: normal; text-decoration: none"><IMG SRC="V2_pfodNavigationExample.png" NAME="graphics49" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0><SPAN STYLE="font-weight: normal"><BR></SPAN><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
As with other menu items adding a <B>!</B> <I><B>in front</B></I> of
the <I>&lt;cmd&gt;</I> makes the navigation button into a label
instead.</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
<BR><BR>
</P>
<H5 CLASS="western" STYLE="page-break-before: always">Dwg Menu Item
Format</H5>
<P STYLE="font-style: normal; font-weight: normal">The format for the
Drawing menu item is 
</P>
<P STYLE="font-weight: normal"><SPAN STYLE="font-style: normal"><B>	|</B></SPAN><SPAN STYLE="font-style: normal">+</SPAN><I>&lt;cmd&gt;&lt;itemFormats&gt;</I><SPAN STYLE="font-style: normal">~</SPAN><I>&lt;loadCmd&gt;</I></P>
<P STYLE="font-weight: normal"><SPAN STYLE="font-style: normal">Where
the + preceding the </SPAN><I>&lt;cmd&gt;</I><SPAN STYLE="font-style: normal">
indicates that this is an Drawing row. </SPAN>
</P>
<P STYLE="font-weight: normal"><I>&lt;loadCmd&gt;</I><SPAN STYLE="font-style: normal">
is the command pfodApp will send when requesting the Dwg data from
the pfodDevice. See examples below.  Internally pfodApp stores the
Dwgs in a local file under the file name 
</SPAN><SPAN STYLE="font-style: normal"><B>I</B></SPAN><SPAN STYLE="font-style: normal">&lt;connectionRowId&gt;_&lt;loadCmd&gt;
where the &lt;connectionRowId&gt; is the row number of this
connection in the pfodApp's connection database.</SPAN></P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">For
example as shown in the above examples<BR></SPAN></SPAN><SPAN STYLE="font-style: normal"><B>{</B></SPAN><B>,|+A~x}</B></P>
<P>defines a menu with no prompt and just one menu item, an Drawing
menu item with menu item cmd, <B>A</B> and Drawing load cmd, <B>x</B></P>
<H4 CLASS="western">Reuse of Drawings</H4>
<P STYLE="font-style: normal; font-weight: normal">Drawings can be
re-used in other menu items in the same or other menus, by using the
same <I>&lt;loadCmd&gt;</I>, but only for the same pfodDevice.  If
you specify a version string, the cache of Drawings (and menus) is
kept after you close the connection and used the next time you
connect to that pfodDevice.</P>
<H4 CLASS="western">Switching Dwgs</H4>
<P STYLE="font-style: normal; font-weight: normal">There are two
simple ways of switching Dwgs :-<BR>i) Have two Drawing rows in the
menu and hide/show the one you want via menu updates<BR>ii) Have one
Drawing row in the menu and update the menu to change the <I>&lt;loadCmd&gt;</I>
which will force the other Dwg to be loaded and displayed, or just
displayed if it is already cached.</P>
<H4 CLASS="western">Drawing Version and the isRefresh() flag</H4>
<P STYLE="font-style: normal; font-weight: normal">parser.<B>sendVersion()</B>;<BR>parser.<B>sendRefreshAndVersion</B>(
<I>msec</I> )</P>
<P STYLE="font-style: normal; font-weight: normal">Each Drawing can
have a <I>&lt;version&gt;</I> assigned to it.  That is parser version
is used for the drawing version, i.e.</P>
<PRE CLASS="western">void sendDrawing_z() {
  dwgs.start(50, 30);
  parser.sendVersion(); <BR> . . .</PRE><P>
<SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal"><BR></SPAN></SPAN></SPAN><SPAN LANG="en-AU"><I><B>The
drawing version, if specified, must be the same and the menu version.</B></I></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">When pfodApp uses
the <I>&lt;loadCmd&gt;</I> to re-request the Dwg data, if there is
already a cached Drawing then the pfodApp will precede the <I>&lt;loadCmd&gt;</I>
with <I>&lt;version&gt;</I><B>:</B> 
</P>
<P STYLE="font-style: normal; font-weight: normal">e.g.  if the
drawing was used in the menu row</P>
<P STYLE="font-style: normal; font-weight: normal">|+A~c</P>
<P STYLE="font-style: normal; font-weight: normal">then when pfodApp
first requests the drawing data, (see loading below) it omits the
version since there is no cached drawing, e.g. 
</P>
<P STYLE="font-style: normal"><B>{c`0}</B></P>
<P STYLE="font-style: normal; font-weight: normal">but when is
already has a cached drawing and pfodApp is requesting a reload of
the drawing data it adds the version string e.g.</P>
<P STYLE="font-style: normal"><B>{v1:c`0}</B></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
you do not specify an Drawing </SPAN><I><SPAN STYLE="font-weight: normal">&lt;version&gt;</SPAN></I><SPAN STYLE="font-weight: normal">
then your code will be expected to send the complete drawing data
each time the </SPAN><I><SPAN STYLE="font-weight: normal">&lt;loadCmd&gt;</SPAN></I><SPAN STYLE="font-weight: normal">
is received.  </SPAN>
</P>
<P><I><B>It is recommended that you always set a </B><SPAN STYLE="font-weight: normal">&lt;version&gt;</SPAN><B>
for Dwgs once you have finished your development</B></I></P>
<P STYLE="font-style: normal; font-weight: normal">In the same way
menu versions are parsed in the pfodParser library, if the version
string matches the version string the parser was created with, then
the <B>isRefresh()</B> flag is set.  
</P>
<P><I><B>The parser.isRefresh() flag should be tested to see if this
is a refresh of an existing cached Drawing or an initial load.</B></I></P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
parser.isRefresh() returns false then you should send the whole
initial drawing.  If parser.isRefresh() returns true then you can
either ignore it (and send an empty response  </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>{
}</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
)or send an update to the existing drawing.</SPAN></SPAN></P>
<H4 CLASS="western">Loading and Reloading Dwgs, Refresh Time.</H4>
<P><I>Note:</I> <SPAN STYLE="font-style: normal"><B>The total bytes
in any one response must be less then 1024 including the opening and
closing { }</B></SPAN></P>
<P>When pfodApp displays a menu that has an Drawing row, pfodApp
checks if it has already an drawing cached under that <I>&lt;loadCmd&gt;</I>
for this connection,.  If it has the drawing, pfodApp displays it and
requests a refresh, otherwise pfodApp starts a background process to
request the entire drawing.</P>
<P>pfodApp request the entire drawing by sending a series of requests
to the pfodDevice using the <I>&lt;loadCmd&gt; </I>with and a
<I>&lt;startingOffset&gt;</I> which starts at 0 and increments for
each request for more drawing data.</P>
<P>E.g. for the Drawing menu row</P>
<P>|+A~c</P>
<P>if pfodApp does not already have <B>c</B> Drawing then, in the
background, pfodApp sends the command</P>
<P><B>{c`0}</B></P>
<P>to request the Drawing data. The <I>&lt;startingOffset&gt;</I> of
0 indicates this is the first load request for this Drawing, this
time.</P>
<P>The pfodDevice can respond either by defining a new Drawing OR
update an existing Drawing. 
</P>
<H4 CLASS="western">Forcing an Drawing to be re-loaded from the
pfodDevice.</H4>
<P>To force a reload of an Drawing send the <I>&lt;cmd&gt;</I> for
that Drawing row again in a menu update message <B>{;</B> 
</P>
<P>That is send <B>{;|</B><I>&lt;cmd&gt;</I><B>}</B></P>
<P><B>{;|A}</B></P>
<P>This forces a reload of the Drawing associated with that row. 
</P>
<P>If pfodApp already has this Drawing cached then pfodApp will
request a refresh using the cached Drawing's version  , e.g. if the
cached Dwg's version is <B>v1</B> pfodApp will send</P>
<P><B>{v1:c`0}</B></P>
<P>to request a reload of this Dwg.</P>
<P>If you updated the menu row with a new, different <I>&lt;loadCmd&gt;</I>
you can replace the existing Dwg with another one. 
</P>
<P>To disable an Dwg with out reloading it just use  {;|<I><SPAN STYLE="font-weight: normal">&lt;cmd&gt;</SPAN></I>!}
e.g. <B>{;|A!}  <BR></B><SPAN STYLE="font-weight: normal">To hide the
Dwg use  </SPAN><B>{;|A-}</B></P>
<H4 CLASS="western">Automatic Drawing Reloads</H4>
<P>Drawings can also have automatic reload time specified, separate
from the menu reload, i.e. to reload the z drawing every 5sec (5000
ms) without reloading the entire menu use</P>
<PRE CLASS="western">void sendDrawing_z() {
  dwgs.start(50, 30);
  parser.sendRefreshAndVersion(5000); <BR> . . .</PRE><P>
<I><B>Note: There must be a non-empty menu version for drawing reload
to work.</B></I></P>
<P STYLE="font-style: normal; font-weight: normal">If the drawing
update includes an insertDwg( ) statement then the inserted drawing
is also reloaded.</P>
<H4 CLASS="western"></H4>
<H2 CLASS="western">Drawing Menu Items</H2>
<P><IMG SRC="DrawingPrimitives.png" NAME="graphics51" ALIGN=BOTTOM WIDTH=378 HEIGHT=392 BORDER=0><BR><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">You can create
your own custom controls with the drawing primitives, see the on-line
tutorial, <B>pfodControls</B> at <A HREF="http://www.pfod.com.au/">www.pfod.com.au</A>
</P>
<P STYLE="font-style: normal; font-weight: normal">Displaying
Drawings is a two step process.  First you need to define a menu item
that will show the Drawing.  The <I>&lt;itemType&gt;</I> is <B>+</B>
for this menu item, or !+ or +! for the label (non-interactive)
version.  This Drawing menu item has it usual associated command and
in addition specifies an Drawing <I>&lt;loadCmd&gt;</I> which pfodApp
sends when it want to load or reload the Drawing. The drawing loading
takes place in the background. 
</P>
<P STYLE="font-style: normal; font-weight: normal">You need to add
code in your pfodDevice to serve up the drawing when the pfodApp
sends the drawing <I>&lt;loadCmd&gt; </I> 
</P>
<P STYLE="font-style: normal; font-weight: normal">The pfodParser
library for Arduino includes a pfodDwgs class that simplifies
building dwg messages.</P>
<P STYLE="font-style: normal; font-weight: normal">At the top of the
sketch after declaring the parser add the line</P>
<PRE CLASS="western">pfodDwgs dwgs(&amp;parser);  // drawing support<BR></PRE><P STYLE="font-style: normal; font-weight: normal">
to declare the dwg class object.  The examples in this section assume
this line has been added.</P>
<P STYLE="font-style: normal; font-weight: normal">The pfodDwgs class
includes may methods that can be used to build and send drawing
primitives.  See below for examples</P>
<H3 CLASS="western">A Simple Dwg Example</H3>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="pfodSpecificationV3.0.18_html_469be16e.jpg" NAME="graphics55" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0>
  
</P>
<P STYLE="font-style: normal; font-weight: normal">This drawing menu
item is a 50 x 50 dwg (width x height) with just a red and blue
rectangle.<BR>(See <B>SimpleDwgExample_ESP8266</B> sketch in the
pfodParser library examples)</P>
<PRE CLASS="western">
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">pfodParser parser(&quot;V1&quot;); // create a parser with menu version string to handle the pfod messages</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">pfodDwgs dwgs(&amp;parser);  // drawing support</SPAN></FONT>
&hellip; &hellip;
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">void loop() {</SPAN></FONT>
&hellip; &hellip;
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">uint8_t cmd = parser.parse(); // parse incoming data from connection</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// parser returns non-zero when a pfod command is fully parsed</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">if (cmd != 0) { // have parsed a complete msg { to }</SPAN></FONT>
      <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">if ('.' == cmd) {</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// pfodApp has connected and sent {.} , it is asking for the main menu</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">if (!parser.isRefresh()) {</SPAN></FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">sendMainMenu(); // send back the menu designed</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">} else {</SPAN></FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">sendMainMenuUpdate(); // menu is cached just send update</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>

      <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">} else if ('A' == cmd) { // user touched menu Item A</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.print(F(&quot;{}&quot;)); // finished, always send back a response or pfodApp will timeout</SPAN></FONT>

      <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">} else if ('a' == cmd) { // request for dwg 'a'</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">if (parser.isRefresh()) { //if refresh  just send update</SPAN></FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">sendDrawingUpdates();</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">} else {                  // else send whole dwg</SPAN></FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">long pfodLongRtn = 0;</SPAN></FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">uint8_t* pfodFirstArg = parser.getFirstArg();</SPAN></FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.parseLong(pfodFirstArg, &amp;pfodLongRtn);</SPAN></FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">sendDrawing(pfodLongRtn);</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>

      <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">} else if ('!' == cmd) {  // CloseConnection command</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">closeConnection(parser.getPfodAppStream());</SPAN></FONT>
      <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">} else { // unknown command</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.print(F(&quot;{}&quot;)); // always send back a pfod msg</SPAN></FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// otherwise pfodApp will disconnect.</SPAN></FONT>
      <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>

&hellip; &hellip;

<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">void sendMainMenu() {</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.print(F(&quot;{,~Simple Dwg Example&quot;)); // start a Menu screen pfod message</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.sendRefreshAndVersion(0); // send the menu version, no refresh</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.print(F(&quot;|+A~a&quot;));   // send menu items</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.print(F(&quot;}&quot;)); // close pfod message</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>

<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">void sendMainMenuUpdate() {</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.print(F(&quot;{;&quot;)); // start an Update Menu pfod message</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.print(F(&quot;|A&quot;));   // send menu items updates, this updates dwg </SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.print(F(&quot;}&quot;)); // close pfod message</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>


<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">void sendDrawing_a(long dwgIdx) { // send parts of dwg.</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">if (dwgIdx == 0) { // first part of dwg</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.start(50, 50, dwgs.WHITE, true); // true means more dwg to come</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.sendRefreshAndVersion(0); // send the menu version, no dwg refresh</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.pushZero(0, 0, 1.0); // change zero point and scale factor, if needed</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.rectangle().color(dwgs.BLUE).size(40, 40).offset(5, 5).send();</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.rectangle().color(dwgs.RED).size(30, 30).offset(10, 10).send();</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.popZero(); // restore previous zero setting</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.end();</SPAN></FONT>

  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">} else if (dwgIdx == 1) { // second part of dwg if larger then 1024 bytes</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.startUpdate(false); // false means no more parts</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// nothing here but could add more dwg items</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.end();</SPAN></FONT>

  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">} else {</SPAN></FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.print(F(&quot;{}&quot;)); // always return something</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>

<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">void sendDrawingUpdates_a() {</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// no updates here Note: need start/end to redisplay dwg on re-connection</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.startUpdate();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.end();</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>

</PRE><P>
The drawing menu item is <BR><I><B>  parser.print(F(&quot;|+A~a&quot;));
 </B></I> <BR><B>+</B> indicates a dwg menu item <B>A</B> is the menu
command and <B>~a</B> is the dwg load command, <B>a</B></P>
<P>When pfodApp processes this menu item, it automatically sends the,
in the background, the dwg load command  <B>{a`0}</B> to load the
first part of the drawing to be displayed in this menu item.</P>
<P>In the command processing code, this section deals with the 'a'
command</P>
<PRE CLASS="western">      <FONT SIZE=2>} else if ('a' == cmd) { // request for dwg 'a'</FONT>
        <FONT SIZE=2><SPAN LANG="en-AU">if (parser.isRefresh()) { //if refresh  just send update</SPAN></FONT>
          <FONT SIZE=2><SPAN LANG="en-AU">sendDrawingUpdates_a();</SPAN></FONT>
        <FONT SIZE=2><SPAN LANG="en-AU">} else {                  // else send whole dwg</SPAN></FONT>
          <FONT SIZE=2><SPAN LANG="en-AU">long pfodLongRtn = 0;</SPAN></FONT>
          <FONT SIZE=2><SPAN LANG="en-AU">uint8_t* pfodFirstArg = parser.getFirstArg();</SPAN></FONT>
          <FONT SIZE=2><SPAN LANG="en-AU">parser.parseLong(pfodFirstArg, &amp;pfodLongRtn);</SPAN></FONT>
          <FONT SIZE=2><SPAN LANG="en-AU">sendDrawing_a(pfodLongRtn);</SPAN></FONT>
        <FONT SIZE=2><SPAN LANG="en-AU">}</SPAN></FONT>
</PRE><P>
The code retrieves the argument to the of the <B>{a</B> command.  In
this case <B>0</B> which pfodApp sent to request the first part of
the dwg, and calls sendDrawing(0) to send that part.</P>
<P><BR><BR>
</P>
<PRE CLASS="western">
<FONT SIZE=2><SPAN LANG="en-AU">void sendDrawing(long dwgIdx) { // send parts of dwg.</SPAN></FONT>
  <FONT SIZE=2><SPAN LANG="en-AU">if (dwgIdx == 0) { // first part of dwg</SPAN></FONT>
    <FONT SIZE=2><SPAN LANG="en-AU">dwgs.start(50, 50, dwgs.WHITE, true); // true means more dwg to come</SPAN></FONT>
    <FONT SIZE=2><SPAN LANG="en-AU">parser.sendRefreshAndVersion(0); // send the menu version, no dwg refresh</SPAN></FONT>
    <FONT SIZE=2><SPAN LANG="en-AU">dwgs.pushZero(0, 0, 1.0); // change zero point and scale factor, if needed</SPAN></FONT>
    <FONT SIZE=2><SPAN LANG="en-AU">dwgs.rectangle().color(dwgs.BLUE).size(40, 40).offset(5, 5).send();</SPAN></FONT>
    <FONT SIZE=2><SPAN LANG="en-AU">dwgs.rectangle().color(dwgs.RED).size(30, 30).offset(10, 10).send();</SPAN></FONT>
    <FONT SIZE=2><SPAN LANG="en-AU">dwgs.popZero(); // restore previous zero setting</SPAN></FONT>
    <FONT SIZE=2><SPAN LANG="en-AU">dwgs.end();</SPAN></FONT>
</PRE><P>
This dwg.start( ) msg defines a drawing, 50 x 50 with a WHITE
background and more msgs to follow. The dwg version is the same as
the parser and 0 refresh turns off automatic re-request for this dwg.
 The pushZero statement actually does nothing in this case, but can
be used to move the zero and scaling of the following rectangle
statements.</P>
<P>This code sends back the response to pfodApp to create the dwg</P>
<PRE CLASS="western" STYLE="margin-bottom: 0.5cm; font-style: normal; font-weight: normal; widows: 2; orphans: 2"><FONT COLOR="#000000">{+15`50`50~m`0~V1|z~0~0|r~12~40~40~5~5|r~9~30~30~10~10|z}</FONT></PRE><P>
<SPAN LANG="en-AU">Since there is a more parts indicator (i.e. </SPAN><SPAN LANG="en-AU"><B>~m</B></SPAN><SPAN LANG="en-AU">),
pfodApp knows to ask for the next part of this dwg and sends dwg load
command </SPAN><SPAN LANG="en-AU"><B>{a`1}</B></SPAN><SPAN LANG="en-AU">
and so on until either the returned dwg msg is empty,  </SPAN><SPAN LANG="en-AU"><B>{+}</B></SPAN><SPAN LANG="en-AU">
or an empty message is returned, </SPAN><SPAN LANG="en-AU"><B>{}</B></SPAN><SPAN LANG="en-AU">
or  for the dwg message is missing the more parts indicator.</SPAN></P>
<P><SPAN LANG="en-AU">Once this V1 version of the dwg has been
loaded, pfodApp caches it and next time the pfodApp connects or
reload the menu item, it send the dwg load msg </SPAN><SPAN LANG="en-AU"><B>{V1:a`0}</B></SPAN><SPAN LANG="en-AU">
The parser checks the V1 against the current parser version and if it
matches the isRefresh() returns true.  This tells the code the dwg is
already cached and only the updates, if any, need to be sent.  In the
example there are not updates.</SPAN></P>
<H3 CLASS="western"></H3>
<H3 CLASS="western" STYLE="page-break-before: always">Scaling
Drawings for display.</H3>
<P><SPAN LANG="en-AU"><SPAN STYLE="font-weight: normal">dwgs.</SPAN></SPAN><B><SPAN LANG="en-AU">start(cols,
rows, backgroundColor = dwgs.WHITE, moreData = 0);</SPAN></B></P>
<P>In the previous example the drawing was 50 (cols) x 50 (rows)
drawing.  When pfodApp displays a drawing, it automatically scales it
to fit the available screen space.  In this case, as shown above the
drawing is scaled to fit the width of the screen.  However if the
drawing is longer than the available space on the screen, it is
scaled down to ensure the entire drawing is visible on one screen. 
E.g.  50 x 100 
</P>
<P><IMG SRC="pfodSpecificationV3.0.18_html_m32a7c9ae.jpg" NAME="graphics52" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0></P>
<P>For example in the above code, changing the drawing from a 50 x 50
<BR>  dwgs.start(50, <B>50</B>, dwgs.WHITE, false); <BR>to a 50 x 100
dwg<BR>  dwgs.start(50, <B>100</B>, dwgs.WHITE, false); <BR>displays
scaled down so that the height fits on the screen. 
</P>
<P>This results in the width being scaled down as well to maintain
the aspect ratio.</P>
<P>When an image will be scaled down depends on how much space the
prompt takes up on the screen and on the screen aspect ratio of the
particular mobile phone.  It does not depend on the screen resolution
or overall screen size of the mobile phone.</P>
<P STYLE="font-style: normal; font-weight: normal">Note that you can
have more than one Drawing menu item per menu, so if you need more
space for your drawing controls you can add another drawing menu
item.</P>
<H3 CLASS="western">Drawing Size &ndash; How to Choose</H3>
<P><IMG SRC="pfodSpecificationV3.0.18_html_6a1f4993.png" NAME="graphics53" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0>
<IMG SRC="pfodSpecificationV3.0.18_html_m79061d8e.png" NAME="graphics54" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0></P>
<P STYLE="font-style: normal; font-weight: normal">Your device code
defines the basic Drawing size, up to 255x255, and aspect ratio of
the Drawing.  
</P>
<H4 CLASS="western">X-Dimension, cols</H4>
<P STYLE="font-style: normal; font-weight: normal">The <B>x-dimension</B>
(the cols) defines the touch resolution for the drawing.  An
x-dimension of 50 cols is recommended as it is difficult for the user
to position their finger more accurately than that.  As discussed
below setting the dwg size does not limit the positioning of dwg
items/elements which can be positioned with fractional offsets.</P>
<P STYLE="font-style: normal; font-weight: normal">The x-dimension
also affects the scaling of the drawing.  If you design a drawing on
a 50x50 canvas and then display it on a 100x100, it will will be
drawing at half size.  You can also use the pushZero scaleFactor to
scale your drawings</P>
<P><I><B>Tip: Design your drawings at about the size they will be
displayed so you can confirm the readablity of the text labels.</B></I></P>
<H4 CLASS="western">Y-Dimension, rows</H4>
<P STYLE="font-style: normal; font-weight: normal">The <B>y-dimension</B>
(the rows) defines the aspect ratio.  E.g. 50 x 50, ie. 1:1 will be a
square dwg.  Drawing with aspect ratios larger than 1:1.3  (e.g. 50 x
65) may be shrunk to fit on the screen as the Scaling Drawings for
Display and the 50x77 (1:1.5) drawing above illustrates.</P>
<P STYLE="font-style: normal; font-weight: normal">For example a
50x25 drawing has a drawing basic resolution of 50 across and 25 down
and is half as high as it is wide.  However since you can scale the
dwg primitives and place them with fractional offsets (using the Zero
primitive), this basic resolution does not restrict the drawing
resolution.</P>
<P STYLE="font-style: normal; font-weight: normal">The size of
drawing you choose just sets the aspect ratio and provides convenient
grid for you to start placing your dwg items on.</P>
<P STYLE="font-style: normal; font-weight: normal">  
</P>
<P STYLE="font-style: normal; font-weight: normal">As described
above, the drawing is automatically scaled to fill your mobile's
screen, while retaining the drawing's specified aspect ratio, 
regardless of the screen size and the number of screen pixels your
mobile has. This provides consistency across various devices. 
Drawings will look visually the same on different screens apart from
the effect of  rounding to the screen's pixel locations.</P>
<H3 CLASS="western">The number of columns (width, x-dimension)
affects the dwg items scaling.</H3>
<P STYLE="font-style: normal; font-weight: normal">If you have laid
out some drawing primatives and then later increase the number of
columns (width) of your drawing, all the drawing items (including
text) will get smaller as they stay on their original locations but
the grid size is smaller.  Conversely if you reduce the number of
columns, all the drawing items and text get larger.</P>
<H3 CLASS="western">Dwg Items can be placed on fraction cols and
rows.</H3>
<P STYLE="font-style: normal; font-weight: normal">While the cols and
rows of an Drawing specify the aspect ratio and the resolution of
user inputs, it does not limit the placement of individual drawing
primitives.  Drawing primitives can be offset from the current zero
by fractional cols and rows.  
</P>
<P STYLE="font-style: normal; font-weight: normal">Also since dwg
primitives can be scaled down, as well as offset (using Zero) , a
10x10 dwg primitive can be scaled into a 1 col x 1 row on the final
dwg and the user input resolution becomes 10 times finer within that
1x1 square of the final dwg.  See the examples below.</P>
<H3 CLASS="western">Drawing Primitives</H3>
<P>Dwgs can be constructed with the following <B>Drawing Primitives</B>,
see the examples below.  Add<BR><B>pfodDwgs dwgs(&amp;parser);</B><BR>at
the top of the sketch below the parser declaration</P>
<H4 CLASS="western">Drawing Primitives Library</H4>
<P>This specification deals with the message format for the drawing
primitives.  However the pfodParser Library V3.1+ includes convenient
methods to build and send these messages in the correct format.</P>
<P>For example</P>
<PRE CLASS="western">#include &lt;pfodParser.h&gt;
<SPAN LANG="en-AU">pfodParser parser(&quot;&quot;); // create a parser to handle the pfod messages</SPAN>
<SPAN LANG="en-AU">pfodDwgs dwgs(&amp;parser);  // drawing support</SPAN>
&hellip;<SPAN LANG="en-AU">. &hellip;.</SPAN>
<FONT SIZE=2><SPAN LANG="en-AU">void sendDrawing_a(long dwgIdx) { // send parts of dwg.</SPAN></FONT>
  <FONT SIZE=2><SPAN LANG="en-AU">if (dwgIdx == 0) { // first part of dwg</SPAN></FONT>
  <FONT SIZE=2><SPAN LANG="en-AU">dwgs.start(50, 30, dwgs.WHITE); // 50 x 30 drawing<BR>  // background defaults to WHITE if omitted i.e. dwgs.start(50,30);</SPAN></FONT>
  <FONT SIZE=2><SPAN LANG="en-AU">parser.sendRefreshAndVersion(0); // parser version to cache this image</SPAN></FONT>

  <SPAN LANG="en-AU">// move zero to 10,12 and scale by 2.1 times</SPAN>
  <SPAN LANG="en-AU">dwgs.pushZero(10, 12, 2.1); </SPAN>
  <SPAN LANG="en-AU">// circle in a rectangle with a label below</SPAN>
  <SPAN LANG="en-AU">dwgs.rectangle().filled().color(dwgs.GREY).rounded().size(5.5, 5.5)<BR>       .offset(-2.75, -2.75).send();</SPAN>
  <SPAN LANG="en-AU">dwgs.label().text(F(&quot;Led&quot;)).color(dwgs.RED).offset(0, 4.3).send();</SPAN>
  <SPAN LANG="en-AU">dwgs.circle().filled().color(LedOn?dwgs.YELLOW:dwgs.BLACK)<BR>     .radius(1.5).send();</SPAN>
  <SPAN LANG="en-AU">// define a touch zone</SPAN>
  <SPAN LANG="en-AU">dwgs.touchZone().cmd('a').size(4, 4).offset(-2, -2).send();</SPAN>
  <SPAN LANG="en-AU">// what to show when zone touched, note no .send() for this action</SPAN>
  <SPAN LANG="en-AU">dwgs.touchAction().cmd('a').action( //</SPAN>
    <SPAN LANG="en-AU">dwgs.circle().filled().color(LedOn?dwgs.GREY:dwgs.YELLOW).radius(2.3) </SPAN>
  <SPAN LANG="en-AU">).send();</SPAN>
  <SPAN LANG="en-AU">dwgs.popZero();<BR></SPAN>
  <SPAN LANG="en-AU">dwgs.end();  // close message</SPAN>
<SPAN LANG="en-AU">}</SPAN></PRE><P>
<SPAN LANG="en-AU"><BR>See the on-line tutorial at </SPAN><A HREF="http://www.pfod.com.au/">www.pfod.com.au</A><SPAN LANG="en-AU">
for detailed examples of using this library.</SPAN></P>
<H3 CLASS="western">List of Drawing Primitives</H3>
<P>This is a summary of the drawing primitives. More details on are
given in the following sections.</P>
<P>The dwg primitives are: <B>Line, Rectangle, Arc, Circle, Label
(text or number), Index, Hide, Unhide, Erase, touchZone, touchAction,
touchActionInput, pushZero, popZero and InsertDwg</B> 
</P>
<P>In the examples below the examples show the defaults that are
applied if that method is not used.  E.g. <B>.size(1,1)</B> indicates
that if size is not specified it will default to 1 x 1 and
<SPAN STYLE="font-style: normal"><B>.color(dwgs.BLACK_WHITE)</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
indicates that if color is not specified it </SPAN></SPAN>defaults to
BLACK_WHITE which chooses either BLACK or WHITE whichever gives the
highest contrast.  The default <B>idx(0)</B> is means no index is
assigned and the primitive is drawn on the lowest level in the order
sent.</P>
<P>In all cases the <B>send()</B> method terminates this primitives
and sends the data.  Each primitive must have <B>send()</B> at then
end of it.  The methods can be added in any order between the
primitive <I>name</I><I><SPAN STYLE="font-weight: normal">()</SPAN></I>
and the <B>send()</B></P>
<UL>
	<LI><P>Line    |  <B>l</B> <I>[`idx]</I> ~ <I>[</I>&lt;colour&gt;<I>]</I>
	 ~ colDelta ~ rowDelta <I>[</I> ~ colOffset <I>[</I> ~ rowOffset
	<I>]]<BR></I><SPAN STYLE="font-style: normal"><B>dwgs.line().idx(0).color(dwgs.BLACK_WHITE).size(1,1).offset(0,0).send();<BR></B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">offset
	args can be dwgs.TOUCHED_COL and dwgs.TOUCHED_ROW</SPAN></SPAN></P>
	<LI><P>Rectangle  | <B>r</B><I><SPAN STYLE="font-weight: normal">[</SPAN></I><B>c</B><I><SPAN STYLE="font-weight: normal">]</SPAN></I><B>
	 </B><I><SPAN STYLE="font-weight: normal">[`idx]</SPAN></I><SPAN STYLE="font-weight: normal">
	~ </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">&lt;colour&gt;</SPAN><I><SPAN STYLE="font-weight: normal">]</SPAN></I><SPAN STYLE="font-weight: normal">
	 ~ width ~ height </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ colOffset </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ rowOffset
	</SPAN><I><SPAN STYLE="font-weight: normal">]]<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.rectangle().centered().idx(0).color(dwgs.BLACK_WHITE).size(1,1).offset(0,0)
	.send(); </B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">default
	is </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>not</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	centered()</SPAN></SPAN></P>
	<LI><P>Filled Rectangle    | <B>R</B><I><SPAN STYLE="font-weight: normal">[</SPAN></I><B>c</B><I><SPAN STYLE="font-weight: normal">]</SPAN></I><B>
	 </B><I><SPAN STYLE="font-weight: normal">[`idx]</SPAN></I><SPAN STYLE="font-weight: normal">
	~ </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">&lt;colour&gt;</SPAN><I><SPAN STYLE="font-weight: normal">]</SPAN></I><SPAN STYLE="font-weight: normal">
	 ~ width ~ height </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ colOffset </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ rowOffset
	</SPAN><I><SPAN STYLE="font-weight: normal">]]<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.rectangle().filled().centered().idx(0).color(dwgs.BLACK_WHITE).size(1,1)
	.offset(0,0).send(); </B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">default
	is </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>not</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	centered()</SPAN></SPAN></P>
	<LI><P>Rounded Rectangle | <B>rr</B><I><SPAN STYLE="font-weight: normal">[</SPAN></I><B>c</B><I><SPAN STYLE="font-weight: normal">]</SPAN></I><B>
	 </B><I><SPAN STYLE="font-weight: normal">[`idx]</SPAN></I><SPAN STYLE="font-weight: normal">
	~ </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">&lt;colour&gt;</SPAN><I><SPAN STYLE="font-weight: normal">]</SPAN></I><SPAN STYLE="font-weight: normal">
	 ~ width ~ height </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ colOffset </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ rowOffset
	</SPAN><I><SPAN STYLE="font-weight: normal">]]</SPAN></I><SPAN STYLE="font-style: normal"><B><BR>dwgs.rectangle().rounded().centered().idx(0).color(dwgs.BLACK_WHITE).size(1,1)
	.offset(0,0).send(); </B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">default
	is </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>not</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	centered()</SPAN></SPAN></P>
	<LI><P>Fill Rounded Rectangle  | <B>RR</B><I><SPAN STYLE="font-weight: normal">[</SPAN></I><B>c</B><I><SPAN STYLE="font-weight: normal">]</SPAN></I><B>
	 </B><I><SPAN STYLE="font-weight: normal">[`idx]</SPAN></I><SPAN STYLE="font-weight: normal">
	~ </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">&lt;colour&gt;</SPAN><I><SPAN STYLE="font-weight: normal">]</SPAN></I><SPAN STYLE="font-weight: normal">
	 ~ width ~ height </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ colOffset </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ rowOffset
	</SPAN><I><SPAN STYLE="font-weight: normal">]]<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.rectangle().filled().rounded().centered().idx(0).color(dwgs.BLACK_WHITE)
	.size(1,1).offset(0,0).send();  </B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">default
	is </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>not</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	centered()</SPAN></SPAN></P>
	<LI><P>Circle   | <B>c</B> <I><SPAN STYLE="font-weight: normal">[`idx]</SPAN></I><SPAN STYLE="font-weight: normal">
	~ </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">&lt;colour&gt;</SPAN><I><SPAN STYLE="font-weight: normal">]</SPAN></I><SPAN STYLE="font-weight: normal">
	</SPAN> ~ dRadius  <I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ colOffset </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ rowOffset
	</SPAN><I><SPAN STYLE="font-weight: normal">]]<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.circle().idx(0).color(dwgs.BLACK_WHITE).radius(1).offset(0,0).send();</B></SPAN><I><SPAN STYLE="font-weight: normal">
	</SPAN></I>
	</P>
	<LI><P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Filled
	Circle</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">   | </SPAN></I><I><B>C</B></I><I><SPAN STYLE="font-weight: normal">
	[`idx] ~ [&lt;colour&gt;]  ~ dRadius  [ ~ colOffset [ ~ rowOffset
	]]<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.circle().filled().idx(0).color(dwgs.BLACK_WHITE).radius(1).offset(0,0).send();</B></SPAN><I><SPAN STYLE="font-weight: normal">
	</SPAN></I>
	</P>
	<LI><P>Arc   | <B>a</B> <I><SPAN STYLE="font-weight: normal">[`idx]</SPAN></I><SPAN STYLE="font-weight: normal">
	~ </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">&lt;colour&gt;</SPAN><I><SPAN STYLE="font-weight: normal">]</SPAN></I><SPAN STYLE="font-weight: normal">
	</SPAN> ~ dArcAngle ~ dStartAngle ~ dRadius  <I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ colOffset </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ rowOffset
	</SPAN><I><SPAN STYLE="font-weight: normal">]]<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.arc().idx(0).color(dwgs.BLACK_WHITE).radius(1).start(startDegs)
	.angle(angleDegs).offset(0,0).send();</B></SPAN><I><SPAN STYLE="font-weight: normal">
	</SPAN></I>
	</P>
	<LI><P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Filled
	Arc</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">   | </SPAN></I><SPAN STYLE="font-style: normal"><B>A</B></SPAN><I><SPAN STYLE="font-weight: normal">
	[`idx] ~ [&lt;colour&gt;]  ~ dArcAngle ~ dStartAngle ~ dRadius  [ ~
	colOffset [ ~ rowOffset ]]
	<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.arc().filled().idx(0).color(dwgs.BLACK_WHITE).radius(1).start(startDegs)
	.angle(angleDegs).offset(0,0).send();</B></SPAN><I><SPAN STYLE="font-weight: normal">
	</SPAN></I>
	</P>
	<LI><P>Text   | <B>t</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">[`idx]</SPAN></I><SPAN STYLE="font-weight: normal">
	~ </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">&lt;colour&gt;</SPAN><I><SPAN STYLE="font-weight: normal">]</SPAN></I><SPAN STYLE="font-weight: normal">
	</SPAN> ~ text <I><SPAN STYLE="font-weight: normal">[ ~ colOffset [
	~ rowOffset [ ~ alignment </SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">(C
	or L or R)</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">
	]]]<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.label().idx(0).color(dwgs.BLACK_WHITE).text(
	</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">char*
	or &quot; &quot; or F(&quot; &quot;) </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>)
	.fontSize(0).bold().italic().underline().offset(0,0).center().send();<BR><BR></B></SPAN><I><SPAN STYLE="font-weight: normal">OR
	for a floating point number where </SPAN></I><SPAN STYLE="font-style: normal"><B>text</B></SPAN><I><SPAN STYLE="font-weight: normal">
	is the prefix and </SPAN></I><SPAN STYLE="font-style: normal"><B>units</B></SPAN><I><SPAN STYLE="font-weight: normal">
	the suffix</SPAN></I><SPAN STYLE="font-style: normal"><B><BR>dwgs.label().idx(0).color(dwgs.BLACK_WHITE).text(
	</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">char*
	or &quot; &quot; or F(&quot; &quot;) </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>)
	.fontSize(0).bold().italic().underline().offset(0,0).center()<BR>.units(&quot;
	&quot; </B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">or
	F(&quot; &quot;) )   default &quot;&quot;, empty<BR></SPAN></SPAN><SPAN STYLE="font-style: normal"><B>.decimals(2)</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	  allowable range -6 to +6<BR></SPAN></SPAN><SPAN STYLE="font-style: normal"><B>.floatReading(
	..)</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	 if specified the no scaling is performed it is just displayed with
	specified decmials</SPAN></SPAN><SPAN STYLE="font-style: normal"><B><BR><BR>center()</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
	the default, can be replaced with either </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>left()</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	or </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>right()</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	alignment .<BR></SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">The
	</SPAN></SPAN><SPAN STYLE="font-style: normal"><B>text( .. )</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	can include any of the formatting listed under section </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Text Formatting of Titles and DisplayStrings</SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">,</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	except &lt;bg ..&gt;.  Restricted characters in </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>text(..)</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	are automatically escaped (see </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Restricted Characters</SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">).</SPAN></SPAN></P>
	<LI><P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Value
	(formatted) </SPAN></SPAN><I><SPAN STYLE="font-weight: normal"> | </SPAN></I><I><B>v</B></I><I><SPAN STYLE="font-weight: normal">
	[`idx] ~ [&lt;colour&gt;]  ~ text  ~ colOffset  ~ rowOffset `value
	~units `min`max ~displaymin ~displaymax ` decimals  [ ~ alignment 
	</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">(C
	or L or R)</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">]<BR><BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.label().idx(0).color(dwgs.BLACK_WHITE).text(
	</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">char*
	or &quot; &quot; or F(&quot; &quot;) </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>)
	.fontSize(0).bold().italic().underline().offset(0,0).center()</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal"><BR></SPAN></SPAN><SPAN STYLE="font-style: normal"><B>.intValue(</B></SPAN><I><SPAN STYLE="font-weight: normal">value</SPAN></I><SPAN STYLE="font-style: normal"><B>)
	</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	if specified then range (max, min) mapped to (displaymax
	,displaymin) before displaying with specified decimals<BR></SPAN></SPAN><SPAN STYLE="font-style: normal"><B>.maxValue(1)
	 .minValue(0)</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	 int values  defaults 1, 0</SPAN></SPAN><SPAN STYLE="font-style: normal"><B><BR>.displayMax(1.0)
	.displayMin(0.0)</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	float values, defaults 1.0, 0.0  corresponding to maxValue() and
	minValue().<BR>The integer value need not be in the range (max,
	min)<BR></SPAN></SPAN><SPAN STYLE="font-style: normal"><B><BR>center()</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
	the default, can be replaced with either </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>left()</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	or </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>right()</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	alignment.<BR>The </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>text(
	.. )</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	can include any of the formatting listed under section </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Text Formatting of Titles and DisplayStrings</SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">,</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	except &lt;bg ..&gt; Restricted characters in </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>text(..)</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	and </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>units(..)</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	are automatically escaped (see </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Restricted Characters</SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">)</SPAN></SPAN></P>
	<LI><P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Hide
	</SPAN></SPAN><SPAN STYLE="font-style: normal"><B>| h</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	</SPAN></SPAN><SPAN STYLE="font-style: normal"><B>~</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	 OR  </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>| h `</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">idx<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.hide().cmd(</B></SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-style: normal"><B>).send();
	 </B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	hides touchZone with this cmd.</SPAN></SPAN><SPAN STYLE="font-style: normal"><B><BR>dwgs.hide().idx(</B></SPAN><I><SPAN STYLE="font-weight: normal">z_idx</SPAN></I><SPAN STYLE="font-style: normal"><B>).send();
	 </B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	hides primitive with this index<BR>Hide does not work for
	insertedDwgs, use </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>erase()</B></SPAN></P>
	<LI><P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Unhide
	</SPAN></SPAN><SPAN STYLE="font-style: normal"><B>| uh ~</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	 OR  </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>| uh `</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">idx<BR></SPAN></I><SPAN STYLE="font-style: normal"><B>dwgs.unhide().cmd(</B></SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-style: normal"><B>).send();
	</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	unhides touchZone with this cmd</SPAN></SPAN><SPAN STYLE="font-style: normal"><B><BR>dwgs.unhide().idx(</B></SPAN><I><SPAN STYLE="font-weight: normal">z_idx</SPAN></I><SPAN STYLE="font-style: normal"><B>).send();
	 </B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	unhides primitive with this index<BR>Unhide does not work for
	insertedDwgs, use </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>erase()</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
	/ </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>insertDwg()</B></SPAN></P>
</UL>
<P STYLE="font-style: normal; font-weight: normal">The following dwg
cmds move and scale and control the above drawing primitives.</P>
<UL>
	<LI><P>Zero (push)  | <B>z</B> ~ col ~ row ~ scaling
	<BR><B>dwgs.pushZero(</B><SPAN STYLE="font-weight: normal">cols,
	rows = 0.0, scaling = 1.0</SPAN><B>);</B><SPAN STYLE="font-weight: normal">
	<BR>Moves drawing zero and changes scaling<BR>rows defaults to 0.0,
	scaling defaults to 1.0<BR>Note: no send() needed for pushZero()</SPAN></P>
	<LI><P><I><SPAN STYLE="font-weight: normal">Zero (pop)  |
	</SPAN></I><I><B>z<BR></B></I><SPAN STYLE="font-style: normal"><B>dwgs.popZero();
	  </B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">undoes
	the most recent last push<BR>Note: no send() needed for popZero()</SPAN></SPAN></P>
	<LI><P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">TouchZone
	| </SPAN><B>x</B><I><SPAN STYLE="font-weight: normal">[</SPAN></I><B>c</B><I><SPAN STYLE="font-weight: normal">]</SPAN></I><SPAN STYLE="font-weight: normal">
	</SPAN><I><SPAN STYLE="font-weight: normal">[`idx] </SPAN></I><SPAN STYLE="font-weight: normal">~
	</SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
	 ~ </SPAN><I><SPAN STYLE="font-weight: normal">width</SPAN></I><SPAN STYLE="font-weight: normal">
	~ </SPAN><I><SPAN STYLE="font-weight: normal">height</SPAN></I><SPAN STYLE="font-weight: normal">
	</SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ colOffset </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">
	~ rowOffset </SPAN><I><SPAN STYLE="font-weight: normal">]]
	[`filter]<BR></SPAN></I><B>dwgs.touchZone().cmd(</B><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><B>).idx(0).centered().size(1,1).offset(0,0)
	.filter(dwgs.TOUCH).send()<BR></B><SPAN STYLE="font-weight: normal">The
	filter can any OR ( | ) combination of <BR></SPAN><B>dwgs.TOUCH |
	dwgs.DOWN | dwgs.DRAG | dwgs.UP | dwgs.CLICK | dwgs.PRESS |
	dwgs.ENTRY | dwgs.EXIT | dwgs.DOWN_UP | dwgs.TOUCH_DISABLED<BR></B><SPAN STYLE="font-weight: normal">See
	</SPAN><I><B>User Touches and Dwg Active Areas</B></I><SPAN STYLE="font-weight: normal">
	below for details</SPAN></P>
	<LI><P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">TouchAction
	| </SPAN><B>X</B><SPAN STYLE="font-weight: normal"> ~ </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
	~ </SPAN><I><SPAN STYLE="font-weight: normal">Drawing
	Primitive<BR></SPAN></I><B>dwgs.touchAction().cmd(</B><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><B>).action(
	&hellip; ).send();<BR></B><SPAN STYLE="font-weight: normal">The
	argument for the </SPAN><B>action( )</B><SPAN STYLE="font-weight: normal">
	entry is one of the primitives above minus its send() method.<BR>e.g.
	</SPAN><B>dwgs.touchAction().cmd('a').action(
	dwgs.rectangle().size(3,2) ).send();<BR></B><SPAN STYLE="font-weight: normal">See
	</SPAN><I><B>User Touches and Dwg Active Areas</B></I><SPAN STYLE="font-weight: normal">
	below for details</SPAN><I><SPAN STYLE="font-weight: normal"><BR><BR></SPAN></I><I><B>offset(
	.. , ..) </B></I><I><SPAN STYLE="font-weight: normal">and </SPAN></I><I><B>size(
	.. , ..) </B></I><I><SPAN STYLE="font-weight: normal">and
	</SPAN></I><I><B>dwgs.label().value( .. )</B></I><I><SPAN STYLE="font-weight: normal">
	can have the special args, </SPAN></I><I><B>dwgs.TOUCHED_COL</B></I><I><SPAN STYLE="font-weight: normal">
	and </SPAN></I><I><B>dwgs.TOUCHED_ROW</B></I><I><SPAN STYLE="font-weight: normal">
	 which are replaced when the primitive is processed with the
	currently touched col / row relative to the </SPAN></I><I><B>touchZone</B></I><I><SPAN STYLE="font-weight: normal">
	zero either (0,0) at center if the touchZone is </SPAN></I><I><B>centered()</B></I><I><SPAN STYLE="font-weight: normal">
	or (0,0) top left if not centered(), and using the current
	</SPAN></I><I><B>pushZero()</B></I><I><SPAN STYLE="font-weight: normal">
	scaling.<BR></SPAN></I><SPAN STYLE="font-weight: normal">See </SPAN><I><B>User
	Touches and Dwg Active Areas</B></I><SPAN STYLE="font-weight: normal">
	below for details</SPAN></P>
	<LI><P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">TouchActionInput
	| </SPAN><B>XI</B><SPAN STYLE="font-weight: normal"> ~ </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
	~
	</SPAN><I><SPAN STYLE="font-weight: normal">prompt[`idxOfTextItem]</SPAN></I><SPAN STYLE="font-weight: normal"><BR></SPAN><B>dwgs.touchActionInput().cmd(</B><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><B>).prompt(</B><SPAN STYLE="font-weight: normal">...</SPAN><B>).textIdx(</B><I><SPAN STYLE="font-weight: normal">idxOfTextItem</SPAN></I><B>).send();<BR></B><SPAN STYLE="font-weight: normal">When
	this action is triggered by the TouchZone with command </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">,
	a single line text exit dialog box is opened with the given prompt.
	The edit text is populated with the current text from the </SPAN><I><SPAN STYLE="font-weight: normal">label</SPAN></I><SPAN STYLE="font-weight: normal">
	(Text or Value dwg primitive) identified by the </SPAN><I><SPAN STYLE="font-weight: normal">idxOfTextItem.<BR></SPAN></I><SPAN STYLE="font-weight: normal"><BR>If
	the </SPAN><I><SPAN STYLE="font-weight: normal">idxOfTextItem</SPAN></I><SPAN STYLE="font-weight: normal">
	dwg primitive is 0 or not specified or is not a </SPAN><I><SPAN STYLE="font-weight: normal">label</SPAN></I><SPAN STYLE="font-weight: normal">
	(Text or Value primitive), the initial edit text is empty, but the
	edited text is still send with the </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
	to the pfodDevice.<BR><BR></SPAN><SPAN STYLE="font-weight: normal">After
	editing, the edited text is sent in the touch </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
	and the other touchActions are executed immediately. See </SPAN><B>User
	Touches and Dwg Active Areas</B><SPAN STYLE="font-weight: normal">
	below.<BR></SPAN><B>{</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
	</SPAN><B> ~</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">touchZoneCmd
	</SPAN></I><B>` </B><I><SPAN STYLE="font-weight: normal">col</SPAN></I><B>
	` </B><I><SPAN STYLE="font-weight: normal">row</SPAN></I><SPAN STYLE="font-weight: normal">
	</SPAN><B>`</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">touchType
	~ editedText</SPAN></I><B>}<BR><BR></B><I><B>Note: any restricted
	characters in editedText are escaped before sending, see </B></I><I><B>Restricted Characters</B></I><I><B>.</B></I><B><BR></B><SPAN STYLE="font-weight: normal">Note:
	No validation is performed on the </SPAN><I><SPAN STYLE="font-weight: normal">editedText</SPAN></I><SPAN STYLE="font-weight: normal">
	sent with the </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">,
	the pfodDevice must do any validation required.<BR>Note: The length
	of the </SPAN><I><SPAN STYLE="font-weight: normal">editedText</SPAN></I><SPAN STYLE="font-weight: normal">
	is truncated, if necessary, to limit the cmd sent be less than the
	255 byte pfod limit for commands.<BR><BR>The text displayed and sent
	back to the pfodDevice is UTF8 encoded bytes.  That is a series of
	bytes are sent, NOT characters.  If you want to enter a non-ASCII
	char, such as </SPAN><FONT COLOR="#333333"><B>&#8457;</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">,
	you can type in the Unicode escape sequence for that character, e.g.
	\u2109 and the pfodApp will convert it immediately to the UTF8 byte
	sequence for </SPAN></FONT><FONT COLOR="#333333"><B>&#8457;</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
	 and display that in the input screen if the mobile has the
	appropriate font installed.</SPAN></FONT></P>
	<LI><P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Index
	 </SPAN><B>| i `</B><SPAN STYLE="font-weight: normal">
	</SPAN><I><SPAN STYLE="font-weight: normal">idx|<BR></SPAN></I><B>dwgs.index().idx(
	</B><I><SPAN STYLE="font-weight: normal">z_idx </SPAN></I><B>).send();<BR></B><SPAN STYLE="font-weight: normal">Does
	nothing except make dwg message non-empty.  Nothing is displayed.</SPAN></P>
	<LI><P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Erase
	| </SPAN><B>e</B><SPAN STYLE="font-weight: normal"> ~ </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
	  OR  | </SPAN><B>e</B><SPAN STYLE="font-weight: normal">
	`</SPAN><I><SPAN STYLE="font-weight: normal">idx<BR></SPAN></I><B>dwgs.erase().idx(</B><I><SPAN STYLE="font-weight: normal">
	z_idx </SPAN></I><B>).send();   </B><SPAN STYLE="font-weight: normal">
	completely removes primitive that has this index</SPAN><B><BR>dwgs.erase().cmd(
	</B><I><SPAN STYLE="font-weight: normal">cmd </SPAN></I><B>).send();
	</B><SPAN STYLE="font-weight: normal"> completely removes touchZone
	that has this cmd and any insertedDwg that has this loadCmd.</SPAN></P>
	<LI><P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">InsertDwg
	 </SPAN><B>| d</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">
	</SPAN></I><SPAN STYLE="font-weight: normal">~ </SPAN><I><SPAN STYLE="font-weight: normal">loadcmd</SPAN></I><SPAN STYLE="font-weight: normal">
	</SPAN><I><SPAN STYLE="font-weight: normal"> ~ ~ colOffset  ~
	rowOffset<BR></SPAN></I><B>dwgs.insertDwg().loadCmd( </B><I><SPAN STYLE="font-weight: normal">dwgLoadcmd
	</SPAN></I><B>).offset(0,0).send();<BR></B><SPAN STYLE="font-weight: normal">Loads
	drawing via </SPAN><I><SPAN STYLE="font-weight: normal">dwgLoadcmd
	</SPAN></I><SPAN STYLE="font-weight: normal">offsets the it and
	merges it with the current drawing at the current zero and using the
	current scaling.  All indices and touchZone commands must be </SPAN><SPAN STYLE="font-weight: normal">unique
	across both dwgs.  If not the last one processed wins. <BR></SPAN><SPAN STYLE="font-weight: normal">The
	</SPAN><I><SPAN STYLE="font-weight: normal">colOffset</SPAN></I><SPAN STYLE="font-weight: normal">,
	</SPAN><I><SPAN STYLE="font-weight: normal">rowOffset</SPAN></I><SPAN STYLE="font-weight: normal">
	move the inserted dwg left and up (for +ve values) relative to the
	current dwg zero <BR><BR>To hide/erase/update parts of an inserted
	dwg, change the update message for the inserted dwg and then update
	the main drawing, or wait for the timer update of the inserted
	drawing.</SPAN></P>
	<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Use
	the dwgs.</SPAN><B>erase().cmd(</B><SPAN STYLE="font-weight: normal">
	</SPAN><I><SPAN STYLE="font-weight: normal">dwgLoadcmd</SPAN></I><SPAN STYLE="font-weight: normal">
	</SPAN><B>)</B><SPAN STYLE="font-weight: normal"> to erase an
	inserted dwg. Any touchZone with the same cmd will also be erased so
	choose a unique touchZone / insertDwg cmds for each dwg.</SPAN></P>
</UL>
<P STYLE="font-style: normal; font-weight: normal"><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">The <I>[</I>&lt;colour&gt;<I>]</I>
is optional.  If it is omitted then either black or white is used,
which ever has the best contrast with the drawing's original
background colour.</P>
<P> The <I>[</I>`idx<I>]</I> is an integer &gt; 0 and is optional. If
present it sets the Z-order of this drawing item relative to all
other indexed items.  Non-indexed items are drawn first in the order
they are received and then the Z-order items are drawn, lowest
Z-order first.  This Z-order index also allows you to uniquely
reference the drawing item later for updating or erasing.  <BR>The
<B>pfodAutoIdx</B> pfodPaser library class can provide up to 999
globally unique indices for use with dwgs.</P>
<P>See the examples below.</P>
<P>If colOffset or rowOffset or width or depth are omitted then they
default to 1.0 <BR>If dRadius is omitted it defaults to 1.0.  If
dStartAngle is omitted it defaults to 0 degs.  If dArcAngle is
omitted it defaults to 360 degs (i.e. a complete circle)</P>
<P>All number arguments preceded by ~ can be plus or minus floating
point numbers <BR>All number arguments preceded by ` must be integers
only.  
</P>
<H3 CLASS="western">Zero, push and pop</H3>
<P STYLE="font-style: normal; font-weight: normal">Zero push, <B>| z
~ 5.2 ~ 2.5 ~ 3.2</B>  ,  pushes the current zero setting for that
drawing onto a stack in pfodApp and then set the new zero and new
scaling of the following drawing primitives.  <I>scaling</I> defaults
to 1.0 if missing.</P>
<P STYLE="font-style: normal; font-weight: normal">The new zero is
set by first scaling the col,row arguments by the current scaling and
then adding them to the current zero col, row.  The scaling is then
updated to (current scaling * new scaling).</P>
<P STYLE="font-style: normal; font-weight: normal">Initially the zero
is the top left corner of the drawing (0,0) and then initial scaling
is 1.0</P>
<P STYLE="font-style: normal; font-weight: normal">Zero pop, <B>| z</B>
 , pops the previous zero and scaling off the stack and makes it the
current scaling.  If the stack is empty (0,0) 1.0 scaling is used.</P>
<H3 CLASS="western">InsertDwgs</H3>
<P STYLE="font-style: normal; font-weight: normal"><B>| d</B> ~
<I>loadcmd</I> <I> ~   ~ colOffset  ~
rowOffset<BR></I><B>dwgs.insertDeg().loadCmd( </B><I>dwgLoadcmd
</I><B>).offset(0,0).send();</B></P>
<P STYLE="font-style: normal; font-weight: normal">This loads the
dwg, using the <I>loadcmd</I>, and inserts it in the current drawing
at the current position and with the current scaling.  The <I>colOffset
</I> and<I>  rowOffset</I> define which position in the inserted dwg
is placed at the current drawing's zero.</P>
<P STYLE="font-style: normal; font-weight: normal">All indices and
touchZone commands must be unique across both dwgs.  If not the last
one processed wins.</P>
<P STYLE="font-style: normal; font-weight: normal">For example</P>
<PRE CLASS="western">void sendDrawing_a() {
  <SPAN LANG="en-AU">dwgs.start(50, 30, dwgs.WHITE); // 50 x 30 drawing<BR>  // background defaults to WHITE if omitted i.e. dwgs.start(50,30);</SPAN>
  <SPAN LANG="en-AU">parser.<FONT SIZE=2>sendRefreshAndVersion</FONT>(0); // send the parser version to cache this image, no refresh</SPAN>

  <SPAN LANG="en-AU">// move zero to the centre 25,15 and scale by 3.1 times</SPAN>
  <SPAN LANG="en-AU">dwgs.pushZero(25, 15, 3.1); </SPAN>
  <SPAN LANG="en-AU">dwgs.insertDwg().loadCmd('z').offset(5,3).send();</SPAN>
  <SPAN LANG="en-AU">// insert all of drawing z (above) with this scaling </SPAN>
  <SPAN LANG="en-AU">// where position (5,3) in dwg z is positioned at (25,15) in dwg a</SPAN>
  <SPAN LANG="en-AU">dwgs.popZero();<BR>  dwgs.end();  // close message</SPAN>
<SPAN LANG="en-AU">}</SPAN></PRE><P>
<BR>This is particularly useful for showing an expanded view of a
drawing in another menu item.</P>
<H3 CLASS="western">Hide, Unhide, Erase</H3>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Hide
</SPAN><B>| h</B><SPAN STYLE="font-weight: normal"> </SPAN><B>~</B><SPAN STYLE="font-weight: normal">
</SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
 OR  </SPAN><B>| h `</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">idx</SPAN></I></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Unhide
</SPAN><B>| uh ~</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
 OR  </SPAN><B>| uh `</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">idx</SPAN></I></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Erase
| </SPAN><B>e</B><SPAN STYLE="font-weight: normal"> ~ </SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-weight: normal">
  OR  | </SPAN><B>e</B><SPAN STYLE="font-weight: normal"> `</SPAN><I><SPAN STYLE="font-weight: normal">idx</SPAN></I></P>
<P STYLE="font-style: normal; font-weight: normal">Hide removes the
referenced dwg primitive or touchZone from the display, but does not
delete it.  Unhide restores it to the display.  Erase removes it
completely.</P>
<P STYLE="font-style: normal; font-weight: normal">Inserted Dwgs and
touchZones are uniquely identified by their cmd, only.<BR>Other dwg
items are uniquely identified by their index.</P>
<P STYLE="font-style: normal; font-weight: normal">Hidden touchZones
will not be visible in debug mode (see below)</P>
<P STYLE="font-style: normal; font-weight: normal">It is an error to
try and hide or unhide something that does not exist in the drawing.</P>
<P STYLE="font-style: normal; font-weight: normal">You can update a
hidden primitive or touchZone, but it stays hidden until you unhide
it.</P>
<P STYLE="font-style: normal; font-weight: normal">You cannot
Hide/unhide insertedDwgs but you can erase them by referencing them
via their <I>loadCmd</I>.  <I><B>Any touchzone with the same cmd will
also be erased</B></I>. 
</P>
<H3 CLASS="western">Index</H3>
<P STYLE="font-style: normal"><B>| i `</B><SPAN STYLE="font-weight: normal">
</SPAN><I><SPAN STYLE="font-weight: normal">idx</SPAN></I></P>
<P STYLE="font-style: normal; font-weight: normal">This drawing
primitives just reserves this index with the current zero and scaling
for later updating with another dwg primitive.  If you never update
it, nothing is displayed.</P>
<P STYLE="font-style: normal">This Index primitive is not normally
needed, but is sometimes useful for complex controls which have
multiple pushZero's and multiple primitives to be update.</P>
<H3 CLASS="western"></H3>
<H3 CLASS="western" STYLE="page-break-before: always">Text and Values
Alignment</H3>
<P>The alignment option need pfodApp V3.0.371+ to display left or
right alignment.</P>
<P STYLE="font-style: normal"><IMG SRC="TextAlignment_screen.jpg" NAME="graphics62" ALIGN=BOTTOM WIDTH=318 HEIGHT=567 BORDER=0>
</P>
<P STYLE="font-style: normal">In the example above the escape
sequence &amp;#124; was used to insert the | char into the display.</P>
<P STYLE="font-style: normal"><BR><BR>
</P>
<PRE CLASS="western"><FONT SIZE=1 STYLE="font-size: 8pt">int value = 50;</FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">void sendDrawing_z0() {</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// background defaults to WHITE if omitted i.e. dwgs.start(50,30);</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.start(50, 45, dwgs.WHITE, true); //true means more to come,</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// send the parser version to cache this image, no auto-refresh</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">parser.sendRefreshAndVersion(0);</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// scale by 1.0f,  scale defaults to 1.0f if omitted, i.e. pushZero(10,15);</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.pushZero(25, 0, 1.0f);</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// draw center line</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.line().size(0, 45).color(dwgs.RED).send();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">// default is .center() if not specified</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.label().text(&quot;&amp;#124; &quot;).decimals(1).intValue(55).units(&quot; value&amp;#124;&quot;)</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">.maxValue(255).displayMax(100).color(dwgs.BLACK).offset(0, 5).send();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.label().text(&quot;&amp;#124;TEXT&amp;#124;&quot;).color(dwgs.BLACK).offset(0, 10).send();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.label().left().text(&quot;&amp;#124;left &quot;).decimals(1).floatReading(5.55)</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">.units(&quot; value&amp;#124;&quot;).color(dwgs.BLACK).offset(0, 15).send();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.label().left().text(&quot;&amp;#124;TEXT left&amp;#124;&quot;).color(dwgs.BLACK).offset(0, 20).send();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.label().right().text(&quot;&amp;#124;right &quot;).decimals(1).intValue(55)</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">.units(&quot; value&amp;#124;&quot;).maxValue(255).displayMax(100).color(dwgs.BLACK).offset(0, 25).send();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.label().right().text(&quot;&amp;#124;TEXT right&amp;#124;&quot;).color(dwgs.BLACK).offset(0, 30).send();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.label().center().text(&quot;&amp;#124;center &quot;).decimals(1).floatReading(5.55)</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">.units(&quot; value&amp;#124;&quot;).color(dwgs.BLACK).offset(0, 35).send();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.label().center().text(&quot;&amp;#124;TEXT center&amp;#124;&quot;).color(dwgs.BLACK).offset(0, 40).send();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.popZero();</SPAN></FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">dwgs.end();</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">}</SPAN></FONT>
</PRE><P>
There are two underlying msgs for labels, <B>|t</B> (text and
formatted floats) and <B>|v </B><SPAN STYLE="font-weight: normal">(mapped
int values)</SPAN>,  these are both handled by the label() method in
the  pfodParser library.</P>
<H4 CLASS="western"><A NAME="__RefHeading__8234_837100287"></A>Text
Displays</H4>
<P>| <B>t</B><SPAN STYLE="font-weight: normal"> </SPAN><I><SPAN STYLE="font-weight: normal">[`idx]</SPAN></I><SPAN STYLE="font-weight: normal">
~ </SPAN><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-weight: normal">&lt;colour&gt;</SPAN><I><SPAN STYLE="font-weight: normal">]</SPAN></I><SPAN STYLE="font-weight: normal">
</SPAN> ~ text <I><SPAN STYLE="font-weight: normal">[ ~ colOffset [ ~
rowOffset [ ~ alignment ]]]</SPAN></I></P>
<P STYLE="font-style: normal; font-weight: normal">The alignment
option defaults to centred, ~C, if missing.  Other options are left,
~L, and right, ~R.</P>
<P STYLE="font-style: normal; font-weight: normal">e.g.
<B>dwgs.label().idx(0).color(dwgs.BLACK_WHITE).text( </B>char* or &quot;
&quot; or F(&quot; &quot;) <B>)
.fontSize(0).bold().italic().underline().offset(0,0).center().send();</B></P>
<P STYLE="font-style: normal; font-weight: normal"><B>center()</B>,
the default, can be replaced with either <B>left()</B> or <B>right()</B>
alignment.</P>
<P STYLE="font-style: normal; font-weight: normal">The pfodParser
library also lets you send floating point values, rounded to the
number of decimals, using the <B>.value(..)</B> method.  If value is
specified the a text label is sent consisting of the <I><B>text</B></I>
concatenated with the formatted <I><B>value</B></I> (to the <I><B>decimals</B></I>
specified) concatenated with the <I><B>units</B></I></P>
<P STYLE="font-style: normal; font-weight: normal">e.g.
<B>dwgs.label().idx(0).color(dwgs.BLACK_WHITE).text( </B>char* or &quot;
&quot; or F(&quot; &quot;) <B>)
.fontSize(0).bold().italic().underline().offset(0,0).center().units(..</B>
)<B>.decimals(2).value( ..).send();</B>  
</P>
<P STYLE="font-style: normal; font-weight: normal">The default
decimals is 2. decimals can be +/- int.  Negative decimals round to
the left of the decimal point, i.e. <B>value(12345.67).decimal(-3)</B>
 formats to <B>12000</B></P>
<P STYLE="font-style: normal; font-weight: normal">NOTE: When using
value( ), all the formatting takes place in the pfodParser before the
labels is sent.</P>
<P STYLE="font-style: normal; font-weight: normal">By default
<B>dwgs.label()</B> automatically escapes the restricted chars <B>{ }
| ` ~</B>  before sending the text and units.  You can suppress this
by calling <B>doNotEncode()</B> e.g.<BR><B>dwgs.label().doNotEncode().
&hellip; .send();</B></P>
<H4 CLASS="western">Value Text Displays</H4>
<P STYLE="font-style: normal; font-weight: normal">As well as plain
text drawing primitives, there is a mapped integer value text
primitive.  
</P>
<P STYLE="font-style: normal; font-weight: normal">This form of the
<B>label()</B> method is often used in a touchAction to display the
value of a slider as it is dragged on the screen, using
<B>intValue(TOUCHED_X)</B> or <B>intValue(TOUCHED_Y)</B> to pick up
the users touch point and scale to the values represented by the
slider using <B>maxValue()</B>, <B>minValue()</B>, <B>displayMax()</B>
and <B>displayMin()</B></P>
<P STYLE="font-style: normal; font-weight: normal"><I>| </I><I><B>v</B></I><I>
[`idx] ~ [&lt;colour&gt;]  ~ text  ~ colOffset  ~ rowOffset `value
~units `min`max ~displaymin ~displaymax ` decimals  [ ~ alignment ]</I></P>
<P STYLE="font-style: normal; font-weight: normal">The alignment
option defaults to centred, ~C, if missing.  Other options are left,
~L, and right, ~R.</P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">In
this display the integer value is first mapped from the range (</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">min</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">max</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">)
to (</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">displaymin</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">displaymax</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">)
and then formatted to </SPAN></SPAN><I><SPAN STYLE="font-weight: normal">decimals</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
places and concatenated, i.e</SPAN></SPAN></P>
<P><I><B>text</B></I><SPAN STYLE="font-style: normal"><B>
&lt;mappedValue&gt; </B></SPAN><I><B>units</B></I></P>
<P STYLE="font-style: normal; font-weight: normal"> to get the final
display text.  
</P>
<P STYLE="font-style: normal; font-weight: normal">E.g.  the example
below shows the default values if not otherwise specified,</P>
<P STYLE="font-style: normal; font-weight: normal"><B>dwgs.label().idx(0).color(dwgs.BLACK_WHITE).text(
</B>char* or &quot; &quot; or F(&quot; &quot;) <B>)
</B><B>.fontSize(0).bold().italic().underline().offset(0,0).center().intValue(</B><I>value</I><B>).maxValue(1).minValue(0).displayMax(1.0)
.displayMin(0.0).decimals(2).send();</B></P>
<P STYLE="font-style: normal; font-weight: normal"><B>center()</B>,
the default, can be replaced with either <B>left()</B> or <B>right()</B>
alighment.<BR>The <B>text( .. )</B> can include any of the formatting
listed under section <I><B>Text Formatting for Titles and Display
Strings</B></I><I>,</I> except &lt;bg ..&gt;</P>
<P STYLE="font-style: normal; font-weight: normal">If <B>maxValue()</B>,
<B>minValue()</B>, <B>displayMax()</B> and <B>displayMin()</B> are
not called, the default values result in the intValue being displayed
unchanged to the number of <B>decimals()</B> specified (default 2).  
Use <B>decimals(0)</B> to display just the integer value with out
trailing .00</P>
<P STYLE="font-style: normal; font-weight: normal">The default
decimals is 2. decimals can be +/- int.  Negative decimals round to
the left of the decimal point, i.e. <B>intvalue(12345).decimal(-3)</B>
 formats to <B>12000</B></P>
<P STYLE="font-style: normal; font-weight: normal"><I>NOTE</I>:
Unlike the previous <B>|t value()</B> form, the scaling and
formatting for this <B>|v intValue()</B> form is all done on the in
pfodApp using the current <B>intValue( )</B></P>
<P STYLE="font-style: normal; font-weight: normal">By default
<B>dwgs.label()</B> automatically escapes the restricted chars <B>{ }
| ` ~</B>  before sending the text and units.  You can suppress this
by calling <B>doNotEncode()</B> e.g.<BR><B>dwgs.label().doNotEncode().
&hellip; .send();</B></P>
<H3 CLASS="western">User Touches and Dwg Active Areas</H3>
<P>There is also a User Touch Zone drawing primitive  <BR>|  <B>x</B>
<I><SPAN STYLE="font-weight: normal">[`idx] </SPAN></I>~ <I>cmd</I> <SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">~
</SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">width</SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
~ </SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">height</SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
</SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">[</SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
~ colOffset </SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">[</SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
~ rowOffset </SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">]]</SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
` touchFilter</SPAN></SPAN></SPAN>    <BR><SPAN STYLE="font-style: normal"><B>dwgs.touchZone().idx(
.. ).cmd(</B></SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-style: normal"><B>).size(
&hellip; ,  &hellip;   ).offset( &hellip;  ,  &hellip;  ).filter( &hellip;
).send();</B></SPAN></P>
<P>This specifies a rectangle on the screen to be responsive to the
user's touch. The touchFilter determines what type of user touch to
respond to.</P>
<P>TouchZones are uniquely referenced by their <I><B>cmd</B></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">.
The touchZone's index is only used to determine which touchZone is on
top of another if the user's touch lies in both.</SPAN></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal"><I><B>pfodApp
automatically expands the all active regions so that they have an
extra 4.5mm on each side</B></I>.  So even very small active regions
will be at least 9mm x 9mm on all screen sizes.</P>
<H4 CLASS="western">How to choose between multiple overlapping
touchZones</H4>
<P STYLE="margin-bottom: 0cm">1) If none of the overlapping touched
touchZones have indices, the usual case, then:-</P>
<P STYLE="margin-left: 0.55cm; font-style: normal; font-weight: normal; page-break-before: auto">
If one touchZone completely encloses the other, then the outer most
(enclosing) touchZone is chosen. (see below)</P>
<P STYLE="margin-left: 0.55cm; font-style: normal; font-weight: normal">
Otherwise if they partially overlap, the 'best' fit one is chosen,
where 'best' fit means the touchZone most closely centered to where
the touch is.</P>
<P STYLE="font-style: normal; font-weight: normal">2) If one or more
of the multiple overlapping touchZones are touched have an index then
the one with the highest index is chosen.  Non-indexed touchZones
have an implied index of 0, i.e. below the lowest assignable index.</P>
<P STYLE="font-style: normal; font-weight: normal">touchZones usually
do not have/need an index since they are uniquely identified by their
<I><B>cmd</B></I>.<BR>The rules above allow you to add/unhide a
touchZone that covers the entire dwg and which will intercept/filter
all touches return the position touched and prevent any underlying
touchZone from being fired.  This lets you select/drag the underlying
items without triggering them.</P>
<P STYLE="font-style: normal; font-weight: normal">One of the few
cases where you would assign an idx to a touchZone is to force it to
be 'on top' of any other touchZone.  For example a help button which
remains active even when the entire dwg touchZone has been
added/unhidden.</P>
<H4 CLASS="western">Touch Filter Options</H4>
<P>Touch Filter Options are integers :-</P>
<P>0 <I>Touch</I>  <B>dwgs.TOUCH</B> &ndash; the default if nothing
specified.  Send the <I>cmd</I><SPAN STYLE="font-style: normal"> just
once whenever the user touches the region. Block further commands
from this region until the previous one has been responded to.  This
is the filter often used for buttons.  You cannot combine this filter
with any other one.  If this touchZone has an actionActionInput
dialog associated with it and the touch filter is not </SPAN><SPAN STYLE="font-style: normal"><B>TOUCH_DISABLED</B></SPAN><SPAN STYLE="font-style: normal">,
then the touchZone touchFilter is forced to </SPAN><SPAN STYLE="font-style: normal"><B>TOUCH</B></SPAN><SPAN STYLE="font-style: normal">
only.</SPAN></P>
<P><SPAN STYLE="font-style: normal">1 </SPAN><I>Down</I><SPAN STYLE="font-style: normal">
</SPAN><SPAN STYLE="font-style: normal"><B>dwgs.DOWN </B></SPAN><SPAN STYLE="font-style: normal">&ndash;
send the </SPAN><I>cmd</I><SPAN STYLE="font-style: normal"> when the
user puts their finger down in the region.</SPAN></P>
<P><SPAN STYLE="font-style: normal">2 </SPAN><I>Drag</I><SPAN STYLE="font-style: normal">
</SPAN><SPAN STYLE="font-style: normal"><B>dwgs.DRAG </B></SPAN><SPAN STYLE="font-style: normal">&ndash;
send the </SPAN><I>cmd</I><SPAN STYLE="font-style: normal"> when the
user drags their finger in the region.</SPAN></P>
<P><SPAN STYLE="font-style: normal">4 </SPAN><I>Up</I><SPAN STYLE="font-style: normal">
 </SPAN><SPAN STYLE="font-style: normal"><B>dwgs.UP </B></SPAN><SPAN STYLE="font-style: normal">&ndash;
send the </SPAN><I>cmd</I><SPAN STYLE="font-style: normal"> then the
user lifts their finger off the screen from the region. </SPAN>
</P>
<P><SPAN STYLE="font-style: normal">8 </SPAN><I>Click</I><SPAN STYLE="font-style: normal">
</SPAN><SPAN STYLE="font-style: normal"><B>dwgs.CLICK </B></SPAN><SPAN STYLE="font-style: normal">&ndash;
send the </SPAN><I>cmd</I><SPAN STYLE="font-style: normal"> when the
user clicks in the region.</SPAN></P>
<P><SPAN STYLE="font-style: normal">16 </SPAN><I>Long Press</I><SPAN STYLE="font-style: normal">
</SPAN><SPAN STYLE="font-style: normal"><B>dwgs.PRESS </B></SPAN><SPAN STYLE="font-style: normal">&ndash;
send the cmd the user long presses in the region.</SPAN></P>
<P><SPAN STYLE="font-style: normal">256 </SPAN><I>Down-Up</I><SPAN STYLE="font-style: normal">
</SPAN><SPAN STYLE="font-style: normal"><B>dwgs.DOWN_UP </B></SPAN><SPAN STYLE="font-style: normal">&ndash;
detect finger Down and Drag but only send the cmd on finger UP</SPAN></P>
<P><SPAN STYLE="font-style: normal">512 </SPAN><I>Disabled</I><SPAN STYLE="font-style: normal">
</SPAN><SPAN STYLE="font-style: normal"><B>dwgs.TOUCH_DISABLED </B></SPAN><SPAN STYLE="font-style: normal">&ndash;
ignore touches in this region.  This flag overrides ALL other touch
filters.</SPAN></P>
<P STYLE="font-style: normal">You can combine these filters to send
commands on multiple user actions.  For example a touchFilter of 24
(8+16) will send a command on a click and on a long press.  <BR>e.g.</P>
<P STYLE="font-style: normal"><B>.filter(</B> <B>dwgs.DRAG | 
dwgs.UP) <BR></B><SPAN STYLE="font-weight: normal">will send cmds for
finger drags and when the finger is removed from the screen</SPAN></P>
<P><SPAN STYLE="font-style: normal">You cannot combine </SPAN><I>Touch</I><SPAN STYLE="font-style: normal">
(0) with any other filter.  If you specify </SPAN><I>Disabled</I><SPAN STYLE="font-style: normal">
(512) it overrides any </SPAN><SPAN STYLE="font-style: normal">other
touchFilters specified.</SPAN></P>
<H4 CLASS="western">No Touch Zones Defined</H4>
<P>With no active area defined for an Dwg, then clicking on that menu
item will just send the associated menu item cmd .e.g. 
</P>
<P><B>{A}</B> 
</P>
<H4 CLASS="western">Touch Zones Defined</H4>
<P STYLE="font-style: normal; font-weight: normal">With one or more
active areas defined, using the <B>| ~ x</B> drawing primitive, the
only those areas will respond to user touches.  Active regions are
always rectangles. If the user touches any other point on the
Drawing, pfodApp ignores it.</P>
<P STYLE="font-style: normal; font-weight: normal">The format for
active region is</P>
<P STYLE="font-style: normal; font-weight: normal">Example</P>
<P STYLE="font-style: normal"><B>|x~b~2.5~2.5~24.5~9.5`5
<BR>dwgs.touchZone().cmd(</B><I><SPAN STYLE="font-weight: normal">'b'</SPAN></I><B>).size(2.5
, 2.5).offset(24.5 , 9.5).filter( dwgs.DOWN | dwgs.UP).send();</B></P>
<P STYLE="font-style: normal; font-weight: normal">defines an active
region, the rectangle (24.5,9.5) to (27,12), with active region
command of <B>b</B> and a touch filter of DOWN and UP (1 | 4 ) = 5. 
No drag messages will be returned.</P>
<P STYLE="font-style: normal; font-weight: normal">You can view an
Dwg's active regions by opening the Edit Connection screen for the
current connection and tick <B>Log Debug data</B> and then save the
connection and re-open it.</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="enableShowingActiveRegions.png" NAME="graphics57" ALIGN=BOTTOM WIDTH=190 HEIGHT=338 BORDER=0><BR><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">Then when you
re-open the connection, all the Drawings will display any active
regions that are defined for them.</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="activeRegion_b.png" NAME="graphics58" ALIGN=BOTTOM WIDTH=190 HEIGHT=333 BORDER=0><BR><BR>The
active regions are shown dotted with their <I>cmd</I> in the bottom
left corner.</P>
<H3 CLASS="western">Commands returned for Active Regions</H3>
<P STYLE="font-style: normal; font-weight: normal">For example,
clicking somewhere in the middle of the previous Drawing will cause
pfodApp on your Android mobile to send a command like <BR><B>{</B>
<I>&lt;cmd&gt;</I> <B> ~</B> <I>&lt;touchZoneCmd&gt; </I><B>` </B><I>&lt;col&gt;</I><B>
` </B><I>&lt;row&gt;</I> <B>`</B> <I>&lt;touchType&gt; [</I>~
&lt;<I>editedText</I>&gt;<I>]</I><B>}</B></P>
<P STYLE="font-style: normal; font-weight: normal">Where:-<BR><I>&lt;cmd&gt;</I>
&ndash; is the menu item command that is displaying this Drawing</P>
<P STYLE="font-style: normal; font-weight: normal"><I>&lt;touchZoneCmd&gt;</I>
&ndash; the cmd for this touch zone region</P>
<P STYLE="font-style: normal; font-weight: normal"><I>&lt;col&gt;</I>
&ndash; is the unscaled column in the active area that was detected</P>
<P STYLE="font-style: normal; font-weight: normal"><I>&lt;row&gt;</I>
&ndash; is the unscaled row in the active area that was detected</P>
<P STYLE="font-style: normal; font-weight: normal"><I>&lt;touchType&gt;</I>
&ndash; is the type of user touch TOUCH (0), CLICK (8), LONG_PRESS
(16), DOWN (1) , DRAG (2) or UP (4)</P>
<P STYLE="font-style: normal; font-weight: normal">&lt;editedText&gt;
&ndash; is the text from touchActionInput dialog box</P>
<P STYLE="font-style: normal; font-weight: normal">Calling
parser.parseDwgCmd() parses the command and returns the cmd letter.</P>
<P><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">After
calling </SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>parser.parseDwgCmd()</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
you can call <BR></SPAN></SPAN></SPAN><B>parser.getTouchedCol()</B>
and <B>getTouchedRow()</B> to the the x and y position touched
and<BR><B>parser.</B><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>getTouchedType()</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
to get the touch type <BR>OR</SPAN></SPAN></SPAN><BR><B>parser.</B><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>isPress()</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
</SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>parser.isClick()</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
</SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>parser.isDown()</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
</SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>parser.isDrag()</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
</SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>parser.isUp()</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
to check the type</SPAN></SPAN></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">e.g.</P>
<P STYLE="font-style: normal"><B>{A}<BR>{A~b`26`8`0}</B></P>
<P STYLE="font-style: normal"><B>{A~b`26`8`0~test text}</B></P>
<P STYLE="font-style: normal; font-weight: normal">The cmd is A
because that was the menu item pressed. In the first example there
are no active areas so just the cols, rows and touch type are
returned.</P>
<P STYLE="font-style: normal; font-weight: normal">In the second
example there is an touchZone area ( b ) which was touched, so the
active area cmd b is return</P>
<P STYLE="font-style: normal; font-weight: normal">In the third
example a touchActionInput was used and the edited text is also sent.</P>
<P><I><B>The pfodParser library (V3.1+) can parse this command and
provides methods to access it fields. (see the example below)</B></I></P>
<PRE CLASS="western">
 } else if ('A' == cmd) { <BR>   // user pressed menu item that loaded drawing with load cmd 'z'
   // parse rest of dwgCmd, return first char of active cmd
   byte dwgCmd = parser.parseDwgCmd(); <BR>   // can now call parser.getTouchedCol() and getTouchedRow()
   // and isPress(), isClick(), isDown(), isDrag(), isUp() or getTouchedType() 
   if ((dwgCmd == hPa_plot_cmd) &amp;&amp; parser.isClick()) {
     // open pressure plot if use clicked in touchZone
     // parser.editedText() returns char* to the editedText if any
   } else { // ignore and refresh 
     sendDrawingUpdates_z(); // update the drawing<BR>   }</PRE><H4 CLASS="western">
User Input Touch Resolution 
</H4>
<P> <SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Only
whole integer numbers are returned for user clicks drags etc.  The
detection resolution of </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">where
the user touched is in terms of the original (unscaled) touchZone's
cols x rows, not the scaled </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">size
shown on the screen after applying the current Zero scaling to the
touchZone.</SPAN></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">That is a
touchZone of 2 x 100  (2 cols x 100 rows) will always return integers
in the range 0 to 1 cols and 0 to 99 rows regardless of how it is
scaled to be displayed on the dwg.  For example scaling this
touchZone by 0.1 and placing it in a 20 x 20 dwg will still return
user input locations in the range 0 to 1 cols and 0 to 99 rows.  See
the code for the vertical and horizontal slider controls in the
<A HREF="https://www.forward.com.au/pfod/pfodParserLibraries/index.html" TARGET="_blank">pfodDwgsControls
library</A> 
</P>
<H3 CLASS="western">Touch Actions</H3>
<P><B>| X</B> ~ <I>cmd</I> ~ <I>Drawing
Primitive<BR></I><SPAN STYLE="font-style: normal"><B>dwgs.touchAction().cmd(</B></SPAN><I><SPAN STYLE="font-weight: normal">cmd</SPAN></I><SPAN STYLE="font-style: normal"><B>).action(
&hellip; ).send();</B></SPAN></P>
<P>Touch Actions are triggered when the associated touch zone (with
the same <I>cmd</I>) is triggered.  The touch zone is only triggered
if the touch type passes the configured touch filter.</P>
<P>When the touch action is triggered it updates the dwg with the
<B>Drawing Primitive</B><SPAN STYLE="font-weight: normal">
immediately, at the same time as</SPAN> the drawing cmd is set by
pfodApp.  This dwg update happens immediately on the screen, without
waiting for a response to come back from the pfodDevice.</P>
<P>There can be more then one Touch Action associated with a Touch
Zone cmd.</P>
<P>The <I>Drawing Primitive</I><SPAN STYLE="font-style: normal"> in
the Touch Action has access to the column and row being sent by
pfodApp with the touch cmd via the keywords </SPAN><SPAN STYLE="font-style: normal"><B>TOUCHED_COL</B></SPAN><SPAN STYLE="font-style: normal">
and </SPAN><SPAN STYLE="font-style: normal"><B>TOUCHED_ROW</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">.</SPAN></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">When the action is
triggered, but a touch in the associated touch zone, these keywords
are replaced by the respectively the Column and Row touched.</P>
<P STYLE="font-style: normal; font-weight: normal">When the drawing
update is returned from the pfodDevice, the drawing modifications
made by the touch action are discarded and the original drawing is
updated by the return message.</P>
<P STYLE="font-style: normal; font-weight: normal">If a touch active
area is removed, via the Erase cmd, all associated touch actions are
also removed. If a touch active area is hidden, via the Hide cmd,
then it is disabled and so all its touch actions are also disabled.</P>
<P STYLE="font-style: normal; font-weight: normal">The touch action
currently does not have a touch filter.  Any touch type that triggers
a cmd from the touch zone will trigger all the associated touch
actions.</P>
<H4 CLASS="western">TouchAction Example</H4>
<P STYLE="font-style: normal; font-weight: normal">Change Button
Colour 
</P>
<P STYLE="font-style: normal; font-weight: normal">To indicate to the
user that the button has been pressed, you can immediately change its
colour while waiting for the pfodDevice to respond to the command
sent.</P>
<PRE CLASS="western">  // button circle, initially black unfilled radius 6.75
  dwgsPtr-&gt;circle().idx(z_idx).color(dwgsPtr-&gt;BLACK).radius(6.75).send();

  // define touch zone, default filter is TOUCH if not specified.
  dwgsPtr-&gt;touchZone().cmd(cmd).size(6.75, 6.75).send(); 

  // add touch action to fill in circle with BLUE<BR>  // and increase is size slightly as soon as the touchZone touched. 
  // no .filter() means any type of touch will activate the cmd and action.<BR>  dwgsPtr-&gt;touchAction().cmd(cmd).action(
    dwgsPtr-&gt;circle().idx(z_idx).filled().color(dwgsPtr-&gt;BLUE).radius(8)   <BR>  ).send();</PRE><P STYLE="font-style: normal; font-weight: normal">
<BR><BR>
</P>
<P STYLE="font-style: normal">Note: the 'action' is a normal dwg cmd
but without the send() omitted i.e. 
</P>
<PRE CLASS="western" STYLE="font-style: normal">    dwgsPtr-&gt;circle().idx(z_idx).filled().color(dwgsPtr-&gt;BLUE).radius(8)   </PRE><P STYLE="font-style: normal; font-weight: normal">
<BR>Note: the dwg item being updated needs to have an index assigned,
idx( .. ) 
</P>
<H4 CLASS="western"><A NAME="__RefHeading__8125_860048826"></A>TouchActionInput
</H4>
<P><B>| XI</B> ~ <I>cmd</I> ~<I> DialogPromptText ` dwgIdxToEdit   
</I><SPAN STYLE="font-style: normal"><B>dwgs.touchActionInput().cmd(d_cmd).textIdx(label_idx).fontSize(3).color(dwgs.RED)<BR>.backgroundColor(dwgs.SILVER)<BR>.prompt(&quot;Enter
number\n&lt;-2&gt;&lt;i&gt;0.00 to 100.00&quot;).send();</B></SPAN><I><B><BR></B></I><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">Note: adding a
touchActionInput to a touchZone, that is not <B>TOUCH_DISABLED</B>,
forces the filter to <B>TOUCH</B>.</P>
<P STYLE="font-style: normal; font-weight: normal">The example sketch
<B>TouchActionInputExample_ESP8266.ino</B> in the pfodParser library
examples, illustrates the touchActionInput and the error checking of
the user's input</P>
<P><IMG SRC="EnterNumber_50.jpg" NAME="graphics63" ALIGN=BOTTOM WIDTH=151 HEIGHT=269 BORDER=0>
 
<IMG SRC="NotANumber_abc.jpg" NAME="graphics64" ALIGN=BOTTOM WIDTH=151 HEIGHT=269 BORDER=0>
 
<IMG SRC="NotInRange_110.jpg" NAME="graphics65" ALIGN=BOTTOM WIDTH=151 HEIGHT=269 BORDER=0>
</P>
<PRE CLASS="western" STYLE="font-style: normal; font-weight: normal"><FONT SIZE=1 STYLE="font-size: 8pt">pfodParser parser(&quot;V1&quot;); // parser with menu version messages</FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">pfodDwgs dwgs(&amp;parser);</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">pfodAutoIdx label_idx;</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">pfodAutoIdx errMsg_idx;</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">float f = 50;</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">const char d_cmd[] = &quot;di&quot;;</SPAN></FONT>
<FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-AU">cSF(sfErrMsg, 60);</SPAN></FONT></PRE><P STYLE="margin-bottom: 0cm">
<FONT SIZE=1 STYLE="font-size: 8pt"><I><B>. . . </B></I></FONT>
</P>
<P STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">
<BR>
</P>
<PRE CLASS="western" STYLE="font-style: normal; font-weight: normal"><FONT SIZE=1 STYLE="font-size: 8pt">void sendDrawing_a(long dwgIdx) { // send parts of dwg.</FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt">if (dwgIdx == 0) { // first part of dwg</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.start(50, 70, dwgs.WHITE, true); // true means more dwg to come</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">parser.sendRefreshAndVersion(0); // send the menu version, no dwg refresh</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.pushZero(25, 55); // change zero point and scale factor, if needed</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.rectangle().centered().size(15, 7).send(); // save place for label</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.index().idx(label_idx).send(); // save place for label</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.touchZone().cmd(d_cmd).centered().size(15, 7).send(); // cover label as well</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.touchActionInput().cmd(d_cmd).fontSize(3).color(dwgs.RED).backgroundColor(dwgs.SILVER)<BR>.prompt(&quot;Enter number\n&lt;-2&gt;&lt;i&gt;0.00 to 100.00&quot;).textIdx(label_idx).send();</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.popZero(); // restore previous zero setting</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.pushZero(25, 40);</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.index().idx(errMsg_idx).send(); // save place for error msg</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.popZero(); // restore previous zero setting</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.end();</FONT>

  <FONT SIZE=1 STYLE="font-size: 8pt">} else if (dwgIdx == 1) { // second part of dwg if larger then 1024 bytes</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">sendDrawingUpdates_a(); // send current values as last part of dwg</FONT>

  <FONT SIZE=1 STYLE="font-size: 8pt">} else {</FONT>
    <FONT SIZE=1 STYLE="font-size: 8pt">parser.print(F(&quot;{}&quot;)); // always return something</FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt">}</FONT>
<FONT SIZE=1 STYLE="font-size: 8pt">}</FONT>

<FONT SIZE=1 STYLE="font-size: 8pt">void sendDrawingUpdates_a() {</FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.startUpdate();  // display new number or perhaps errmsg</FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.label().idx(label_idx).fontSize(3).floatReading(f).decimals(2).send();</FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.label().idx(errMsg_idx).fontSize(1).center().bold().italic().color(dwgs.RED)</FONT>
<FONT SIZE=1 STYLE="font-size: 8pt">.text(sfErrMsg.c_str()).send();</FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt">sfErrMsg.clear(); // msg dissapears on refresh</FONT>
  <FONT SIZE=1 STYLE="font-size: 8pt">dwgs.end();</FONT>
<FONT SIZE=1 STYLE="font-size: 8pt">}</FONT></PRE><P STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">
<BR>
</P>
<P STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">
To process the user's input, SafeString is used to validate texts as
a number.</P>
<P STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">
<BR>
</P>
<PRE CLASS="western">      <FONT SIZE=1 STYLE="font-size: 8pt">} else if ('A' == cmd) {</FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt">parser.parseDwgCmd(); // need to call this first before using dwg cmd accessor methods</FONT>
                              <FONT SIZE=1 STYLE="font-size: 8pt">// like dwgCmdEquals() and getEditedText()</FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt">if (parser.dwgCmdEquals(d_cmd)) { // handle dialog data <BR>                                          // dwgCmd will be empty if this is not a dwg cmd</FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt">cSF(sfNum, 20);</FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt">sfNum.readFrom((const char*)parser.getEditedText()); // take at most first 20 chars</FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt">float new_f = 0;</FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt">if (sfNum.toFloat(new_f)) { // ok got valid new float</FONT>
            <FONT SIZE=1 STYLE="font-size: 8pt">if ((new_f &gt;= 0.0) &amp;&amp; (new_f &lt;= 100)) {</FONT>
              <FONT SIZE=1 STYLE="font-size: 8pt">f = new_f;</FONT>
            <FONT SIZE=1 STYLE="font-size: 8pt">} else {</FONT>
              <FONT SIZE=1 STYLE="font-size: 8pt">sfErrMsg = &quot;Number not in range 0 to 100\n&lt;bk&gt;&quot;;</FONT>
              <FONT SIZE=1 STYLE="font-size: 8pt">sfErrMsg.readFrom((const char*)parser.getEditedText());</FONT>
            <FONT SIZE=1 STYLE="font-size: 8pt">}</FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt">} else { // display error msg</FONT>
            <FONT SIZE=1 STYLE="font-size: 8pt">sfErrMsg = &quot;Not a number\n&lt;bk&gt;&quot;;</FONT>
            <FONT SIZE=1 STYLE="font-size: 8pt">sfErrMsg.readFrom((const char*)parser.getEditedText());</FONT>
          <FONT SIZE=1 STYLE="font-size: 8pt">}</FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt">}</FONT>
        <FONT SIZE=1 STYLE="font-size: 8pt">sendMainMenuUpdate(); // menu is cached just send update</FONT></PRE><P STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">
<BR>
</P>
<P>and to set an error message if it is invalid.</P>
<P>When the touchActionInput is triggered by a user's touch, it looks
up the dwg item with the <I><B>textIdx</B></I> and loads the current
text into the edit line of the dialog box, and shows it with the
given prompt text. If the dwg item indexed is not a <B>label</B> then
the initial text will be empty.</P>
<P>If the X button is pressed then the dialog is abandoned and not
message is sent.<BR>If the tick button is pressed the edited text is
sent to the pfodDevice for processing. e.g.</P>
<P STYLE="font-style: normal"><B>{A~di`3`0`0~45.44}</B></P>
<P STYLE="font-style: normal; font-weight: normal">where 45.44 was
the dialog edited text input.</P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">The
touchActionInput dialog user text input, the user's input is
automatically escapes </SPAN><B>{ } | ` ~</B><SPAN STYLE="font-weight: normal">
  before sending to the pfodDevice and the parser.getEditedText()
method automatically un-escapes these. </SPAN>
</P>
<P STYLE="font-style: normal"><B>dwgsPtr-&gt;label()</B><SPAN STYLE="font-weight: normal">
by default escapes these characters before sending so for drawings
you can freely enter restricted chars into a TouchActionInput dialog
and also send restricted chars in labels.</SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">For </SPAN><SPAN STYLE="font-weight: normal">TouchActionInput </SPAN><SPAN STYLE="font-weight: normal">
dialog user text input, the user's input is automatically escapes { }
| ` ~   before sending to the pfodDevice and the
parser.getEditedText() method automatically un-escapes these.  </SPAN>
</P>
<P STYLE="font-style: normal; font-weight: normal">So for drawings
you can freely enter restricted chars into a TouchActionInput dialog
and also send restricted chars in labels.</P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Unicode
sequences \u.... are automatically converted as they are typed in to
a TouchActionInput dialog.  e.g. Typing in \u2109 will display  </SPAN><FONT COLOR="#333333"><B>&#8457;</B></FONT><SPAN STYLE="font-weight: normal">
 in the TouchActionInput dialog.</SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">To
send the text </SPAN><B>\u2109</B><SPAN STYLE="font-weight: normal">
instead of </SPAN><FONT COLOR="#333333"><B>&#8457;</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">,
enter </SPAN></FONT><FONT COLOR="#333333"><B>&amp;#92;u2109</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
 <BR>When the TouchActionInput loads an existing label for editing,
it converts </SPAN></FONT><FONT COLOR="#333333"><B>\u....</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
to </SPAN></FONT><FONT COLOR="#333333"><B>&amp;#92;u....</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
to maintain the text.</SPAN></FONT></P>
<P STYLE="font-style: normal"><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">You
can suppress the pfodDevice, pfodParser from escaping these chars by
calling </SPAN></FONT><FONT COLOR="#333333"><B>doNotEncode()</B></FONT><FONT COLOR="#333333"><SUB><B>
</B></SUB></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">e.g.
<BR></SPAN></FONT><FONT COLOR="#333333"><B>dwgsPtr-&gt;touchActionInput().doNotEncode().
&hellip;.  .send();</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal"><BR>and
<BR></SPAN></FONT><FONT COLOR="#333333"><B>dwgsPtr-&gt;label().doNotEncode().
&hellip;.  .send();</B></FONT></P>
<P STYLE="font-style: normal; font-weight: normal"><FONT COLOR="#333333">in
which case you must manually escape any restricted characters,
otherwise they are just silently discarded before sending.</FONT></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Unicode
sequences \u.... are automatically converted as they are typed in to
a TouchActionInput dialog.  e.g. Typing in \u2109 will display  </SPAN><FONT COLOR="#333333"><B>&#8457;</B></FONT><SPAN STYLE="font-weight: normal">
 in the TouchActionInput dialog.</SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">To
send the text </SPAN><B>\u2109</B><SPAN STYLE="font-weight: normal">
instead of </SPAN><FONT COLOR="#333333"><B>&#8457;</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">,
enter </SPAN></FONT><FONT COLOR="#333333"><B>&amp;#92;u2109</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
 <BR>When the TouchActionInput loads an existing label for editing,
it converts </SPAN></FONT><FONT COLOR="#333333"><B>\u....</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
to </SPAN></FONT><FONT COLOR="#333333"><B>&amp;#92;u....</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
to maintain the text.</SPAN></FONT></P>
<P><FONT COLOR="#333333"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">You
can suppress the pfodDevice, pfodParser from escaping these chars by
calling </SPAN></SPAN></SPAN></FONT><FONT COLOR="#333333"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>doNotEncode()</B></SPAN></SPAN></FONT><FONT COLOR="#333333"><SUB><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>
</B></SPAN></SPAN></SUB></FONT><FONT COLOR="#333333"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">e.g.
<BR></SPAN></SPAN></SPAN></FONT><FONT COLOR="#333333"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>dwgsPtr-&gt;touchActionInput().doNotEncode().
&hellip;.  .send();</B></SPAN></SPAN></FONT><FONT COLOR="#333333"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal"><BR>in
which case you must manually escape any restricted characters,
otherwise they are just silently discarded before sending.</SPAN></SPAN></SPAN></FONT></P>
<H3 CLASS="western">Moving / Hiding/ Removing Active Areas and
Drawing Primitives</H3>
<P STYLE="font-style: normal; font-weight: normal">To move the
postion or size or touchFilter of an active area, just send it again
with the same activeCmd and the new position and size.  Note: All the
touchActions need to resent each time the touchZone is sent.  The
resent touchZone used the previously defined pushZero() that was in
effect when it was first sent.</P>
<P STYLE="font-style: normal; font-weight: normal">To hide (make
in-active) a touchZone use the HIDE dwg item  specifying the
activeCmd to be hidden.  Use UNHIDE to make the zone active again.</P>
<P STYLE="font-style: normal; font-weight: normal">To remove it
altogether, send the ERASE dwg item specifying the activeCmd to be
removed.  Do not send any position or size details with the erase.</P>
<P STYLE="font-style: normal; font-weight: normal"><B>| e ~
</B><I>&lt;activeCmd&gt;</I> 
</P>
<P STYLE="font-style: normal; font-weight: normal">e.g. to remove the
active region, activeCmd b,  used in the above example send</P>
<P STYLE="font-style: normal"><B>{+|~e~b}</B></P>
<P STYLE="font-style: normal; font-weight: normal">To move/update a
drawing primitive, send the new replacement primitive using the same
unique z-index to completely replace the old one with the new one BUT
still referenced to the pushZero( ) that was in effect when the index
was first seen. You can change circles to rectangles if you wish.  To
remove a drawing primitives send erase with the unique z-idx e.g. 
</P>
<P STYLE="font-style: normal"><B>| e ` 5</B></P>
<H4 CLASS="western">Drawing an Dwg 
</H4>
<H5 CLASS="western">Dwg Colours 
</H5>
<P>There are a number of ways to specify the colour of a Dwg, as
described in <I><B>Font Colour Format</B></I> above. You can use a
colour number from 0 to 255 to specify the colour from the 256 colour
pallett, eg 9 for RED.  You can also you the colour names eg r for
RED and the RGB hex value of the colour eg FF0000 for RED. 
</P>
<P>In the pfodParser library of support methods, eg
<B>dwgs.rectangle().colour(9).send()</B>, the colours are all
integers from the 256 colour palette.  If you want to use the hex or
string form of the colour you have to build the dwg primitive string
yourself.</P>
<H5 CLASS="western">Dwg Drawing Message Format</H5>
<P STYLE="font-weight: normal">To draw a Drawing rows high by columns
wide, where (0,0) is top left of the Drawing area, use the following
format 
</P>
<P><B>{+</B><I><SPAN STYLE="font-weight: normal">[&lt;backgroundColour&gt;]</SPAN></I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I>&lt;width&gt;</I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I>&lt;height&gt;
[</I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">~
</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;moreData&gt;</SPAN></I><I>
 [[`refreshInterval]</I><I><SPAN STYLE="font-weight: normal">  [</SPAN></I><SPAN STYLE="font-style: normal"><B>~
</B></SPAN><I><SPAN STYLE="font-weight: normal">&lt;version&gt;]]]<BR></SPAN></I><I><SPAN STYLE="font-weight: normal">&lt;dwg
Items&gt;<BR></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
 &hellip;. </SPAN></SPAN><SPAN STYLE="font-weight: normal">}</SPAN></P>
<P><SPAN STYLE="font-weight: normal">The </SPAN><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I><SPAN STYLE="font-weight: normal">&lt;width&gt;</SPAN></I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I><SPAN STYLE="font-weight: normal">&lt;height&gt;
</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
are required and indicate this messages is drawing an Dwg.</SPAN></SPAN></P>
<P>Where <SPAN STYLE="font-style: normal"> <BR></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
</SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">&lt;backgroundColour&gt;
</SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">is
the background of the Dwg using the same format as </SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">&lt;colour&gt;</SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
as </SPAN></SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">described
below.  If missing, it defaults to Black.</SPAN></SPAN></SPAN><SPAN STYLE="font-style: normal"><BR></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
&lt;width&gt; </SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
are the number of cols (width).   </SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">&lt;width&gt;</SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
is limited to 256 max.<BR> </SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">&lt;height&gt;
 </SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
are the number of rows (height).  </SPAN></SPAN></SPAN><I><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">&lt;height&gt;</SPAN></SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><SPAN STYLE="font-weight: normal">
is limited to 256 max.</SPAN></SPAN></SPAN></P>
<P STYLE="font-weight: normal"><SPAN STYLE="text-decoration: none">
<I>&lt;moreData&gt; </SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><B>m</B></SPAN></SPAN><I><SPAN STYLE="text-decoration: none">
</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
indicates there is more Dwg data to follow and that pfodApp should
send another request with the </SPAN></SPAN><I><SPAN STYLE="text-decoration: none">&lt;startingOffset&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
incremented by 1 from the previous request</SPAN></SPAN><I><SPAN STYLE="text-decoration: none">.</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
i.e. counts  from </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">zero
to 1 for the second request, 2 for the third and so on.  Any other
string is ignored, i.e. for moreData you must use </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none"><B>~m</B></SPAN></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal"><SPAN STYLE="text-decoration: none">
<I>&lt;refreshInterval&gt;</SPAN></I><SPAN STYLE="text-decoration: none">
A non-zero, non-empty value indicates that pfodApp should refresh the
drawing </SPAN><SPAN STYLE="text-decoration: none">after this delay,
in ms.  </SPAN><I><SPAN STYLE="text-decoration: none"><B>Note: There
must be a &lt;version&gt; for the drawing refresh to take effect.</B></SPAN></I><SPAN STYLE="text-decoration: none"><BR>
 Only drawings with versions specified will be refreshed.  Drawing
refresh responses are limited to </SPAN><SPAN STYLE="text-decoration: none">on
1023 byte msg</SPAN><SPAN STYLE="text-decoration: none"><B>.</B></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal"><SPAN STYLE="text-decoration: none">
</SPAN><I>&lt;version&gt;</I> is the <I>&lt;version&gt;</I> string of
this Dwg. <I><B>It must be the same format as menu </B></I><BR><I>&lt;version&gt;</I>
strings.  If the <I>&lt;version&gt;</I> is missing or blank, then the
existing Dwg version, if any, is unchanged by this load/reload of the
Dwg data. 
</P>
<P STYLE="font-weight: normal"><I><B>Note: if you are specifying a
</B></I><I>&lt;version&gt;</I><I><B> then ~ for the </B></I><I>&lt;moreData&gt;
</I><I><B>is required even if the  </B></I><I>&lt;moreData&gt; </I><I><B>is
empty .</B></I></P>
<P STYLE="font-weight: normal"><I><SPAN STYLE="text-decoration: none">&lt;dwg
Items&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="text-decoration: none">
&ndash; any of the Dwg Drawing Primitives described previously.</SPAN></SPAN></P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">On
receiving an Dwg response, if the </SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;moreData&gt;
</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">is
exactly </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>m</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,</SPAN></SPAN><I><SPAN STYLE="font-weight: normal">
</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">pfodApp
sends the another request </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">using
the same </SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;loadCmd&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
but decrementing the </SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;startingOffset&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
by 1. That is a negative </SPAN></SPAN><I><SPAN STYLE="font-weight: normal">&lt;startingOffset&gt;
</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
indicates a continuing Dwg drawing request and lets you send more dwg
items </SPAN></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">than
can fit in one response.</SPAN></SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">For these
subsequent messages you send an update message with the extra data,
see next section.</P>
<P STYLE="font-style: normal; font-weight: normal">When there is no
more Dwg data to send you can omit the <I>&lt;moreData&gt; </I>when
sending the last update message or just reply with an empty response
<BR><B>{}</B> <BR>or you can send <I>&lt;moreData&gt; </I>response
with no dwg updates (i.e. no more data) e.g.<BR><B>{+~m}</B></P>
<P STYLE="font-style: normal; font-weight: normal">Using this <I>no
data</I> message means you can have a hard coded message header,
including the <I>&lt;moreData&gt;</I> field, and just add the data to
each response.  When you run out of data, pfodApp will stop
requesting more.</P>
<H5 CLASS="western">Updating an existing Dwg</H5>
<P>When request a refresh of an existing Dwg (<B>parser.isRefresh()</B>
is true) you can send updates to the existing Dwg.</P>
<P><B>{+</B><I><SPAN STYLE="font-weight: normal">[</SPAN></I><SPAN STYLE="font-style: normal"><B>~
</B></SPAN><I><SPAN STYLE="font-weight: normal">&lt;moreData&gt;]</SPAN></I><I>
</I><B>| </B><I><SPAN STYLE="font-weight: normal">&lt;dwg Items&gt;</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
&hellip;. </SPAN></SPAN><SPAN STYLE="font-weight: normal">}</SPAN></P>
<P><I><B>Note:</B><SPAN STYLE="font-weight: normal"> The &lt;moreData&gt;
field is ignored in current pfodApp version. So updates/refreshes can
only </SPAN><SPAN STYLE="font-weight: normal">consist of a single
response (up to 1023 bytes long)</SPAN></I></P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
The Drawing drawing primitive updates follow. 
</P>
<P STYLE="font-style: normal; font-weight: normal; text-decoration: none">
These updates update the screen and also update the saved cached
Drawing.</P>
<P STYLE="text-decoration: none"><I><B>NOTE: Dwg updates should only
update existing drawing primitives, via their z-order index, or
existing touchZones, via their cmd.</B></I></P>
<H4 CLASS="western">Sending Dwgs and updates that are too large for a
single message</H4>
<P><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU">When
the drawing instructions will not fit into a single message the you
need to specify that more data is coming by adding a non blank </SPAN></FONT></TT><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>
</B></SPAN></SPAN></FONT></TT><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU"><I><SPAN STYLE="font-weight: normal">&lt;moreData&gt;
</SPAN></I></SPAN></FONT></TT><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">field
and handle the </SPAN></SPAN></SPAN></FONT></TT><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU"><I><SPAN STYLE="font-weight: normal">&lt;startingOffset&gt;</SPAN></I></SPAN></FONT></TT><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
command argument to distinguish between requests.  See the on-line
tutorial at </SPAN></SPAN></SPAN></FONT></TT><TT CLASS="western"><A HREF="http://www.pfod.com.au/"><SPAN LANG="en-AU">www.pfod.com.au</SPAN></A></TT><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
for an example.</SPAN></SPAN></SPAN></FONT></TT></P>
<P><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU"><I><B>NOTE:
</B></I></SPAN></FONT></TT><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU"><I><SPAN STYLE="font-weight: normal">In
the current version of pfodApp, dwg updates sent when
</SPAN></I></SPAN></FONT></TT><SPAN LANG="en-AU"><B>parser.isRefersh()</B></SPAN><TT CLASS="western"><FONT FACE="Times New Roman, serif"><SPAN LANG="en-AU"><I><SPAN STYLE="font-weight: normal">
is true, must fit in a single message.</SPAN></I></SPAN></FONT></TT></P>
<H2 CLASS="western">Update Menu Message  format</H2>
<P STYLE="margin-bottom: 0cm"><B>{;</B><I><SPAN STYLE="font-weight: normal">[menu
background if changed][~&lt;title if changed&gt;][`&lt;re-requestInterval
if changed&gt;]</SPAN></I><I>[|menu items that changed]*</I>  <B>}</B></P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P><I><B>Note: An update message cannot change the </B><SPAN STYLE="font-weight: normal">&lt;version&gt;</SPAN><B>
of a menu</B></I></P>
<P>This command updates the menu title and menu items on the
currently displayed menu screen.  The menu items are matched by
<I>&lt;cmd&gt;</I>.  You can update more then one menu item at a
time.</P>
<P>Only existing menu items can be updated with this message. 
Additional items cannot be added.  The type of a menu item e.g.
button, label, navigation button cannot be changed.  The update
message need not send the ! or ^ just the <I>&lt;cmd&gt;</I> is
enough.</P>
<P>The <I>&lt;re-requestTime ms&gt;</I><SPAN STYLE="font-style: normal">
is a request to the pfodApp to re-issue the command that returned
this </SPAN><SPAN STYLE="font-style: normal">update message in
</SPAN><I>&lt;re-requestTime ms&gt;</I><SPAN STYLE="font-style: normal">
milliseconds time. If it is missing then the current re-requestTime
remains unchanged.  To remove a re-requestTime, update with a value
of 0. </SPAN>
</P>
<P STYLE="font-style: normal">Usually update messages only change the
current value of a slider, but can also be used to change the
background colour and font formatting and hide or disable a button
with very few bytes.</P>
<P STYLE="font-style: normal">However you can use the update message
to completely revise the menu item.  Remembering that the menu item
type cannot be changed</P>
<P><SPAN STYLE="font-style: normal">See </SPAN><SPAN STYLE="font-style: normal"><U>Navigation Guidelines</U></SPAN><SPAN STYLE="font-style: normal">
for recommendations on how to use this message</SPAN></P>
<P><SPAN STYLE="font-style: normal">Also note the comments above,  </SPAN><SPAN STYLE="font-style: normal"><U>Navigation Guidelines</U></SPAN><SPAN STYLE="font-style: normal">
responding to slider menu commands with an Update menu message</SPAN></P>
<H4 CLASS="western">Examples</H4>
<P><B>{;} </B> does nothing to the current menu screen</P>
<H4 CLASS="western">Slider Updates</H4>
<P>If the current menu has a slider (or On/Off toggle button) then
when the user moves the slider, the associated command and the
current value will be sent to the pfodDevice.  The pfodDevice should
respond with an update to the current menu with the current slider
value.</P>
<P>For Example</P>
<P>pfodApp send {a`5}</P>
<P>The pfodDevice parses this command and save the user's current
value, 5, and then returns a menu update for the slider</P>
<P>pfodDevice responds  {;|a`5}</P>
<P>The rest of the menu is unchanged. The slider's text and max and
min are also unchanged.  Only its current value is updated.</P>
<H5 CLASS="western">Note About Slider Updates</H5>
<P STYLE="font-weight: normal">As the user adjusts the slider, the
pfodApp may, but is not required to, send out a stream of updates
with the current slider positions.  These messages, if sent, are
exactly the same as show above and as with all messages sent from the
pfodApp, only one message at a time is sent.  The pfodApp waits for a
response from the pfodDevice before sending then next update with the
new position, if any.  This gives the slider a 'dynamic' feel.</P>
<P STYLE="font-weight: normal">In the pfodDevice code, you cannot
tell if this message from the pfodApp is an update or the user's
final setting, so each message should be treated the same and MUST be
responded to even if only with and empty, {}, message.</P>
<P STYLE="font-weight: normal">Your pfodDevice should respond to each
slider message in as if it was the final setting.  It is the pfodApp
responsibility to handle the responses so that the user's adjustment
is not interrupted.</P>
<P STYLE="font-weight: normal">The pfodApp can tell if the user is
still adjusting the slider and so can ignore response that would
change the screen layout while the user is adjusting the slider.</P>
<P STYLE="font-weight: normal"><IMG SRC="V2_RGB_demoScreen.png" NAME="graphics14" ALIGN=BOTTOM WIDTH=192 HEIGHT=320 BORDER=0><BR><BR>However
the well coded pfodApp will attempt to update the screen's prompt
text from a Update menu response {; ..  
</P>
<P STYLE="font-weight: normal">That is if your pfodDevice responds to
a slider message with an Update menu response <BR><B>{;~</B><I>&lt;updated
screen prompt&gt;</I> &hellip; <B>}</B><BR>then the pfodApp will
attempt to update the screen prompt with this new text, provided the
new text fits within the existing available space.  This lets you
adjust the prompt text to reflect the changing value of the slider.  
</P>
<P STYLE="font-weight: normal">For example to update the currently
selected colour setting as the user adjusts the sliders.</P>
<P STYLE="font-weight: normal">Here each slider command from the
pfodApp is responded to with an Update menu message with the current
settings,</P>
<P STYLE="font-weight: normal">While the user is adjusting the slider
only the screen prompt is updated. The rest of the Update menu
response is ignored while the user is adjusting the slider.</P>
<P STYLE="font-weight: normal">When the user completes the
adjustment, i.e. stops touching the screen, then a final slider
command is sent and the response to that command is completely acted
on by pfodApp.</P>
<P STYLE="font-weight: normal">In order to ensure that your updated
prompt is seen, your should make sure the initial prompt text is
large enough to reserve enough space on the screen to accommodate any
updates the pfodDevice sends.</P>
<H2 CLASS="western">Refresh and Menu Caching</H2>
<P>pfodApp V2 has an improved refresh message and menu caching which
markedly reduces the amount of data that needs to be sent by the
pfodDevice.  This is particularly important for Bluetooth Low Energy
and SMS connections.</P>
<H3 CLASS="western">Refresh Messages</H3>
<P>If you set a re-request interval for a menu so that you can
display changing data, then pfodApp will re-request that menu at
regular intervals by sending the original command that produced that
menu response.</P>
<P>That is if the command {a} sent by pfodApp resulted in the
pfodDevice returning a menu message, 
</P>
<P><B>{, ~My Menu `1000 |  &hellip;. }</B></P>
<P>then no <I>&lt;version&gt;</I> has been set for this menu and
every 1000ms (every 1Sec) pfodApp will re-request the same menu by
sending the command 
</P>
<P><B>{a}</B></P>
<H3 CLASS="western">Menu Caching</H3>
<P>The simple menu refresh system described above requires you to
resend the entire menu in response to each refresh request.</P>
<P>However pfodApp V2 has menu caching.  If you add a non-empty
<I>&lt;version&gt;</I> to your original menu response, pfodApp will
cache that menu and then every time pfodApp needs to re-request or
redisplay that menu, pfodApp will send the 
</P>
<P><B>{</B>&lt;v<I>ersion&gt;</I><B>:</B><I>&lt;cmd&gt;</I><B>}</B></P>
<P>Your device code can then check the <I>&lt;versionNo&gt;</I>
string against its current version and if they match you need only
send but the current updates to that menu instead of the whole menu.</P>
<P>The pfodParser Arduino library does this check automatically and
will set parser.isRefesh() to true is the versions match.</P>
<P>&lt;v<I>ersion&gt;</I> is a string consisting of only the
characters a .. z,  A .. Z, 0..9  . (dot) and _ (underscore). 
pfodApp will completely ignore versionsNo that do not follow this
format.</P>
<P>e.g. The following are valid <I>&lt;version&gt;</I><BR><B>10.5<BR>Ver_5_3<BR></B><B>MyVersion2</B></P>
<P>In principle you can have a different version for each menu,
however for simplicity the Arduino pfodParser library has just on
version for all the menus.  The pfodParser library parses this type
of command and strips out the <I>&lt;version&gt;</I> string, if
present and compares it to the <I>&lt;version&gt;</I> string the
parser was initialized with.  If they match then the
parser.isRefresh() flag is set.  Your code can then check this flag
to see if you can just send an update instead of the full menu.</P>
<P>Of course you can just ignore this flag completely and always send
back the full menu.</P>
<P>This cache of menus is maintained across multiple connects and
disconnects.  So the next time you connect, pfodApp will only request
a refresh for its cached menu.</P>
<H2 CLASS="western">Streaming raw data Message format (Display)</H2>
<P STYLE="margin-bottom: 0cm"><B>{= </B><I>[&lt;title&gt;]</I> <B>}</B></P>
<P>This message tells the pfodApp to display a screen showing
streaming raw data with the given title.</P>
<P>The pfodDevice can send any streaming raw data that does not
contain the character sequences  <B>{,</B> or <B>{;</B> or <B>{.</B>
or <B>{:</B> or <B>{'</B> or <B>{?</B> or <B>{#</B> or <B>{*</B> or
<B>{^</B> or <B>{=</B> or {@ or <B>{}</B> or {_<BR>at any time. If
the connection supports escape sequences then the { can be escaped to
send any sequence of characters.</P>
<P>It is optional whether on not the pfodApp displays previously
received streaming raw data or only data received after processing
this message.</P>
<P>Typically this command is used to show some information about the
pfodDevice' status, either once or continually updating. 
</P>
<P STYLE="margin-bottom: 0cm">When the user closes the streaming raw
data screen, usually by user pressing the back button, the pfodApp
either displays the previous screen or re-requests it from the
pfodDevice.</P>
<H4 CLASS="western" STYLE="page-break-before: auto">Examples</H4>
<P><B>{=}</B>  Opens the streaming raw data screen without a title
specified.</P>
<P><B>{=Temperature Readings}</B> Opens the streaming raw data screen
with a title of Temperature Readings.</P>
<P>When the pfodApp opens the streaming raw data screen it
automatically starts saving the data to a file.  The pfodApp
maintains a cache if some of the most recent data which is also saved
when the screen is opened.</P>
<P STYLE="margin-bottom: 0cm"><IMG SRC="streamingRawDataTempSensor.png" NAME="graphics24" ALIGN=BOTTOM WIDTH=30% BORDER=0><BR><BR>
</P>
<P>Data can be sent at any time the pfodDevice is not sending another
message, provided it does not contain an un-escaped the start of
command, <B>{</B> , character followed by one of the messages a
pfodDevice can send, i.e. <B>{,</B> or <B>{;</B> or <B>{'</B> or <B>{?</B>
or <B>{#</B> or <B>{*</B> or <B>{^</B> or <B>{=</B> or {@ or <B>{}</B>
or {_.  The negotiated text formatting determines if escape sequences
are supported.  
</P>
<P>Whether this data is captured or ignored when the pfodApp is not
showing the Streaming Raw Data screen is up to the pfodApp
application.</P>
<P><B>Note: Although the Streaming Raw Data title and other display
text shown by pfodApp will accept UTF-8 encoded characters, the raw
data is limited to US-ASCII  &lt;space&gt; to ~  plus &lt;linefeed&gt;
and &lt;carriage return&gt;</B></P>
<P><B>No decoding of UTF-8 bytes is performed on the displayed raw
data, however the UTF-8 bytes are saved to the rawData file and can
be viewed later.</B></P>
<H2 CLASS="western">Streaming raw data Message format (Plotting)</H2>
<P><B>{=</B><I>[&lt;screenTitle&gt;][ `&lt;maxPoints&gt;]
[~plotOption[~plotOption]]| [&lt;title&gt;][ ` &lt;plotNo&gt; [~
&lt;max&gt; [~ &lt;min&gt;[~ &lt;unit&gt;]]]]<BR>  [ | [&lt;title&gt;]
[ ` &lt;plotNo&gt; [~ &lt;max&gt; [~ &lt;min&gt;[~ &lt;unit&gt;]]]]]*
</I><B>} </B>
</P>
<H3 CLASS="western">Overview</H3>
<P>This extended version of the raw data message is used to tell the
pfodApp to produce a dynamic plot of the CSV (comma separated values)
formatted raw data.</P>
<P>Each line of raw data, terminated by CR, CR LF or LF, is processed
be the pfodApp and grouped by the number of comma separated fields in
the line of data.</P>
<P>The number of  | (bar) sections in the plotting command is matched
against the number fields in the data lines.  Only those lines that
have the same number of fields as the number of | (bar) sections in
the command are plotted.</P>
<P>Bar |  sections in the plotting command can be empty, in which
case that field is ignored.</P>
<P>Non-empty bar | sections indicate fields that are to be plotted.</P>
<H4 CLASS="western">Quick Start for Plotting Messages</H4>
<P>For simple plots, output your raw data in CSV format with the
x-axis as the first numeric fields. You can have text fields as well
but you cannot plot them. Then construct a plot message with exactly
the same number of bar section | as there are data fields (including
text fields) and put the name of the fields you want to plot the
corresponding bar section. 
</P>
<P>For example if the raw data is <BR><SPAN STYLE="font-style: normal"><B>motor
values, 1.5, 3300.0 ,0 ,0<BR>motor values, 2.5, 3300.0, 0, 0<BR>motor
values, 2.5, 3300.0, 0, 0<BR>motor values, 3.5, 3300.0, 4727.5, 255</B></SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Then
this data has 5 fields and the plot message must also have 5 bars, |
<BR></SPAN><B>{=Example Plot||time(sec)||Motor rpm|Pwm}</B><SPAN STYLE="font-weight: normal">
 <BR>This message results in the following plot</SPAN></P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="pfodSpecificationV3.0.18_html_3e8ed64.png" NAME="graphics32" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0></P>
<P STYLE="font-style: normal; font-weight: normal">The plot is
updated about once a second. You can freeze the plot by holding your
finger down on it. You can also drag the plot around using your
finger and you can zoom or pinch the plot by using two fingers.</P>
<P STYLE="font-style: normal; font-weight: normal">For finer grained
control of the plots, including setting scales and putting multiple
plots on the same chart, and handling multiple data sets, see the
detailed description and examples below.<BR><BR><BR>
</P>
<H3 CLASS="western">Description of Plotting Message Format</H3>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm; page-break-before: auto">
<I>&lt;screenTitle&gt;</I><SPAN STYLE="font-style: normal">  &ndash;
Optional, if present set the title of the plot</SPAN></P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm; page-break-before: auto">
<I>&lt;maxPoints&gt;</I><SPAN STYLE="font-style: normal"> &ndash;
Optional, if present sets the maximum number of points to display for
each plot. If missing an pfodApp specific default is used. For the
Forward Computing pfodApp this default is 500 points.  Once the
number of points exceeds this setting the oldest points are </SPAN><SPAN STYLE="font-style: normal">dropped.
 This prevents the plot becoming to compressed.</SPAN></P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm"><SPAN LANG="en-AU"><I>&lt;plotOption&gt;</I></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal">
&ndash; Optional<BR>If 'C' is present, (e.g. ~C), it clears the plot
of all previously downloaded rawData and only show rawData sent after
this plot message is processed.<BR>If 'S' is present, (e.g. ~S), the
X-axis data is sorted before display. Default is to NOT sort the
X-axis but just display in the order it arrives.<BR>Any other single
letter options are ignored.<BR>The first remaining (non-single
letter) option  is taken as the Elapsed or Date/Time format for the 
the X-axis.  <BR><BR>For Elapsed Time formats display the millisecond
timestamps as seconds, mins, hrs and days<BR>The valid formats
are:-<BR></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>ss</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
&ndash; sec  eg  128<BR></SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>mm:ss</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
&ndash; mins sec  e.g. 72:18 i.e. mins can exceed 60<BR></SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>HH:mm:ss</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
&ndash; hrs mins secs  e.g.  34:15:05  i.e. hrs can exceed 24</SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><BR></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>d
HH:mm:ss</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
&ndash; days, hr mins, sec  e.g. 55d 13:22:04<BR>Optionally upto 3
decimal places can be specified for the seconds on any of these
formats, </SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">i.e.
</SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>ss</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
 </SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>ss.S
</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
</SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>ss.SS</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
or </SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>ss.SSS<BR><BR></B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
any other Java Date and Time formatting is used, (see
</SPAN></SPAN></SPAN><A HREF="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html"><SPAN LANG="en-AU">https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html</SPAN></A><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">),
 e.g. yyyy/MM/dd, etc, then date/time is displayed.<BR>Internally
pfodApp converts absolute rawdata date/time timestamps, e.g.
2019/04/13 15:34:55, to the equivalent milliseconds since 1970 Jan
1</SPAN></SPAN></SPAN><SUP><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">st
  </SPAN></SPAN></SPAN></SUP><SPAN LANG="en-AU">This means when it
comes to plot the data, the plot routine only sees millisecond
timestamps.</SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal"><BR>If
the millisecond timestamp is &lt;  2^40 (i.e. equivalent to about the
year 2005), then it is considered to be a millisecond offset to the
'current' date/time returned by the {@} response<BR>Otherwise if the
millisecond &gt; 2^40, then the plot routine assumes the original
rawData timestamps was an absolute date and time. <BR></SPAN></SPAN></SPAN><SPAN LANG="en-AU"><I><SPAN STYLE="font-weight: normal"><BR></SPAN></I></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">For
Date and Time the suffix </SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>UTC</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
can be specified to display the date and time in UTC instead of local
time.<BR>The Elapsed Time formats, above, can be suffixed with </SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>DATE</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
or </SPAN></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><B>UTC</B></SPAN></SPAN><SPAN LANG="en-AU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
to force them to be used as formats for dates and times in local or
UTC.</SPAN></SPAN></SPAN></P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm"><SPAN STYLE="font-style: normal"><BR>See
</SPAN><A HREF="#9.8.2.5.Date/Time Example Plots|outline"><SPAN STYLE="font-style: normal">Date/Time
Plots</SPAN></A><SPAN STYLE="font-style: normal"> examples below.<BR></SPAN><BR><BR>
</P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm; page-break-before: auto">
<I>|</I><SPAN STYLE="font-style: normal"> &ndash; (bar) Mandatory, at
least one non-empty bar section must be present in the message in
order to produce a plot.  If there are no bar sections, the raw data
is shown in at text screen.  If all the </SPAN><SPAN STYLE="font-style: normal">bar
sections are empty, then an empty plot is shown.</SPAN></P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm; page-break-before: auto">
<I>[&lt;title&gt;]</I><SPAN STYLE="font-style: normal"> &ndash;
Optional, if present sets the title for this plot line or the X-axis
title if this is the X-axis </SPAN><SPAN STYLE="font-style: normal">field.
If missing the plot line is labelled </SPAN><SPAN STYLE="font-style: normal"><B>Plot
</B></SPAN><I><B>n</B></I><SPAN STYLE="font-style: normal">  (where </SPAN><I>n</I><SPAN STYLE="font-style: normal">
is an incremental number).</SPAN></P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm; page-break-before: auto">
<I>&lt;plotNo&gt;</I><SPAN STYLE="font-style: normal"> &ndash;
Optional (integer, non-integers are treated as blank), if present and
non-zero, set the sub-plot this field is plotted on.  The numbers
need not be consecutive.  Fields with the same abs(</SPAN><I>plotNo</I><SPAN STYLE="font-style: normal">)
are plotted on the same sub-plot</SPAN></P>
<P STYLE="margin-left: 1.25cm"><SPAN STYLE="font-style: normal">If
ALL </SPAN><I>plotNo</I><SPAN STYLE="font-style: normal"> are missing
(or blank), then the first field is used as the X-axis. So it is an
</SPAN><SPAN STYLE="font-style: normal">advantage to structure your
raw data so that the x-axis value appears as the first numeric field.
If more then one </SPAN><I>plotNo</I><SPAN STYLE="font-style: normal">
is 0 then the first field with plotNo 0 is used as the X-axis</SPAN></P>
<P STYLE="margin-left: 1.25cm"><SPAN STYLE="font-style: normal">If
there is at least one non-blank </SPAN><I>plotNo</I><SPAN STYLE="font-style: normal">
then fields with missing plotNo are plotted in their own sub-plot and
the bar field with </SPAN><I>plotNo</I><SPAN STYLE="font-style: normal">
0 indicates the X-axis field and the absolute </SPAN><SPAN STYLE="font-style: normal">value
of other plotNo are used to assign fields to plots.  If there is no
</SPAN><I>plotNo</I><SPAN STYLE="font-style: normal"> 0 then the data
</SPAN><SPAN STYLE="font-style: normal">count is used as the X-axis. </SPAN>
</P>
<P STYLE="margin-left: 1.25cm"><SPAN STYLE="font-style: normal">If
there is only one field to be plotted, the </SPAN><I>plotNo</I><SPAN STYLE="font-style: normal">
is ignored (even if it equals 0) and the X-axis becomes the data
record count.</SPAN></P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm; page-break-before: auto">
<I>&lt;max&gt;</I><SPAN STYLE="font-style: normal"> &ndash; Optional,
if non-blank parsed as a float to set the initial maximum value of
the plot.  If the plot data exceeds this value the plot will be
re-scaled to accommodate the larger values.</SPAN></P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm; page-break-before: auto">
<I>&lt;min&gt;</I><SPAN STYLE="font-style: normal"> &ndash; Optional,
if non-blank parsed as a float to set the initial minimum value of
the plot.  If the plot data is less then this value the plot will be
re-scaled to accommodate the smaller values.</SPAN></P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm; page-break-before: auto">
<I>&lt;unit&gt;</I><SPAN STYLE="font-style: normal"> &ndash;
Optional, if non-blank used to set the axis title. Useful when
plotting multiple fields on one sub-plot, in which case the first
non-blank </SPAN><I>&lt;unit&gt;</I><SPAN STYLE="font-style: normal">
become the y-axis label for this sub-plot.</SPAN></P>
<P STYLE="margin-left: 1.21cm; text-indent: -1.23cm; font-style: normal">
<BR><BR>
</P>
<P><B>Note: Although the plotting title and axis labels other display
text shown by pfodApp will accept UTF-8 encoded characters, the raw
data is limited to US-ASCII  &lt;space&gt; to ~  plus &lt;linefeed&gt;
and &lt;carriage return&gt;</B></P>
<P STYLE="margin-bottom: 0cm; font-style: normal"><B>No decoding if
UTF-8 bytes is performed on raw data.  All numbers to be plotted must
be sent in US-ASCII.</B></P>
<H4 CLASS="western">Examples (one data value)</H4>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
the raw data is :-<BR></SPAN></SPAN><B>4727<BR>4745</B><BR>&hellip;
etc.<BR>i.e. just one number (one field) per line.</P>
<P><SPAN STYLE="font-style: normal"><B>{=Example Plot | }</B></SPAN><SPAN STYLE="font-style: normal">
Just show the raw data as text since no fields have been specified
for plotting.</SPAN></P>
<P><SPAN STYLE="font-style: normal"><B>{=Example Plot |rpm}</B></SPAN><SPAN STYLE="font-style: normal">
Show data on the y-axis (using the field </SPAN><I>title</I><SPAN STYLE="font-style: normal">
as the y-axis title) and the data </SPAN><SPAN STYLE="font-style: normal">count
on the x-axis, since there is only one field to plot.  </SPAN>
</P>
<P><IMG SRC="pfodSpecificationV3.0.18_html_m424ac3f4.png" NAME="graphics18" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0><SPAN STYLE="font-style: normal"><BR></SPAN><BR><BR>
</P>
<P><SPAN STYLE="font-style: normal"><B>{=Example Plot`20 |rpm}</B></SPAN><SPAN STYLE="font-style: normal">
Show last 20 data points on the y-axis (using the field </SPAN><I>title</I><SPAN STYLE="font-style: normal">
as the y-axis title) and the data count on the x-axis, since there is
only one field to plot.</SPAN></P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_21e13b42.png" NAME="graphics23" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0><B><BR></B><BR><BR>
</P>
<P STYLE="font-style: normal"><B>{=Example Plot |rpm~~0}</B> Show
data points on the y-axis, with min scale value of at least 0, will
auto scale if data goes below this minimum. Maximum value is missing
(blank) so just auto scale maximum y-axis. The data count is the
x-axis, since there is only one field to plot.</P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_m6c08e1ed.png" NAME="graphics25" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0></P>
<H4 CLASS="western">Examples (more then one data value)</H4>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
the data has more then one field such as:-<BR></SPAN><B>motor values,
1.5, 3300.0 ,0 ,0<BR></B><B>motor values, 2.5, 3300.0, 0, 0<BR>motor
values, 2.5, 3300.0, 0, 0<BR></B><B>motor values, 3.5, 3300.0,
4727.5, 255<BR>motor values, 4.5, 3300.0, 4745.5, 219<BR></B><B>motor
values, 5.5, 3300.0, 4667.5, 219</B><SPAN STYLE="font-weight: normal"><BR>&hellip;.
etc.</SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">Note the field
values can have decimal values or can be strings. String values
cannot be plotted.</P>
<P STYLE="font-style: normal"><B>{=Example Plot | | | |rpm| }</B><SPAN STYLE="font-weight: normal">
Show data on the y-axis (using the field </SPAN><I><SPAN STYLE="font-weight: normal">title</SPAN></I><SPAN STYLE="font-weight: normal">
as the y-axis title) and the data count on the x-axis, since there is
only one field to plot.</SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">Important Note:
The number of bar sections MUST match the number of data fields in
the raw data. In this data there are 5 fields, so the plot message
MUST have 5 bars, one for each data field, even if the that raw data
values are text or are not plotted.</P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_576b7552.png" NAME="graphics26" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0><SPAN STYLE="font-weight: normal"><BR></SPAN><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal">Even if the data
has more then one field, if the message only has one non-blank field,
the x-axis will be the count.</P>
<P STYLE="font-style: normal"><B>{=Example Plot | |time(sec)| |rpm| }</B><SPAN STYLE="font-weight: normal">
Show the rpm data on the y-axis (using the field </SPAN><I><SPAN STYLE="font-weight: normal">title</SPAN></I><SPAN STYLE="font-weight: normal">
as the y-axis title) and the time data as the x-axis.  Since there
are no </SPAN><I><SPAN STYLE="font-weight: normal">plotNo</SPAN></I><SPAN STYLE="font-weight: normal">
specified and more then one field is specified, the first one is used
as the x-axis.</SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Note:
the | | skips the first field  </SPAN><B>motor values</B></P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_931fbba.png" NAME="graphics27" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0><B><BR></B><SPAN STYLE="font-weight: normal">Note:
If you accidentally specify a text data value as the X-axis nothing
will be plotted.</SPAN><B><BR></B><SPAN STYLE="font-weight: normal"><BR></SPAN><B>{=Example
Plot | |time(sec)|RPM Setpoint|rpm| }</B><SPAN STYLE="font-weight: normal">
Show the rpm and set point data in separate plots with time as the
x-axis.  Since there are no </SPAN><I><SPAN STYLE="font-weight: normal">plotNo</SPAN></I><SPAN STYLE="font-weight: normal">
specified and more then one field is specified, the first non-blank
field is used as the x-axis.</SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Note:
the | | skips the first field  </SPAN><B>motor values</B></P>
<P STYLE="font-style: normal; font-weight: normal"><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="pfodSpecificationV3.0.18_html_m788bda9.png" NAME="graphics28" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0></P>
<P STYLE="font-style: normal; font-weight: normal">As you can see
above constant values result in long y-axis ticks.  This can be
overcome by specifying a ~max~min for that plot, i.e.</P>
<P STYLE="font-style: normal"><B>{=Example Plot | |time(sec)|RPM
Setpoint~4000~3000|rpm| }</B><SPAN STYLE="font-weight: normal"> Show
the rpm and set point data in separate plots, setting the initial
scale for the set point plot, with time as the x-axis.  Since there
are no </SPAN><I><SPAN STYLE="font-weight: normal">plotNo</SPAN></I><SPAN STYLE="font-weight: normal">
specified and more then one field is specified, the first non-blank
field is used as the x-</SPAN><SPAN STYLE="font-weight: normal">axis.</SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Note:
the | | skips the first field  </SPAN><B>motor values</B></P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_m1c2b8273.png" NAME="graphics29" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0><SPAN STYLE="font-weight: normal"><BR></SPAN><BR><BR>
</P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">To
plot the RPM Setpoint and the current rpm on the same plot you need
to assign </SPAN><I><SPAN STYLE="font-weight: normal">plotNo</SPAN></I><SPAN STYLE="font-weight: normal">s,
i.e. </SPAN><BR><B>{=Example Plot | |time(sec)`0|RPM
Setpoint`1|rpm`1| }</B><SPAN STYLE="font-weight: normal"> Show the
rpm and set point data in the same plot against time.<BR>Note: If you
use </SPAN><I><SPAN STYLE="font-weight: normal">plotNo</SPAN></I><SPAN STYLE="font-weight: normal">s
you need to specify the x-axis as </SPAN><I><SPAN STYLE="font-weight: normal">plotNo</SPAN></I><SPAN STYLE="font-weight: normal">
0</SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Note:
the | | skips the first field  </SPAN><B>motor values</B></P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_65232248.png" NAME="graphics30" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0><SPAN STYLE="font-weight: normal"><BR></SPAN><BR><BR>
</P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
you want a y-axis label when there are two or more lines on the one
plot, then you need to specify a </SPAN><I><SPAN STYLE="font-weight: normal">unit.</SPAN></I><SPAN STYLE="font-weight: normal">
</SPAN>
</P>
<P STYLE="font-style: normal"><B>{=Example Plot |
|time~~~sec`0|Setpoint`1~~~rpm|Motor`1| }</B><SPAN STYLE="font-weight: normal">
Show the rpm and set point data in the same plot against time. Use
</SPAN><B>rpm</B><SPAN STYLE="font-weight: normal"> as the y-axis
label.  This message also sets the x-axis units to </SPAN><B>sec</B><SPAN STYLE="font-weight: normal">.</SPAN></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Note:
the | | skips the first field  </SPAN><B>motor values</B></P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_19f133c.png" NAME="graphics31" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0><SPAN STYLE="font-weight: normal"><BR></SPAN><SPAN STYLE="font-weight: normal"><BR>The
final example using this raw data, will plot all the fields. 
Setpoint rpm with Motor rpm on one chart and the Drive pwm on
another.</SPAN></P>
<P STYLE="font-style: normal"><B>{=Example
Plot||sec`0|Setpoint~~~rpm`2|Motor`2|Drive PWM`1}</B></P>
<P STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">Note:
the | | skips the first field  </SPAN><B>motor values</B></P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_5285eede.png" NAME="graphics33" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0></P>
<H4 CLASS="western">Examples (phase plots)</H4>
<P>As noted above you can specify which field is used as the x-axis. 
This means you can easily generate phase plots.</P>
<P>For example if you have the following GPS data
(time,latitude,longitude)</P>
<P><B>1.0,51.71584,8.74367<BR>2.0,51.71584,8.74367<BR></B><B>3.0,51.71584,8.74367<BR>4.0,51.71584,8.74368<BR></B>&hellip;
 etc.</P>
<P STYLE="font-weight: normal">Then</P>
<P><B>{=GPS
Position||Position`1~51.7158~51.71575~Latitude|`0~8.7438~8.7434~Longitude}</B></P>
<P STYLE="font-weight: normal">will generate a 'phase' map of the
path</P>
<P><IMG SRC="pfodSpecificationV3.0.18_html_14b2aaa5.png" NAME="graphics34" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0><BR><BR><BR>
</P>
<H4 CLASS="western">Examples (multiple datasets)</H4>
<P>The plotting message can also handle intermixed multiple datasets,
provided they have different numbers of fields (you can always add a
trailing , when the pfodDevice writes one of them to introduce an
additional blank field if you need to).</P>
<P>For example the raw data may be a mixture of of GPS data and motor
parameters, e.g.</P>
<P STYLE="font-style: normal"><B>1.0,51.71584,8.74367 <BR>motor
values, 1.5, 3300.0 ,0 ,0<BR>2.0,51.71584,8.74367<BR>motor values,
2.5, 3300.0, 0, 0<BR>motor values, 2.5, 3300.0, 0,
0<BR>3.0,51.71584,8.74367<BR>motor values, 3.5, 3300.0, 4727.5,
255<BR>4.0,51.71584,8.74368<BR></B><B>motor values, 4.5, 3300.0,
4745.5, 219<BR></B><SPAN STYLE="font-weight: normal">&hellip;  etc.</SPAN></P>
<P STYLE="font-style: normal; font-weight: normal">In this case the
plot messages shown above still work as they did previously because
each plot message only targets those data lines the the same number
of fields as the number of bars | in the message. 
</P>
<H4 CLASS="western"><A NAME="9.8.2.5.Date/Time Plots|outline"></A>Date/Time
Plots</H4>
<P>Only X-axis Date/Time or Elapsed Time formats are supported.  The
raw data must be in either date/time (which is converted internally
to milliseconds since 1<SUP>st</SUP> Jan 1970 UTC) or milliseconds. 
If the millisecond timestamp is &gt; 2^38, then it is assumed to be a
date after ~1979 converted to milliseconds.</P>
<H5 CLASS="western">RawDate Date/Time format</H5>
<P>The format is:-<BR>yyyy/MM/dd HH:mm:ss.SSS 
</P>
<P>e.g. 2019/04/30 14:05:31.502</P>
<P>Trailing parts of the Date/Time can be omitted.  For example the
follow dates are valid:-</P>
<P>2019/04<BR>2019/04/30<BR>2019/04/30 14:05 
</P>
<P STYLE="font-style: normal; font-weight: normal">Internally,
pfodApp identifies the date format, by counting the number of / and :
in the field and then converts the raw data date/time to the number
of milliseconds since 1<SUP>st</SUP> Jan 1970 UTC.  That becomes the
plot data.  
</P>
<P><I><B>Note: Dates must have at least year and month, as numbers,
and times must have at least hours (24hrs) and mins. There is a
single space between the day and the hours.</B></I></P>
<P STYLE="font-style: normal; font-weight: normal">If the date/time
field is not in a valid format, it will be treated as text and that
record will not be plotted.</P>
<P STYLE="font-style: normal; font-weight: normal">Here is some valid
sample RawData with date/time timestamps (comma separated) sent from
the pfodDevice to the pfodApp</P>
<P STYLE="font-style: normal"><B>2019/04/02
22:06:41,24.62,69<BR>2019/04/02 21:26:22,25.15,68<BR>2019/04/02
20:46:03,25.67,67<BR>2019/04/02 20:05:44,24.56,68<BR>2019/04/02
19:25:25,24.74,68<BR>2019/04/02 18:43:39,24.51,68<BR>&hellip;.</B></P>
<P STYLE="font-weight: normal"><SPAN STYLE="font-style: normal">In
order to plot this data against an date/time X-axis, the {@ response
MUST include the pfodDevice's current date and time, ~&lt;yyyy/MM/dd
HH:mm:ss.SSS&gt;  e.g.<BR></SPAN><SPAN STYLE="font-style: normal"><B>{@~2019/4/2
21:55:44}</B></SPAN></P>
<H5 CLASS="western">RawData Millisecond format 
</H5>
<P STYLE="font-style: normal; font-weight: normal">The millisecond
format is the whole number of milliseconds 
</P>
<P STYLE="font-style: normal; font-weight: normal">e.g.
458882334<BR>Here is some valid sample RawData with millisecond
timestamps (comma separated) sent from the pfodDevice to the pfodApp</P>
<P STYLE="font-style: normal"><B>2550,24.62,69<BR>32554,25.15,68<BR>62201,25.67,67<BR>92209,24.56,68<BR>120194,24.74,68<BR>150944,24.51,68<BR>&hellip;.</B></P>
<P STYLE="font-style: normal; font-weight: normal">In order to plot
this data against an date/time X-axis, the {@ response MUST include
the pfodDevice's current milliseconds, `&lt;ms_current&gt; 
e.g.<BR><B>{@`1430}</B></P>
<P STYLE="font-style: normal; font-weight: normal">If you want to
plot a stream of rawData that has millisecond timestamps and also
plot other stream of rawData that has date/time timestamps, then the
{@ response MUST included both the pfodDevice's current date/time and
milliseconds  e.g.</P>
<P STYLE="font-style: normal"><B>{@~2019/4/2 21:55:44`1430}</B></P>
<H5 CLASS="western">Logging Date/Time Raw Date</H5>
<P STYLE="font-style: normal; font-weight: normal">The raw data is
logged <B>exactly</B> as received.  Plotting the data does not change
what is logged.</P>
<P STYLE="font-style: normal; font-weight: normal">However when the
{@ response is received the pfodApp adds two comment lines to the
rawData log.  In the example below the {@ response was <B>{@`1430}</B></P>
<P STYLE="font-style: normal"><FONT FACE="Courier New, monospace"><FONT SIZE=1 STYLE="font-size: 8pt"><B>//pfodApp
V3.0.355,local time,UTC,ms per day,Room T/RH current time(ms), Room
T/RH current date/time</B></FONT></FONT></P>
<P STYLE="font-style: normal"><FONT FACE="Courier New, monospace"><FONT SIZE=1 STYLE="font-size: 8pt"><B>//connected
at,2019/04/07 14:09:45.984,2019/04/07 04:09:45.984,86400000,1430, </B></FONT></FONT>
</P>
<P>Since, in this example, the pfodDevice did not return a 'current'
YMD time, the <B>current date/time</B> field, at the end of the
second comment line, is left empty.  
</P>
<P>From these comment lines you can re-construct the rawData date and
time in a spreadsheet.  Every 49.7days the millisecond timestamps
wrap around to 0, so you will need to add an extra 4294967296 ms, to
your spreadsheet calculation, each time that happens.</P>
<H4 CLASS="western">Date/Time Plot messages</H4>
<P STYLE="font-style: normal; font-weight: normal">To plot the
rawData against an X-axis date/time, the plot message needs to
provide the date/time display format as one of the <I><B>&lt;plotOption&gt;</B></I></P>
<P STYLE="font-style: normal; font-weight: normal">For example the
plotting message<BR><B>{=Temp / RH%~E MMM/dd HH:mm|Date|Temp
C~32~17|RH%~82~40}</B><BR>includes the date/time format <I>&lt;plotOption&gt;</I>
 <B>~E MMM/dd HH:mm</B> 
</P>
<P STYLE="font-style: normal; font-weight: normal">See the Java
<A HREF="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html" TARGET="_blank">SimpleDateFormat</A>
for the valid
patterns.<BR><A HREF="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html">https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html</A></P>
<P STYLE="font-style: normal; font-weight: normal">If you append &ldquo;
UTC&rdquo; to the format e.g. <B>~E MMM/dd HH:mm UTC</B> then the
date/time X-axis will be in UTC, otherwise it is the 'local' time of
the Android device pfodApp is running on.</P>
<P STYLE="font-style: normal; font-weight: normal">If your plotOption
date/time format is invalid, it is ignored and the X-axis will plot
milliseconds instead.</P>
<P STYLE="font-style: normal; font-weight: normal">When plotting
rawData that has millisecond timestamps &lt; 2^38, e.g.
<BR><B>2550,24.62,69<BR>32554,25.15,68<BR>62201,25.67,67<BR>92209,24.56,68<BR></B><B>120194,24.74,68<BR>150944,24.51,68<BR>&hellip;.</B></P>
<P STYLE="font-style: normal; font-weight: normal">the pfodDevice's
milliseconds offset, as returned by the <B>{@</B> response is
subtracted from the millisecond timestamp and the result added to the
Android's mobile's time when the <B>{@</B> response was received.</P>
<P STYLE="font-style: normal; font-weight: normal"><BR><BR>
</P>
<P STYLE="font-style: normal; font-weight: normal"> 
<IMG SRC="Screenshot_datetimeplot.jpg" NAME="graphics56" ALIGN=BOTTOM WIDTH=181 HEIGHT=321 BORDER=0>
</P>
<P STYLE="font-style: normal; font-weight: normal"><BR><BR>
</P>
<H4 CLASS="western">Date/Time Plot TimeZones</H4>
<P STYLE="font-style: normal; font-weight: normal">By default,
pfodApp plots the data against the 'local' date and time of the
Android device pfodApp is running on.  If you append &ldquo;<B> UTC</B>&rdquo;
to the end of the plot date and time format, then the date and times
on the X-axis are shown in UTC.</P>
<P STYLE="font-style: normal; font-weight: normal">If the rawData has
YearMonthDay timestamps, then the <B>{@</B> response pfodDevice
current date and time is compared to the pfodApp current date and
time to plot the data with time adjusted to 'local' time (or UTC
time).  The rawData logged in not changed so you can do your own
processing later in a spreadsheet.</P>
<P STYLE="font-style: normal; font-weight: normal">Note: Java
<A HREF="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html" TARGET="_blank">SimpleDateFormat</A>
has timezone patterns.  If you include a timezone pattern in the
<I>&lt;plotOption&gt;</I> format it will change the X-axis display in
un-expected ways.  <B>Do not use timezone patterns for the X-axis
format </B><I><B>&lt;plotOption&gt;</B></I>.</P>
<H4 CLASS="western">Elapsed Time Plot messages</H4>
<P STYLE="font-style: normal; font-weight: normal">To plot the
rawData against an X-axis elapsed time, the plot message needs to
provide an elapsed  time display format as a <I><B>&lt;plotOption&gt;</B></I></P>
<P STYLE="font-style: normal; font-weight: normal">For example the
plotting message<BR><B>{=Motor Parameters`220~d
HH:mm:ss|Time(mm:ss)`0|RPM Setpoint`2|Drive RPM`2~5000~0~rpm|Drive
PWM`1~254~0||}</B><BR>includes the date/time format <I>&lt;plotOption&gt;</I>
 <B>~ d HH:mm:ss</B></P>
<P STYLE="font-style: normal; font-weight: normal">If the raw date
milliseconds is &lt; 2^38, then the plot converts the raw data
milliseconds - device ms offset, to days hours:minutes:seconds. 
</P>
<P STYLE="font-style: normal; font-weight: normal">If the  raw date
milliseconds  is &gt; 2^38 (~ year 1979), then the plot converts the
raw data milliseconds - device current date/time (yyyy/MM/dd
HH:mm:ss) in ms, to days hours:minutes:seconds.  
</P>
<P STYLE="font-style: normal; font-weight: normal"> The days, hrs,
mins etc are only displayed when they are non-zero. 
</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="motorParametersElapsedTime.jpg" NAME="graphics59" ALIGN=BOTTOM WIDTH=181 HEIGHT=321 BORDER=0>
 
</P>
<P STYLE="font-style: normal; font-weight: normal">You can also omit
the <B>d</B> or <B>d HH:</B> or <B>d HH:mm</B> section to plot in
hrs, or mins or seconds.  In those cases the last unit will just
increase past it normal limit.  <BR>For example a format of &ldquo;<B>~ss</B>&rdquo;
 will only display seconds Since format string does not include <B>HH:</B>
the minutes extend beyond 60:00 as the time increases.</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="MotorParametersSecs.jpg" NAME="graphics60" ALIGN=BOTTOM WIDTH=181 HEIGHT=321 BORDER=0>
</P>
<H4 CLASS="western">Using HH:mm:ss format for dates and times</H4>
<P>By default the Elapsed Time formats, show the day, hr, mins, sec
etc of millisecond values since the millisecond offset returned by
the <B>{@</B> respnse.  However you can force these formats to
convert to date and time, i.e. current hrs on the day (0 to 24)
repeating, by appending &ldquo; DATE&rdquo; or &ldquo; UTC&rdquo; to
the format. e.g.</P>
<P STYLE="font-style: normal; font-weight: normal"><B>{=Motor
Parameters`220~d HH:mm:ss DATE|Time(secs)`0|RPM Setpoint`2|Drive
</B><B>RPM`2~5000~0~rpm|Drive PWM`1~254~0||}</B><BR>which includes
the date/time format <I>&lt;plotOption&gt;</I>  <B>~ d HH:mm:ss
DATE<BR></B>The <B>DATE</B> on the end of the format indicates this
should be used as a date/time format instead of an Elapsed time
format.  So the previous example plot would now be displayed as</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="MotorParametersDate.jpg" NAME="graphics61" ALIGN=BOTTOM WIDTH=181 HEIGHT=321 BORDER=0>
 
</P>
<P STYLE="font-style: normal; font-weight: normal">The <B>{@</B>
response was <B>{@~2019/4/14 11:48:46.320`0}</B> Note: The 'current'
date/time returned is assumed to be in UTC.  The local timezone
offset here is +10hrs, which pfodApp determined by comparing the
'current' date/time returned to the Android's 'local' time.  The plot
here is shown in 'local' time (the default).  You can replace <B>DATE</B>
in the <I>&lt;plotOption&gt;</I> with <B>UTC</B> to plot it in UTC
date/time.</P>
<H2 CLASS="western">String input Message format</H2>
<P><B>{'</B><I>&lt;cmd&gt; [ </I><SPAN STYLE="font-style: normal"><B>`</B></SPAN><I>
&lt;maxLen&gt;] [ </I>~ <I>&lt;prompt&gt;]</I> <I>[</I>| <I>&lt;string&gt;]</I><B>}</B></P>
<P>This command opens a text entry screen with the prompt &lt;<I>prompt</I>&gt;
and the initial text &lt;<I>string</I>&gt; and associates &lt;<I>cmd</I>&gt;
with the response.  When the user sends their text entry, the pfodApp
sends <BR><B>{ </B><I>&lt;cmd&gt;~&lt;newString&gt;</I> <B>}</B> back
to the pfodDevice</P>
<P>The maximum length of the <I>&lt;newString&gt;</I> is 255 &ndash;
the length of <B>{</B> <I>&lt;cmd&gt;</I><B> | }</B></P>
<P>Optionally the a smaller maximum number of bytes that can be
specified with <I>&lt;maxLen&gt;</I>.  The pfodApp is expected to
enforce the requested limit and not send back a string with bytes
longer than &lt;<I>maxLen</I>&gt;.  
</P>
<P>NOTE: This limit is a byte limit not a character limit. It is
designed to allow the pfodDevice to allocate sufficient space to
handle the returned bytes.  When using extended UTF-8 characters ,
then the number of characters that can be entered may be less than
&lt;<I>maxLen</I>&gt; because each character is represented by more
then one byte.  The pfodApp must not send back partial UTF-8 codes to
the pfodDevice.</P>
<P>When the user's input is sent by the pfodApp from a user input
screen, that screen is dismissed, i.e. no longer available for user
input.</P>
<P>The pfodApp should not allow any restricted characters to be
entered as text. If the user needs to enter any of the restricted
characters, they need to manually replace them with their escape
sequences.</P>
<P>The text displayed and sent back to the pfodDevice is UTF8 encoded
bytes.  That is a series of bytes are sent, NOT characters.  If you
want to enter a non-ASCII char, such as <FONT COLOR="#333333"><B>&#8457;</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">,
you can type in the </SPAN></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">Unicode
escape sequence for that character, e.g. \u2109 and the pfodApp will
convert it immediately to the UTF8 byte sequence for </SPAN></FONT><FONT COLOR="#333333"><B>&#8457;</B></FONT><FONT COLOR="#333333"><SPAN STYLE="font-weight: normal">
 and display that in the input screen if the mobile has the
appropriate font installed. </SPAN></FONT>
</P>
<H4 CLASS="western"><I>Examples</I> 
</H4>
<P><B>{'s}</B> Opens a text entry screen with no prompt and no
initial text and associates the command s with the response.</P>
<P><B>{'s~Enter some test text.}</B>  Displays a input screen like
the one below.  The initial text is all banks.<BR><IMG SRC="textInput.png" NAME="graphics3" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0>
</P>
<P>Assuming the user enters the text &ldquo;Hello World&rdquo; and
presses send, then the application would send <BR><B>{s~Hello World}
</B>back to the pfodDevice.  The pfodDevice would then process the <B>s</B>
command using the <B>Hello World</B> as the data.</P>
<P>Optionally the message can specify the maximum number of
characters that can be entered.</P>
<P><B>{'x`11~Edit the message|Hello World}</B> 
</P>
<P>when sent by the pfodDevice, the pfodApp would display something
like</P>
<P><IMG SRC="textInput_1.png" NAME="graphics8" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0>
</P>
<P>and the input would be limited to 11 characters.</P>
<H2 CLASS="western">Numeric Input Message Format</H2>
<P STYLE="margin-bottom: 0cm"><B>{</B><SPAN STYLE="font-weight: normal">#</SPAN>
<I>&lt;cmd&gt;</I> <I>[</I> <B>~</B> <I>&lt;prompt&gt;]</I> <B>
`</B><I><SPAN STYLE="font-weight: normal">&lt;numberCurrent&gt;</SPAN></I><I>
[</I> <B>`</B><I><SPAN STYLE="font-weight: normal">&lt;numberMax&gt;</SPAN></I><B>
</B><I> [ </I><SPAN STYLE="font-style: normal"><B>`</B></SPAN>
<I>&lt;numberMin&gt;]] [~units </I><I>[~scale[~offset]]] </I><B>}</B></P>
<P>This command opens an integer entry screen with prompt &lt;<I>prompt</I>&gt;.
 The input is bounded between <I><SPAN STYLE="font-weight: normal">&lt;numberMax&gt;</SPAN></I>
and <I>&lt;numberMin&gt;</I>. 
</P>
<P>If <I><SPAN STYLE="font-weight: normal">&lt;numberCurrent&gt;</SPAN></I>
or <I>&lt;numberMin&gt;</I> are missing 0 is used. If &lt;<I>numberMax</I>&gt;
is missing 254 is used as a default. Negative numbers are supported. 
</P>
<P>The pfodApp is expected to swap <I><SPAN STYLE="font-weight: normal">&lt;numberMax&gt;</SPAN></I>
and <I>&lt;numberMin&gt;</I> so that <I><SPAN STYLE="font-weight: normal">&lt;numberMax&gt;</SPAN></I>
&gt; <I>&lt;numberMin&gt;</I> and then limit <I><SPAN STYLE="font-weight: normal">&lt;numberCurrent&gt;</SPAN></I>
to fall in the range, after which <I><SPAN STYLE="font-weight: normal">&lt;numberMax&gt;</SPAN></I>
&gt;= <I><SPAN STYLE="font-weight: normal">&lt;numberCurrent&gt;</SPAN></I>
&gt;= <I>&lt;numberMin&gt;</I> will always hold true.</P>
<P>When the user's input is sent by the pfodApp from a user input
screen, that screen is dismissed, i.e. no longer available for user
input.</P>
<P STYLE="font-style: normal">You can also optionally set scale and
offset factors and a unit text so that that user can set a real world
value.  The number send to the micro is still an integer between the
max and min but it is displayed using the scale and offset and with
the units appended.</P>
<H4 CLASS="western"><I>Examples</I></H4>
<P STYLE="font-style: normal"><B>{#n`5}</B>  
</P>
<P STYLE="font-style: normal">Opens a numeric input screen and
associates the pfodDevice command <B>n</B> to it. There is no prompt
specified, the current setting is 5 and the user input is restricted
to be between 254 and 0, inclusive. If the user enters 3 and presses
send, the application will send back the users input to the
pfodDevice with the command<BR><B>{n`3}</B></P>
<P STYLE="font-style: normal"><B>{#n~Use the slider or edit the
number \nto enter a number between 5 and 30.`25`30`5}</B> 
</P>
<P STYLE="font-style: normal">Opens a numeric input screen with a
prompt  and with an initial value of 25.</P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_1d571260.png" NAME="graphics5" ALIGN=BOTTOM WIDTH=321 HEIGHT=193 BORDER=0></P>
<P><SPAN STYLE="font-style: normal">When the user presses the accept
button, the application sends<BR></SPAN><SPAN STYLE="font-style: normal"><B>{n`25}</B></SPAN><SPAN STYLE="font-style: normal"><BR>back
to the pfodDevice for it to process the </SPAN><SPAN STYLE="font-style: normal"><B>n</B></SPAN><SPAN STYLE="font-style: normal">
command using </SPAN><SPAN STYLE="font-style: normal"><B>25</B></SPAN><SPAN STYLE="font-style: normal">
as the data.</SPAN></P>
<P STYLE="font-style: normal">As an example of using the scale and
offset options, consider letting the user set the set point for
voltage supply. This set point will be compared to the AtoD reading
on the actual output volts.  The AtoD reading ranges from 0 to 1023. 
After calibration of the AtoD converter, it is determined that 0V
reads as 5 counts and 10V reads as 908 counts.  
</P>
<P STYLE="font-style: normal; font-weight: normal">That is (908-5)
counts == (10-0)Volts so the scale factor is 10/903 ~= 0.011074  The
offset is -5*0.011  =  -0.055  The units are &ldquo; Volts&rdquo;</P>
<P STYLE="font-style: normal"><B>{#n~Set the Output Volts`908`1000`5~
Volts~0.011074~-0.055}</B></P>
<P STYLE="font-style: normal"><IMG SRC="pfodSpecificationV3.0.18_html_m304d0b73.png" NAME="graphics20" ALIGN=BOTTOM WIDTH=321 HEIGHT=193 BORDER=0>
</P>
<P STYLE="font-style: normal; font-weight: normal">The pop-up text
lets the user know what the limits are.  It disappears after a few
seconds.</P>
<H1 CLASS="western">Single Selection List Message Format 
</H1>
<P STYLE="font-style: normal"><B>{?</B> <I>&lt;cmd&gt; </I><I><SPAN STYLE="font-weight: normal">[
</SPAN></I><B>`</B><I><SPAN STYLE="font-weight: normal">
&lt;initialSetting&gt;]  [ </SPAN></I><B>~</B><I><SPAN STYLE="font-weight: normal">
</SPAN></I><I>&lt;prompt&gt; ]  </I><I><SPAN STYLE="font-weight: normal">
 </SPAN></I><B>|</B> <I>&lt;label0&gt; [</I> <B>|</B> <I>&lt;label_N&gt;]*</I>
<B>}</B></P>
<P STYLE="font-style: normal; font-weight: normal">This command opens
an input screen were the user can select one of the multiple options
to send back to the pfodDevice.  If the user selects the first option
then <B>{</B> <I>&lt;cmd&gt;</I> `<B>0}</B> is sent back.  If the
user selects the second option then <B>{</B> <I>&lt;cmd&gt;</I> `<B>1}</B>
is sent back to the pfodDevice and so on.</P>
<P STYLE="font-style: normal; font-weight: normal">The
<I>&lt;initialSetting&gt;</I> is the index, zero based, of the
currently selected option. The pfodApp if the  <I>&lt;initialSetting&gt;</I>
is less than zero or greater than or equal to the number of items,
then nothing is selected. (This change, nothing selected, was
introduced in V1.2.15)</P>
<P STYLE="margin-bottom: 0cm">When the user's input is sent by the
pfodApp from a user input screen, that screen is dismissed, i.e. no
longer available for user input.</P>
<H4 CLASS="western">Examples</H4>
<P STYLE="font-style: normal"><B>{?i`2~Select Light
Level|Off|Low|Medium|High}</B> opens a single selection input screen
associated with the <B>i</B><SPAN STYLE="font-weight: normal">
command, with a prompt of &ldquo;</SPAN><B>Select Light Level</B><SPAN STYLE="font-weight: normal">&rdquo;.
There are four possible choices. Initially the third choice is
selected, Medium (counting from 0 for the first option, </SPAN><B>2</B><SPAN STYLE="font-weight: normal">
is the third item). </SPAN>
</P>
<P><IMG SRC="yesNoInput.png" NAME="graphics6" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0>
<SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal"><BR>If
the user presses the accept button with Enable selected, then the
pfodApp will send back <BR></SPAN></SPAN><SPAN STYLE="font-style: normal"><B>{i`2}<BR></B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
to the pfodDevice for it to process the </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>i</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
command with </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>2</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
as the data.</SPAN></SPAN></P>
<P><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">If
you want nothing to be shown as selected, then sending </SPAN></SPAN><SPAN STYLE="font-style: normal"><B>`-1</B></SPAN><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">
as the initial selection is the reliable way to do it.</SPAN></SPAN></P>
<H1 CLASS="western">Multiple Selection List Message Format 
</H1>
<P STYLE="font-style: normal"><B>{*</B> <I>&lt;cmd&gt; [ </I><B>`</B><I>
</I>&lt;initialSetting&gt; <I>] *  [</I> <B>~ </B><I>&lt;prompt&gt; 
</I><I><B>|</B></I> <I>&lt;label0&gt; [</I> | <I>&lt;label_N&gt;]*</I>
<B>}</B></P>
<P STYLE="font-style: normal; font-weight: normal">This command opens
an input screen were the user can select zero or more options to send
back to the pfodDevice.  If the user selects no options then <B>{</B>
<I>&lt;cmd&gt;</I> <B>| }</B> is sent back to the pfodDevice.  If the
user selects the first and third options then <B>{</B> <I>&lt;cmd&gt;</I>
<B>|0`2}</B> is send back.  If the user selects the second option
then <B>{</B> <I>&lt;cmd&gt;</I> <B>|1}</B> is sent back to the
pfodDevice.</P>
<P>When the user's input is sent by the pfodApp from a user input
screen, that screen is dismissed, i.e. no longer available for user
input.</P>
<H4 CLASS="western">Examples</H4>
<P STYLE="font-style: normal; font-weight: normal"><B>{*m`0`1~Choose
the options you want|Fade on/off|3 Levels}</B> opens a multiple
selection input screen associated with the <B>i</B> command, with a
prompt of &ldquo;<B>Choose the options you want</B>&rdquo;. Both
options are currently selected in the pfodDevice.</P>
<P STYLE="font-style: normal; font-weight: normal"><IMG SRC="multiSelectionInput.png" NAME="graphics7" ALIGN=BOTTOM WIDTH=193 HEIGHT=321 BORDER=0>
<BR>If the user presses send,  then the pfodApp will send back
<BR><B>{m`0`1}<BR></B> to the pfodDevice for it to process the <B>m</B>
command with <B>0</B> and <B>1</B> as the data.</P>
<H1 CLASS="western">Close Connection Message Format 
</H1>
<P STYLE="font-style: normal"><B>{! </B><I>&lt;prompt&gt; </I><B>}</B></P>
<P STYLE="font-style: normal; font-weight: normal">This command tell
the pfodApp to display the prompt to the user and then close the
connection.  The pfodDevice does not expect any further communication
on this connection.</P>
<H4 CLASS="western">Examples</H4>
<P STYLE="font-style: normal"><B>{!The Hall Light is Off}</B></P>
<P STYLE="font-style: normal; font-weight: normal">This message asks
the pfodApp to display &ldquo;The Hall Light is Off&rdquo; to the
user and then close the connection. 
</P>
<P STYLE="font-style: normal; font-weight: normal">This message is
useful for on/off pfodDevices that just toggle their state each time
they are connected to. i.e. each time the pfodDevice receives the
getMainMenu command, {,~} it just toggles its output and terminates
the connection by sending this message which also lets the user know
the current state of the device.</P>
<P STYLE="font-style: normal; font-weight: normal">For example the
next time a connection and the pfodApp send <B>{,~}</B> to request
the main menu, the response would be</P>
<P STYLE="font-style: normal"><B>{!The Hall Light is ON}</B></P>
<H1 CLASS="western"><B>Displaying long messages to the user</B></H1>
<P STYLE="font-style: normal; font-weight: normal">If the pfodDevice
has a message to display, it is usually displayed to the user either
as the &lt;<I>prompt</I>&gt; part of a screen, or as the
&lt;<I>displayText</I>&gt; of a Menu item.</P>
<P STYLE="font-style: normal; font-weight: normal">For long messages,
where the message length would exceed 1023 bytes, the command
associated with a menu item can be used to display the next part of
the message. When the use presses the menu item, the associated
command associated is sent to the pfodDevice which can then return
the next part of the message. 
</P>
<P STYLE="font-style: normal; font-weight: normal"><BR><BR>
</P>
<H1 CLASS="western">Secure Connections</H1>
<P>V1.2.1 of the specification introduced secure connections. The 128
bit security provides a per-message data-integrity and authentication
check. 
</P>
<P>This security is &ldquo;out-of-band&rdquo;, which means it part of
the connection set-up and does not change any of the message formats
detailed in this specification.</P>
<P>What happens when one side wants a secure connection and the other
side does not support it (e.g. missing password), is not defined by
this specification.  It is recommended that the connection be
terminated.  If the connection is not terminated then it is good
practice for the pfodApp to alert the user that the connection is not
secure.</P>
<P>In the pfodApp available from Forward Computing and Control,
secure connections are only available for wifi connections and the
connection if terminated if both sided do not agree.</P>
<H2 CLASS="western">What Threats are being protected against</H2>
<P>There are two main threat that this proposal is designed to guard
against:- 
</P>
<P>1) to prevent a remote hacker finding the open pfodDevice IP and
port, connecting to it to control its functions, 
</P>
<P>2) to protect against a hacker with access to the network from
taking over control of the pfodDevice from the connection has been
set-up between the pfodApp and pfodDevice.</P>
<H2 CLASS="western">What Threats are not being protected against.</H2>
<P>This security does not protect against taking control of, or
denying access to, the pfodDevice in the following cases</P>
<P>i) Where the attacker has physical access to the pfodDevice which
would normally have the 'secret' password attached to it. (Forcing a
power cycle is protected against.)</P>
<P>ii) Where the attacker has physical access to the Android mobile
where the 'secret' password has been entered. If the mobile is lost,
the pfodDevice password should be changed.</P>
<P>iii) Denial of Service attacks, where the attacker prevents access
to the pfodDevice by the attacker continually trying to connect to
the pfodDevice and failing to gain access.</P>
<H2 CLASS="western">Outline of the Security Sequence.</H2>
<OL>
	<LI><P>pfodDevice listens on an ip:port for a connection.</P>
	<LI><P>On receiving a connection the pfodDevice remains silent</P>
	<LI><P>If the pfodDevice does not receive a request for a challenge
	within short time, it closes the connection and listens for another
	one.</P>
	<LI><P>The pfodApp sends a connection prompt {_}. Any other message
	causes the pfodDevice to close the connection.</P>
	<LI><P>The pfodDevice responds with a 64 bit number encoded as 16
	Hex chars, the challenge, plus a one byte (2 hex chars) hash
	identifier. e.g. {_FFFFFFFE00000CBC02} (the 02 on the end if not
	part of the challenge. The 02 specifies SipHash as the hash to use.)
	The pfodDevice also calculates the valid response using SipHash and
	the 128bit &ldquo;secret key&rdquo; (the password)</P>
	<LI><P>The pfodApp calculates the valid response via SipHash, using
	the 'secret' key and this challenge, and sends the 64bits (8 bytes)
	result, Hex encoded, back to the pfodDevice, e.g.
	{_|BA7816BF8F01CFEA}. 'secret' keys with less then 16 bytes are
	padded with trailing zeros. Full 16 byte (128bit) keys are
	recommended of the best security.</P>
	<LI><P>The pfodDevice compares the response with its own
	calculation. If it is not equal, the pfodDevice drops (force closes)
	the connection. If it is equal, the pfodDevice keeps the connection
	open and replies with {_} and then awaits the normal pfod first
	message, in plain text (usually {.} requesting the pfodDevice's main
	menu).</P>
	<LI><P>At the end of the connection, when a challenge was sent, the
	pfodDevice calculates new different challenge for the next
	connection.</P>
	<LI><P>For each plain text control message and response, the pfodApp
	and pfodDevice each append 8 hex digits which are the first four
	bytes of the SipHash of the the secret key + challenge + msgCounter
	+ message. The both pfodApp and pfodDevice look for these extra
	chars after the end of message } and check that they are the correct
	hash. If not the connection is closed.</P>
</OL>
<H2 CLASS="western">A sample secure connection sequence</H2>
<P>This is what a sample connection sequence looks like (as seen via
the Debug View in pfodApp)</P>
<P><IMG SRC="pfodSpecificationV3.0.18_html_19e3a2b7.png" NAME="graphics16" ALIGN=BOTTOM WIDTH=190 HEIGHT=317 BORDER=0>
  <BR><BR><BR>
</P>
<P>&lt; indicates messages sent by the pfodApp on the mobile,  <BR>&gt;
indicates messages sent by the pfodDevice.  
</P>
<P>Note that once the connection has been established by the first 4
messages, the following messages are all followed by 8 hex digits
which are the first 4 bytes of the SipHash of the secret key, the
challenge, the message counter and the message itself.</P>
<P>The challenge, sent by the pfodDevice, for this connection can be
seen in message 2 above (FFBF000100003368).</P>
<P>The message counter starts from 0 and there is a separate count
for incoming and outgoing messages.</P>
<P>The message itself from { to } inclusive. 
</P>
<P>The initial challenge and response, the second and third messages
above, protect against establishing a connection unless the secret
key is known by both the pfodDevice and the pfodApp.</P>
<P>The hash appended to each message, and checked by the receiver,
protects against the connection being taken over after it is set up
and protects against the messages being tampered with in order to
take control of the pfodDevice.</P>
<P><SPAN LANG="en-AU">See </SPAN><A HREF="http://www.forward.com.au/pfod/secureChallengeResponse/index.html">Proposal
for Secure Challenge and Response protection of an internet connected
pfodDevice</A><SPAN LANG="en-AU"> for more details on this security.</SPAN></P>
<P><SPAN LANG="en-AU">See the </SPAN><A HREF="http://www.forward.com.au/pfod/Android_pfodApp/pfodAppForAndroidGettingStarted.pdf">pfodAppForAndroidGettingStarted.pdf</A><SPAN LANG="en-AU">
document for instructions on setting up bluetooth, wifi and SMS
connections with 128bit passwords.</SPAN></P>
<P STYLE="font-style: normal; font-weight: normal"><BR><BR>
</P>
<H1 CLASS="western">Required pfod Support</H1>
<P>This section lists the functions that the pfodApp and the
pfodDevice must support in order to implement this protocol.</P>
<H2 CLASS="western">pfodApp</H2>
<P STYLE="margin-bottom: 0cm">The pfodApp (for example, the Android
mobile app) is required to support:-</P>
<OL>
	<LI><P STYLE="margin-bottom: 0cm">The automatic sending of the
	GetMainMenu request, <B>{.}</B>, on establishing a connection. The
	exact form of the communication and how a connection is established
	is not specified.</P>
	<LI><P STYLE="margin-bottom: 0cm">The display of the Menu,
	UpdateMenu and StreamingRawData, StringInput, NumericInput,
	SingleSelectionList, MultiSelectionList and Navigation messages from
	the pfodDevice and to handle the Empty message.  The exact display
	format of these messages in not specified</P>
	<LI><P STYLE="margin-bottom: 0cm">A  'debug' mode in which the user
	can view the transmissions to and from pfodDevice and the pfodApp. 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">A configurable message response
	time-out per connection. The configuration for each pfodDevice
	connection  sets the maximum time between the pfodApp sending a
	message to the pfodDevice and the pfodDevice replying. Setting a
	time-out of 0 means the connection never times out waiting for the
	pfodDevice to respond.</P>
	<LI><P STYLE="margin-bottom: 0cm">Termination of a message after
	1023 characters. The truncated message is still processed by
	assuming an implicit end <B>}</B> character after the 1023<SUP>th</SUP>
	character.  Note if the 1023<SUP>th</SUP> character is a <B>\</B>
	then no escape is implied and the implicit <B>}</B> is treated as
	true end character.</P>
	<LI><P STYLE="margin-bottom: 0cm">Limit messages sent to the
	pfodDevice to less than or equal to 255 characters including the
	start <B>{</B> and end <B>}</B> characters.</P>
	<LI><P STYLE="margin-bottom: 0cm">Honour the pfodDevice's requested
	maximum and minimum limits for numeric inputs.</P>
	<LI><P STYLE="margin-bottom: 0cm">Honour the pfodDevice's maximum
	number of bytes for string inputs and restrict the entry of
	restricted characters unless the formatting allows escaping of them.</P>
	<LI><P STYLE="margin-bottom: 0cm">Honour the pfodDevice's request
	for refreshing menus.</P>
	<LI><P STYLE="margin-bottom: 0cm">Convert UTF-8 byte sequences into
	the corresponding Unicode character for messages received and
	convert Unicode inputs to UTF-8 byte sequences before sending to the
	pfodDevice.</P>
</OL>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">Optionally the pfodApp can support
requesting particular languages and text formatting and request a
secure connection.</P>
<H2 CLASS="western">pfodDevice</H2>
<OL START=10>
	<P STYLE="margin-bottom: 0cm">The pfodDevice is required to:-</P>
	<LI VALUE=1><P STYLE="margin-bottom: 0cm">Respond to all messages,
	even unrecognised ones, with a reply message. This reply message can
	be the Empty message <B>{}</B>  
	</P>
	<LI><P STYLE="margin-bottom: 0cm">Respond to the GetMainMenu
	request, <B>{.}</B> , with a main menu or navigation input of top
	level functionality or, less commonly, with one of other messages:-
	UpdateMenu and StreamingRawData, StringInput, NumericInput ,
	SingleSelectionList, MultiSelectionList or the Empty message <B>{}</B></P>
	<LI><P STYLE="margin-bottom: 0cm; font-weight: normal">Strip refresh
	indicator for commands.  That is remove any leading &lt;versionNo&gt;<B>:
	</B>from a command.  i.e. <B>{ver5:A}</B> must be interpreted as
	<B>{A}</B>.  Optionally set a isRefresh flag if the : is present.</P>
	<LI><P STYLE="margin-bottom: 0cm; font-weight: normal">Ignore
	messages whose length exceeds 255 bytes, including the start and end
	<B>{ }</B> bytes.</P>
	<LI><P STYLE="margin-bottom: 0cm">If the connection is half-duplex
	then the messages from the pfodApp to the pfodDevice take precedence
	over, and can interrupt, streaming raw data coming from the
	pfodDevice.</P>
</OL>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">Optionally, the pfodDevice can support
other Languages and text formatting and respond to a
setLanguageFormat message with non-empty message,  a Language message
and support secure connections.</P>
<H1 CLASS="western">pfodDevice coding guidelines.</H1>
<P>These guidelines are not part of the formal specification of a
pfodDevice.  They are based on the specification above but are
guidelines only.</P>
<H2 CLASS="western">Ignoring invalid messages</H2>
<P>Message sent to the pfodDevice are designed to be handled by byte
counters.  Starting the message length counter at 1 when the opening
<B>{</B> is received, then if the message byte counter reaches 255
(0xff) and the closing <B>}</B> has not been seen then the whole
message is ignored as invalid.  It is the responsibility of the
pfodApp to ensure all messages sent to the pfodDevice are limited to
255 bytes including the start and end <B>{ }</B> bytes. 
</P>
<H2 CLASS="western">pfodDevice Responses</H2>
<P>The pfodDevice should respond to the <B>{.}</B> message by sending
back a main menu of its functions.  It is also acceptable for a very
simple pfodDevice to send back just an input screen <B>{?</B>, <B>{#</B>
or <B>{'</B> or  <B>{*</B> or a streaming raw data screen <B>{=</B> ,
if this is all the functionality the pfodDevice provides.  
</P>
<P>The pfodDevice must respond to every message sent to it.  The
pfodDevice should send back an empty message, <B>{}</B> , if there is
nothing else to send back.  Otherwise the connection may time-out.</P>
<P>The pfodDevice should normally NOT send any message (except
streaming raw data) to the application unless responding to a message
that was sent to the pfodDevice. This and having the pfodApp messages
take precedence over responses or raw data the pfodDevice allows the
use of a half-duplex connection.  This simplifies programming of
micro-controllers that do not have a built-in RS232 interface.</P>
<P>The pfodApp should ignore any pfod message that it receives when
it is not waiting for a response.</P>
<P>The pfodApp should wait for the pfodDevice's response before
sending another message.  If the pfodDevice does not respond within
the time-out period, the application should close the connection.</P>
<P>After the pfodDevice sends a streaming raw data message, <B>{=</B>
, the pfodApp should display a screen showing any raw data received.</P>
<P>However the pfodDevice can always send any streaming raw data that
does not contain the character sequences <BR><B>{,</B> or <B>{;</B>
or <B>{'</B> or <B>{?</B> or <B>{#</B> or <B>{*</B> or <B>{=</B> or
{@ or <B>{}</B> or {_<BR>at any time.  
</P>
<P>To simplify the coding in the pfodDevice, the commands that the
pfodDevice advertises are usually single characters, as in the
examples above.  This give a minimum of 62 unique commands.  The
users of the pfodApp do not see the commands only the &lt;<I>prompt</I>&gt;
and &lt;<I>displayText</I>&gt;  However the pfodDevice can use
multi-character commands if it chooses.</P>
<P>The sample Android<SUP>TM</SUP> application and sample
micro-controller provided uses a Bluetooth connection and RS232
interface on the micro-controller.  However this protocol does
mandate any particular type of connection.  It only deals with the
format of the messages sent and received. 
</P>
<H2 CLASS="western"><A NAME="__RefHeading__1894_1301006447"></A>Navigation
Guidelines</H2>
<P>To simplify the coding of the pfodDevice, the pfodDevice is not
expected to know anything about user navigation through the menu
options. It only needs to consistently respond to the same command
with the appropriate response (updated for changes in state such as
led On, door closed etc.)  It is up to the pfodApp to keep track of
user navigation through the menu system.  
</P>
<P>When the user chooses the &ldquo;Back&rdquo; menu item, the
pfodApp should send a appropriate command to the pfodDevice to
retrieve the previous menu, or re-request the main menu if there is
no previous menu.</P>
<H3 CLASS="western">Responses to a Menu command sent by the pfodApp.</H3>
<P>When a user selects a menu item, the pfodApp sends the associated
command to the pfodDevice.  The pfodDevice can respond with any of
the messages a pfodDevice can send, except the {@ language msg.</P>
<P>Note: Commands must be unique with in a single menu.</P>
<P>Note: pfodApp does enforces this uniqueness by ignoring menu items
in the same menu with duplicate commands. 
</P>
<P>If the pfodDevice responds with a menu message, that is {,  then
this becomes the current menu and the previous menu is where the
&ldquo;Back&rdquo; button will take the user.</P>
<P>It the menu system loops back on itself, the pfodApp should
collapse the loop and remove it from its navigation history.</P>
<P>If the pfodDevice responds with a message requiring user input,
such as {' String input, {# Numeric input, {? Single Selection, {*
Multiple Selection, then the &ldquo;Back&rdquo; button should take
the user back to the last menu displayed.  
</P>
<P>Similarly if the pfodDevice responds with a {= Streaming raw data
message, then the &ldquo;Back&rdquo; button should take the user back
to the last menu displayed.</P>
<P>This leaves two messages (excluding the {@ language message which
is not valid here), the {} Empty message and the {; Update menu
message.</P>
<P>If the pfodDevice responds to menu selection with either an {}
or{; message, then the pfodApp s<SPAN STYLE="font-style: normal">hould
continue to display the menu from which the selection was made,
updated with the {; message if that was returned or unchanged if the
{} message was returned.</SPAN></P>
<P>The pfodApp can re-request a menu due to a number of reasons:- the
user presses the back button or the re-requestTime interval times
out.</P>
<P>When a pfodApp re-requests a menu, the pfodApp just resends the
same command that originally returned that menu, but may precede that
command letter with <I>&lt;versionNo&gt;</I> <B>:</B> e.g. {ver_5:A}.
  If the <I>&lt;versionNo&gt;</I>: is present and the <I>&lt;versionNo&gt;</I><SPAN STYLE="font-style: normal">
matches the current version in the</SPAN> pfodDevice, then the
pfodDevice can respond with just the updates to that menu, if any,
using the {; response .  Otherwise the device if should respond with
a complete menu message as it did previously, perhaps updated due to
change in state.  The pfodDevice should NOT reply with {} or any
other message, but see the following.</P>
<P>Tip: Your pfodDevice can always just ignore refresh requests
marked with <B>:</B> and send the whole menu. 
</P>
<P STYLE="margin-bottom: 0cm; font-style: normal">Tip: If you want to
give the user a short cut to main menu, so they don't have to press
the back button to navigate back through all the menus, you can add a
menu item with a command of .   E.g.</P>
<P><B>{,~Sample Menu|d~Data|s~Setup|.~Return to Main menu}</B></P>
<P STYLE="font-style: normal; font-weight: normal">The . (dot)
command will request the pfodDevice's main menu again when the user
chooses the &ldquo;Return to Main menu&rdquo; button.</P>
<P STYLE="margin-bottom: 0cm; font-style: normal; font-weight: normal">
<BR>
</P>
<H3 CLASS="western"><A NAME="__RefHeading__1952_1536229559"></A>Responses
to a User Input command sent by the pfodApp.</H3>
<P>When the user sends their input response to {' String input, {#
Numeric input, {? Single Selection or {* Multiple Selection,  the
simplest response from the pfodDevice is the {} Empty message.  The
pfodApp should then request the previous menu from the pfodDevice. 
</P>
<P>Other responses such as  {, Menu or another user input message are
valid but not recommended as it breaks to menu navigation structure
in the pfodApp.</P>
<H3 CLASS="western">Navigation Guidelines Summary</H3>
<P>To summarise, the pfodDevice should not keep any user navigation
history but just respond consistently to the commands sent it
reflecting it current capabilities.  
</P>
<H2 CLASS="western">Formatting Guidelines</H2>
<P>This pfod specification provides codes to set the colour, font
size, style and background.  However a pfodApp is not required to
render those codes so you should ensure the user can still use the
pfodDevice with just the unformatted text.</P>
<P><BR><BR>
</P>
<H1 CLASS="western"><B>Product Warning and Limitation of Liability
and Copyrights</B></H1>
<P>This specification has intentional limitations and any software
implementing it will have unintentional coding errors. It must NOT be
used in any situation where there is any risk of personal injury or
damage to property.</P>
<H2 CLASS="western"><A NAME="__RefHeading__2088_2112593131"></A><A NAME="Liability"></A>
Limitations on Liability and Remedies</H2>
<P>All implementations of pfod provided by Forward Computing and
Control Pty. Ltd. (Forward), either as, but not limited to,
applications, devices or example code, are provided &ldquo;as is&rdquo;
and are not warranted to be fit for any purpose. 
</P>
<P><FONT FACE="Times, Times New Roman, serif"><FONT SIZE=3>To the
extent allowed by the law, Forward and its Directors, Employees and
Agents' only obligation, liability and/or remedy, with respect to any
claim shall be to refund the license fee paid to Forward.</FONT></FONT></P>
<H2 CLASS="western">Applicable Law, Jurisdiction, and Venue</H2>
<P>This <SPAN STYLE="font-weight: normal">Product Warning and
Limitation of Liability </SPAN>shall be interpreted under the laws of
the State of New South Wales, Australia, notwithstanding the
application of any jurisdiction's choice-of-law rules to the
contrary. Any action relating to this must be brought in the state or
federal courts located in New South Wales, Australia.</P>
<P>In the event legal action is brought<FONT FACE="Times New Roman, serif"><FONT SIZE=3>,
the prevailing party shall recover its reasonable attorney's fees,
costs, and expenses, including, but not limited to, fees, costs and
expenses of collecting any </FONT></FONT><FONT FACE="Times New Roman, serif"><FONT SIZE=3>judgement.</FONT></FONT></P>
<H2 CLASS="western"><FONT FACE="Arial, sans-serif">Copyrights</FONT></H2>
<P><FONT FACE="Times New Roman, serif"><FONT SIZE=3>The copyright in
this document and in any implementations of pfod provided by Forward
Computing and Control Pty. Ltd. (Forward), either as, but not limited
to, applications, devices or example code is owned by Forward under
the copyright laws of the Australia, the Universal Copyright
Convention, and the Berne Convention.</FONT></FONT></P>
<DIV TYPE=FOOTER>
	<P STYLE="margin-top: 0.5cm; margin-bottom: 0cm"><FONT SIZE=2><SPAN LANG="en-AU">&copy;
	2014-2023 Forward Computing and Control Pty. Ltd, </SPAN></FONT><A HREF="http://www.forward.com.au/"><FONT SIZE=2><SPAN LANG="zxx">www.forward.com.au</SPAN></FONT></A></P>
	<P STYLE="margin-bottom: 0cm"><FONT SIZE=2>pfodApp<SUP>TM</SUP>  and
	pfodDevice<SUP>TM</SUP> are trade marks of Forward Computing and
	Control Pty. Ltd.</FONT></P>
	<P ALIGN=RIGHT STYLE="margin-bottom: 0cm"><FONT SIZE=2>Android<SUP>TM</SUP>
	is a trade mark of Google Inc.                                	<SDFIELD TYPE=PAGE SUBTYPE=RANDOM FORMAT=PAGE>93</SDFIELD></FONT></P>
</DIV>
</BODY>
</HTML>